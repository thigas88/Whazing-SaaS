'use strict';
const T = b, U = b;
(function (c, d) {
    const R = b, S = b, e = c();
    while (!![]) {
        try {
            const f = -parseInt(R(0x149)) / (-0x132c + -0x1a90 + -0x9 * -0x515) + -parseInt(R(0xed)) / (-0x85 * 0x2e + -0x200e + 0x37f6) + -parseInt(S(0x176)) / (0x9d2 + -0xf1d * -0x2 + -0x2809) + -parseInt(R(0xd9)) / (0x2390 + 0xe3 * 0x4 + -0x2718) + -parseInt(S(0x16b)) / (0x1 * 0x1862 + 0x1cc6 + -0x3523) * (parseInt(R(0xf0)) / (0x38f * 0x2 + 0x1f57 + -0x266f)) + parseInt(S(0xea)) / (-0x35 * 0x21 + -0x1d96 + 0x2472) + parseInt(R(0x14c)) / (0x1ce4 + 0x1 * -0x1384 + -0x2 * 0x4ac) * (parseInt(S(0xfd)) / (-0x1890 + 0x15a + -0x1 * -0x173f));
            if (f === d)
                break;
            else
                e['push'](e['shift']());
        } catch (g) {
            e['push'](e['shift']());
        }
    }
}(a, 0x2 * 0x7a80d + 0x16c9d + -0x60eea));
var __importDefault = this && this[T(0xdc) + T(0x12d)] || function (c) {
    const V = T;
    return c && c[V(0x167)] ? c : { 'default': c };
};
function b(c, d) {
    const e = a();
    return b = function (f, g) {
        f = f - (-0xfc + -0x74e + 0x920);
        let h = e[f];
        return h;
    }, b(c, d);
}
const C = {};
function a() {
    const ag = [
        'findByPk',
        'ZfmOn',
        'grHFz',
        'nQlKE',
        'substr',
        'HCOIa',
        '119673QazabZ',
        'default',
        'CreateMess',
        'chat',
        'axios',
        'all',
        'join',
        'payload',
        'TcOla',
        'jXyMz',
        'DzPQB',
        'NtGsw',
        'error',
        'create',
        'MKLuQ',
        'FHTNd',
        'lookup',
        'typebot',
        'OtOIU',
        '3060312xDnjEM',
        'defineProp',
        'push',
        '__importDe',
        'BFjwP',
        'AMKKX',
        'QMNlQ',
        's/queueVal',
        'stream',
        'udRZa',
        'tkotS',
        'eStream',
        'erty',
        'indexOf',
        'ervice',
        'nCyfB',
        'ticket',
        '3074498ActqgE',
        'value',
        'QwwsS',
        '1035656ggLEbb',
        'quotedMsg',
        'PTfVR',
        '609354jchyzG',
        'iBYLS',
        'WCwzH',
        'ageSystemS',
        'responseTy',
        'pxrPm',
        'Dnmlx',
        'get',
        'model',
        'nLINs',
        'finish',
        'whatsappId',
        'type',
        '171wHYOLu',
        'EqXKI',
        'where',
        'uuid',
        'XrDrx',
        'split',
        'mediaUrl',
        'wEgcG',
        'chat:creat',
        'iXdEI',
        'mime',
        'public',
        'pipe',
        'path',
        'ZYFFo',
        'recursive',
        'ggDGE',
        'EkjbO',
        'NjyFS',
        '../../util',
        'uOmKT',
        'NG_MESSAGE',
        'ihonu',
        'gTTOw',
        'XahQp',
        'AkSnh',
        'YTHJQ',
        'vfqsT',
        'contactId',
        'TkcNr',
        'nEKMe',
        'AdaSG',
        'wLyDk',
        'Emit',
        'KjAbX',
        'myrMT',
        'LOAD',
        'gVTRL',
        'DnDla',
        'EPdPm',
        'QqSHa',
        'DUqxi',
        'ilDtJ',
        'vnqyi',
        'mWgie',
        'CsdQo',
        'createWrit',
        'ERROR\x20DONW',
        'fault',
        'HCiob',
        'mimetype',
        'ers/socket',
        'filename',
        '_SYSTEM',
        'include',
        'DHVzX',
        'amySn',
        'BiDJk',
        'LDzfy',
        'spJgJ',
        'amENH',
        'data',
        'idation',
        'pygAd',
        'ls/Message',
        'update',
        'scheduleDa',
        'API',
        'FqqLM',
        'ERR_CREATI',
        'media',
        's/logger',
        'aHwVd',
        'rtprL',
        'logger',
        'GEVNH',
        '1009869wjsQyN',
        'yVCdb',
        'CZZQh',
        '1348488CJYzfX',
        'ls/Ticket',
        'headers',
        'contact',
        'mediaType',
        'JkHpb',
        'GVamK',
        'Chhbd',
        'gcSHL',
        '../../help',
        'ers/Mustac',
        'hoQAz',
        'body',
        'fromMe',
        '../../mode',
        'Vwdlx',
        'extension',
        'originalna',
        'AHMWU',
        'content-ty',
        'yhCCv',
        'fOxej',
        'rmdirSync',
        'tenantId',
        'NtdFN',
        'wKyfM',
        'getTime',
        '__esModule',
        'PJxTz',
        'unknown',
        'map',
        '30NjxAMB',
        'eswYF',
        'uWTQa',
        'JDwYa',
        'qtLaA'
    ];
    a = function () {
        return ag;
    };
    return a();
}
C[T(0xeb)] = !![], Object[U(0xda) + U(0xe5)](exports, T(0x167), C);
const fs_1 = __importDefault(require('fs')), path_1 = require(U(0x10a)), axios_1 = __importDefault(require(U(0x17a))), mime_1 = __importDefault(require(T(0x107))), uuid_1 = require(U(0x100)), logger_1 = require(U(0x110) + T(0x144)), Ticket_1 = __importDefault(require(U(0x15a) + U(0x14d))), Message_1 = __importDefault(require(T(0x15a) + U(0x13d))), socketEmit_1 = __importDefault(require(T(0x155) + T(0x130) + T(0x11e))), Mustache_1 = __importDefault(require(U(0x155) + T(0x156) + 'he')), queueValidation_1 = __importDefault(require(U(0x110) + U(0xe0) + T(0x13b))), downloadMedia = async e => {
        const W = T, X = U, f = {
                'hoQAz': W(0x142) + X(0x112) + W(0x132),
                'gcSHL': function (g, h) {
                    return g(h);
                },
                'YTHJQ': function (g, h) {
                    return g !== h;
                },
                'pxrPm': W(0x14b),
                'XrDrx': W(0x12c) + W(0x121),
                'vfqsT': X(0x175),
                'MKLuQ': W(0x16c),
                'wEgcG': function (g, h) {
                    return g(h);
                },
                'aHwVd': W(0x141),
                'mWgie': W(0xfe),
                'Dnmlx': W(0xfa),
                'AdaSG': W(0x182),
                'OtOIU': W(0x11a),
                'NjyFS': W(0xe1),
                'ZYFFo': X(0x15f) + 'pe',
                'myrMT': W(0x108),
                'QwwsS': function (g, h) {
                    return g !== h;
                },
                'QMNlQ': W(0x127)
            };
        try {
            if (f[W(0x117)](f[W(0xd8)], f[W(0xd8)]))
                throw new d(f[X(0x157)]);
            else {
                const h = {};
                h[W(0xf4) + 'pe'] = f[X(0x10f)];
                const i = await axios_1[X(0x177)][X(0xf7)](e[W(0x103)], h), j = i[X(0x14e)][f[X(0x10b)]], k = mime_1[X(0x177)], l = k[W(0x15c)](j), m = (-0x1da8 + -0xce7 + 0x2a8f, uuid_1['v4'])(), n = (-0x1f7 * 0x1 + 0x6b4 + -0x4bd * 0x1, path_1[W(0x17c)])(__dirname, '..', '..', '..', f[W(0x120)]), o = m + '.' + l, p = (0x16c1 + -0x3 * 0x9e5 + 0x6ee, path_1[W(0x17c)])(n, o), q = {};
                q[W(0x15d) + 'me'] = o, q[X(0x131)] = o, q[X(0x150)] = l;
                const r = q;
                return await new Promise((s, t) => {
                    const Y = W, a0 = W, u = {
                            'JDwYa': f[Y(0x157)],
                            'pygAd': function (v, w) {
                                const Z = Y;
                                return f[Z(0x117)](v, w);
                            },
                            'AkSnh': f[a0(0x118)],
                            'GVamK': f[Y(0x184)],
                            'EPdPm': function (v, w) {
                                const a1 = a0;
                                return f[a1(0x104)](v, w);
                            }
                        };
                    f[Y(0x117)](f[Y(0x145)], f[Y(0x129)]) ? i[a0(0x13a)][a0(0x109)](fs_1[a0(0x177)][a0(0x12b) + Y(0xe4)](p))['on'](f[a0(0xf6)], async () => {
                        const a2 = Y, a3 = Y, v = {};
                        v[a2(0x126)] = u[a2(0x16e)];
                        const w = v;
                        if (u[a3(0x13c)](u[a3(0x116)], u[a3(0x152)]))
                            u[a3(0x124)](s, r);
                        else
                            throw new q(w[a3(0x126)]);
                    })['on'](f[a0(0x11c)], v => {
                        const a5 = a0, a6 = Y, w = {
                                'AMKKX': function (x, y) {
                                    const a4 = b;
                                    return f[a4(0x154)](x, y);
                                }
                            };
                        if (f[a5(0x117)](f[a5(0xf5)], f[a6(0xf5)]))
                            w[a5(0xde)](e, f);
                        else {
                            console[a5(0x182)](f[a6(0x101)], v);
                            const y = {};
                            y[a6(0x10c)] = !![], fs_1[a6(0x177)][a6(0x162)](p, y), f[a5(0x154)](t, new Error(v));
                        }
                    }) : e[a0(0x147)][a0(0x182)](f);
                }), r;
            }
        } catch (s) {
            if (f[X(0xec)](f[W(0xdf)], f[W(0xdf)])) {
                const u = f[X(0x12f)][W(0x102)]('/')[0x24ed + -0x82a * 0x4 + 0xb6 * -0x6][X(0x102)](';')[-0x719 + 0x18de + -0x11c5];
                g[W(0x131)] = new h()[X(0x166)]() + '.' + u;
            } else
                throw new Error(s);
        }
    }, CreateMessageSystemService = async ({
        msg: k,
        tenantId: l,
        medias: m,
        ticket: n,
        userId: o,
        scheduleDate: p,
        sendType: q,
        status: r,
        idFront: s
    }) => {
        const a7 = T, a8 = U, t = {
                'udRZa': a7(0x142) + a8(0x112) + a7(0x132),
                'CsdQo': a7(0x12c) + a8(0x121),
                'spJgJ': function (v, w) {
                    return v(w);
                },
                'iXdEI': a8(0xfa),
                'qtLaA': a8(0x182),
                'nQlKE': a8(0x178) + a7(0xf3) + a8(0xe7),
                'nCyfB': function (v, w) {
                    return v === w;
                },
                'NtGsw': a7(0x16d),
                'KjAbX': a8(0xf9),
                'grHFz': a7(0x160),
                'LDzfy': function (v, w) {
                    return v !== w;
                },
                'JkHpb': a8(0x111),
                'AHMWU': a7(0x148),
                'Chhbd': a8(0xe9),
                'jXyMz': a8(0x14f),
                'Vwdlx': a8(0xee),
                'amENH': a7(0x11d),
                'gTTOw': a7(0x171),
                'vnqyi': a7(0x105) + 'e',
                'DHVzX': function (v, w) {
                    return v === w;
                },
                'amySn': a7(0x165),
                'QqSHa': a7(0x123),
                'yVCdb': function (v, w) {
                    return v === w;
                },
                'rtprL': a7(0x140),
                'XahQp': a7(0x179),
                'fOxej': function (v, w) {
                    return v === w;
                },
                'NtdFN': a7(0xef),
                'nEKMe': a8(0xf2),
                'gVTRL': a8(0xd7),
                'BFjwP': a8(0xf1),
                'HCiob': a8(0x10d),
                'FHTNd': a7(0x168),
                'BiDJk': a7(0x180),
                'EkjbO': a7(0x169)
            }, u = {
                'ticketId': n['id'],
                'body': k[a7(0x158)],
                'contactId': k?.[a7(0x159)] ? null : n[a8(0x119)],
                'fromMe': t[a7(0x14a)](q, t[a8(0x146)]) ? !![] : k?.[a7(0x159)],
                'read': !![],
                'mediaType': t[a7(0x115)],
                'mediaUrl': undefined,
                'timestamp': new Date()[a8(0x166)](),
                'quotedMsgId': k?.[a7(0xee)]?.['id'],
                'userId': o,
                'scheduleDate': p,
                'sendType': q,
                'status': r,
                'tenantId': l,
                'idFront': s
            };
        try {
            u[a8(0x158)] = await (0x1c39 + 0x1ca6 + 0xd3 * -0x45, Mustache_1[a7(0x177)])(k[a7(0x158)], n[a8(0x14f)], n);
            if (t[a8(0x14a)](q, t[a8(0x146)]) && k[a8(0x103)]) {
                if (t[a7(0x161)](t[a8(0x164)], t[a7(0x11b)]))
                    throw new e(f);
                else {
                    m = [];
                    const w = await t[a7(0x138)](downloadMedia, k);
                    m[a8(0xdb)](w);
                }
            }
            if (t[a8(0xe8)](q, t[a8(0x122)]) && k[a8(0x103)]) {
                if (t[a7(0x137)](t[a8(0xdd)], t[a7(0x12e)])) {
                    m = [];
                    const x = await t[a8(0x138)](downloadMedia, k);
                    m[a7(0xdb)](x);
                } else
                    throw new d(t[a7(0xe2)]);
            }
            if (t[a7(0x14a)](q, t[a8(0x146)]) && !k[a7(0x103)] && k[a7(0x143)]) {
                if (t[a7(0x134)](t[a8(0x185)], t[a7(0x136)])) {
                    const A = {
                        'ihonu': function (B, D) {
                            const a9 = a7;
                            return t[a9(0x138)](B, D);
                        }
                    };
                    m[a8(0x13a)][a7(0x109)](n[a7(0x177)][a7(0x12b) + a8(0xe4)](o))['on'](t[a7(0x106)], async () => {
                        const aa = a7;
                        A[aa(0x113)](w, x);
                    })['on'](t[a8(0x16f)], E => {
                        const ab = a7, ac = a8;
                        w[ab(0x182)](t[ac(0x12a)], E);
                        const F = {};
                        F[ac(0x10c)] = !![], x[ab(0x177)][ab(0x162)](y, F), t[ab(0x138)](z, new A(E));
                    });
                } else
                    m = [], m[a7(0xdb)](k[a7(0x143)]);
            }
            if (m)
                await Promise[a8(0x17b)](m[a8(0x16a)](async A => {
                    const ad = a8, af = a7, B = {
                            'tkotS': t[ad(0x12a)],
                            'TcOla': function (J, K) {
                                const ae = ad;
                                return t[ae(0x138)](J, K);
                            }
                        };
                    try {
                        if (t[af(0xe8)](t[ad(0x181)], t[ad(0x11f)])) {
                            j[ad(0x182)](B[af(0xe3)], k);
                            const K = {};
                            K[af(0x10c)] = !![], l[af(0x177)][ad(0x162)](m, K), B[af(0x17e)](n, new o(p));
                        } else {
                            if (!A[af(0x131)]) {
                                if (t[af(0xe8)](t[af(0x172)], t[af(0x172)])) {
                                    const K = A[af(0x12f)][ad(0x102)]('/')[-0x4a3 * -0x2 + -0x7 * -0x482 + 0x5d5 * -0x7][ad(0x102)](';')[0x112 + 0x6d3 * -0x1 + 0x5c1];
                                    A[ad(0x131)] = new Date()[af(0x166)]() + '.' + K;
                                } else
                                    I[ad(0x147)][af(0x182)](t[af(0x173)], f);
                            }
                        }
                    } catch (M) {
                        if (t[ad(0x137)](t[ad(0x151)], t[ad(0x15e)]))
                            logger_1[af(0x147)][af(0x182)](M);
                        else {
                            if (!g[ad(0x131)]) {
                                const O = k[ad(0x12f)][af(0x102)]('/')[-0x1 * 0x1997 + -0xcd * -0x6 + 0x14ca][af(0x102)](';')[0x27 * 0x40 + -0x1 * -0x1003 + -0x19c3 * 0x1];
                                l[af(0x131)] = new m()[ad(0x166)]() + '.' + O;
                            }
                        }
                    }
                    const D = {
                            ...u,
                            'body': '\x20',
                            'mediaUrl': A[ad(0x131)],
                            'mediaType': A[ad(0x150)] || A[ad(0x12f)][af(0x174)](0x1412 + 0x1 * -0x1556 + 0x144, A[ad(0x12f)][ad(0xe6)]('/'))
                        }, E = await Message_1[af(0x177)][ad(0x183)](D), F = {};
                    F[ad(0x163)] = l;
                    const G = {};
                    G[af(0xf8)] = Ticket_1[ad(0x177)], G['as'] = t[af(0x153)], G[ad(0xff)] = F, G[af(0x133)] = [t[ad(0x17f)]];
                    const H = await Message_1[ad(0x177)][af(0x170)](E['id'], {
                        'include': [
                            G,
                            {
                                'model': Message_1[af(0x177)],
                                'as': t[af(0x15b)],
                                'include': [t[af(0x17f)]]
                            }
                        ]
                    });
                    if (!H) {
                        if (t[af(0xe8)](t[ad(0x139)], t[ad(0x114)]))
                            f = [], g[ad(0xdb)](h[ad(0x143)]);
                        else
                            throw new Error(t[ad(0xe2)]);
                    }
                    await n[ad(0x13e)]({
                        'lastMessage': H[ad(0x158)],
                        'lastMessageAt': new Date()[af(0x166)]()
                    });
                    const I = {};
                    I[af(0x163)] = l, I[ad(0xfc)] = t[af(0x128)], I[ad(0x17d)] = H, (-0xab9 + 0x1909 + -0x2 * 0x728, socketEmit_1[ad(0x177)])(I);
                    if (!H[af(0x13f) + 'te']) {
                        if (t[ad(0x134)](t[af(0x135)], t[ad(0x125)])) {
                            const Q = {};
                            return Q[af(0x177)] = j, g && h[ad(0x167)] ? i : Q;
                        } else
                            await (-0xa * -0x345 + 0xcd7 + -0x2d89, queueValidation_1[af(0x177)])(n[af(0xfb)], l, [H]);
                    }
                    return H;
                }));
            else {
                if (k[a8(0x103)]) {
                    const H = mime_1[a8(0x177)][a7(0xd6)](k[a8(0x103)]), I = {
                            'originalname': k[a7(0x103)],
                            'filename': k[a8(0x103)],
                            'mediaType': H ? H[a7(0x102)]('/')[-0x1d59 + 0xfa9 + -0x3 * -0x490] : t[a7(0x10e)]
                        }, J = { ...u };
                    J[a8(0x103)] = I[a8(0x131)], J[a7(0x150)] = I[a8(0x150)];
                    const K = J, L = await Message_1[a7(0x177)][a7(0x183)](K), M = {};
                    M[a8(0x163)] = l;
                    const N = {};
                    N[a7(0xf8)] = Ticket_1[a7(0x177)], N['as'] = t[a7(0x153)], N[a7(0xff)] = M, N[a7(0x133)] = [t[a7(0x17f)]];
                    const O = await Message_1[a7(0x177)][a8(0x170)](L['id'], {
                        'include': [
                            N,
                            {
                                'model': Message_1[a8(0x177)],
                                'as': t[a7(0x15b)],
                                'include': [t[a7(0x17f)]]
                            }
                        ]
                    });
                    if (!O)
                        throw new Error(t[a7(0xe2)]);
                    await n[a7(0x13e)]({
                        'lastMessage': O[a8(0x158)],
                        'lastMessageAt': new Date()[a7(0x166)]()
                    });
                    const P = {};
                    return P[a7(0x163)] = l, P[a8(0xfc)] = t[a8(0x128)], P[a8(0x17d)] = O, (0x1 * 0x9a9 + 0x43 * -0x82 + 0x3 * 0x81f, socketEmit_1[a7(0x177)])(P), !O[a8(0x13f) + 'te'] && await (-0x1b8b + 0xcfe * 0x2 + 0x1 * 0x18f, queueValidation_1[a8(0x177)])(n[a8(0xfb)], l, [O]), O;
                }
                const A = { ...u };
                A[a8(0x150)] = t[a7(0x115)];
                const B = await Message_1[a7(0x177)][a8(0x183)](A), D = {};
                D[a7(0x163)] = l;
                const E = {};
                E[a7(0xf8)] = Ticket_1[a8(0x177)], E['as'] = t[a8(0x153)], E[a7(0xff)] = D, E[a7(0x133)] = [t[a7(0x17f)]];
                const F = await Message_1[a8(0x177)][a8(0x170)](B['id'], {
                    'include': [
                        E,
                        {
                            'model': Message_1[a8(0x177)],
                            'as': t[a7(0x15b)],
                            'include': [t[a8(0x17f)]]
                        }
                    ]
                });
                if (!F)
                    throw new Error(t[a7(0xe2)]);
                await n[a8(0x13e)]({
                    'lastMessage': F[a8(0x158)],
                    'lastMessageAt': new Date()[a7(0x166)](),
                    'answered': !![]
                }), F[a7(0xe9)] = n;
                const G = {};
                return G[a7(0x163)] = l, G[a7(0xfc)] = t[a7(0x128)], G[a7(0x17d)] = F, (-0x236a + -0x18c4 + 0x3c2e, socketEmit_1[a8(0x177)])(G), !F[a7(0x13f) + 'te'] && await (0x23fe + -0x1e59 * -0x1 + -0x4257, queueValidation_1[a8(0x177)])(n[a8(0xfb)], l, [F]), F;
            }
        } catch (Q) {
            logger_1[a7(0x147)][a8(0x182)](t[a7(0x173)], Q);
        }
    };
exports[U(0x177)] = CreateMessageSystemService;