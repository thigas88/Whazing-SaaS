(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[40],{c124:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return"admin"===t.userProfile?e("div",[e("div",{staticClass:"bg-white mass-container container-rounded-10"},[e("div",{staticClass:"row col full-width q-pa-lg"},[e("q-card",{staticClass:"full-width",attrs:{flat:"",bordered:""}},[e("q-card-section",{staticClass:"text-h6 text-bold"},[e("h2",{class:t.$q.dark.isActive?"text-green":""},[e("q-icon",{attrs:{name:"mdi-cellphone-wireless q-pr-sm"}}),t._v("\n            Canais de Comunicação\n          ")],1),e("div",{staticClass:"q-pa-sm"},[e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{flat:"",icon:"eva-plus-outline",label:"Adicionar Canal"},on:{click:function(e){t.modalWhatsapp=!0}}}),e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{flat:"",icon:"mdi-restart",label:"Reiniciar Conexões"},on:{click:t.reiniciarConexoes}}),e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{flat:"",icon:"mdi-cog",label:"Token Hub"},on:{click:function(e){t.modalHub=!0}}}),t.whatsappNumber?e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{flat:"",icon:"mdi-whatsapp",label:"Chamar Suporte"},on:{click:t.abrirWhatsApp}}):t._e()],1)])],1)],1),e("div",{staticClass:"container-border q-ma-lg q-pb-md container-rounded-10"},[e("q-card-section",[e("h2",{class:t.$q.dark.isActive?"text-green":""},[e("q-icon",{attrs:{name:"eva-list-outline q-pr-sm"}}),t._v("\n          Listagem\n        ")],1)]),e("div",{staticClass:"row full-width q-px-md"},[t._l(t.canais,(function(a){return[e("q-card",{key:a.id,staticClass:"col-xs-12 col-sm-5 col-md-4 col-lg-3",attrs:{flat:"",bordered:""}},[e("q-item",[e("q-item-section",{attrs:{avatar:""}},[e("q-avatar",[e("q-icon",{attrs:{size:"40px",name:`img:${a.type}-logo.png`}})],1)],1),e("q-item-section",[e("q-item-label",{staticClass:"text-h6 text-bold"},[t._v(t._s(a.name))]),e("q-item-label",{staticClass:"text-h6 text-caption"},[t._v("\n                  "+t._s(a.type)+"\n                ")])],1),e("q-item-section",{attrs:{side:""}},[t.isAdmin?e("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"eva-edit-outline"},on:{click:function(e){return t.handleOpenModalWhatsapp(a)}}}):t._e()],1)],1),e("q-separator"),e("q-card-section",[e("ItemStatusChannel",{attrs:{item:a}})],1),e("q-card-section",[e("q-select",{attrs:{rounded:"",outlined:"",dense:"",label:"ChatBot",options:t.listaChatFlow,"map-options":"","emit-value":"","option-value":"id","option-label":"name",clearable:""},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.chatFlowId,callback:function(e){t.$set(a,"chatFlowId",e)},expression:"item.chatFlowId"}})],1),e("q-card-section",[e("q-select",{attrs:{rounded:"",outlined:"",dense:"",label:"Fila",options:t.listaFila,"map-options":"","emit-value":"","option-value":"id","option-label":"queue",clearable:""},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.queueId,callback:function(e){t.$set(a,"queueId",e)},expression:"item.queueId"}},[e("q-tooltip",[t._v("\n                  Será atribuido essa fila para novos tickets\n                ")])],1)],1),e("q-card-section",[e("q-select",{attrs:{rounded:"",outlined:"",dense:"",label:"Usuário",options:t.listaUsuario,"map-options":"","emit-value":"","option-value":"id","option-label":"name",clearable:""},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.userId,callback:function(e){t.$set(a,"userId",e)},expression:"item.userId"}},[e("q-tooltip",[t._v("\n                  Será atribuido esse usuário para novos tickets, BOT não vai acionar\n                ")])],1)],1)],1),"DISCONNECTED"!=a.status&&"qrcode"!=a.status||"whatsapp"!=a.type?t._e():e("q-checkbox",{attrs:{label:"Importar mensagens ao LER QRCODE"},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.importmessages,callback:function(e){t.$set(a,"importmessages",e)},expression:"item.importmessages"}}),e("q-card-section",["DISCONNECTED"!=a.status&&"qrcode"!=a.status||"whatsapp"!=a.type||!0!==a.importmessages?t._e():e("DatePick",{attrs:{rounded:"",dense:"","hide-bottom-space":"",outlined:"","stack-label":"","bottom-slots":"",label:"Data de inicio da importação"},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.importOldMessages,callback:function(e){t.$set(a,"importOldMessages",e)},expression:"item.importOldMessages"}})],1),e("q-card-section",["DISCONNECTED"!=a.status&&"qrcode"!=a.status||"whatsapp"!=a.type||!0!==a.importmessages?t._e():e("DatePick",{attrs:{rounded:"",dense:"","hide-bottom-space":"",outlined:"","stack-label":"","bottom-slots":"",label:"Data de termino da importação"},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.importRecentMessages,callback:function(e){t.$set(a,"importRecentMessages",e)},expression:"item.importRecentMessages"}})],1),"DISCONNECTED"!=a.status&&"qrcode"!=a.status||"whatsapp"!=a.type||!0!==a.importmessages?t._e():e("q-checkbox",{attrs:{label:"Importar mensagens de GRUPO"},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.importOldMessagesGroups,callback:function(e){t.$set(a,"importOldMessagesGroups",e)},expression:"item.importOldMessagesGroups"}}),"DISCONNECTED"!=a.status&&"qrcode"!=a.status||"whatsapp"!=a.type||!0!==a.importmessages?t._e():e("q-checkbox",{attrs:{label:"Encerrar tickets após importação"},on:{input:function(e){return t.handleSaveWhatsApp(a)}},model:{value:a.closedTicketsPostImported,callback:function(e){t.$set(a,"closedTicketsPostImported",e)},expression:"item.closedTicketsPostImported"}}),e("q-separator"),e("q-card-actions",{staticClass:"q-gutter-md q-pa-sm q-pt-none",attrs:{align:"center"}},["messenger"!==a.type?["whatsapp"==a.type&&"qrcode"==a.status?e("q-btn",{staticClass:"btn-rounded-50 q-mx-sm",attrs:{color:"primary",label:"QR Code","icon-right":"mdi-qrcode-scan",disable:!t.isAdmin},on:{click:function(e){return t.handleOpenQrModal(a,"btn-qrCode")}}}):t._e(),"DISCONNECTED"==a.status?e("div",{staticClass:"q-gutter-sm"},["whatsapp"!=a.type?e("q-btn",{staticClass:"btn-rounded-50 q-mx-sm",attrs:{color:"positive",label:"Conectar"},on:{click:function(e){return t.handleStartWhatsAppSession(a.id)}}}):t._e(),"DISCONNECTED"==a.status&&"whatsapp"==a.type?e("q-btn",{staticClass:"btn-rounded-50 q-mx-sm",attrs:{color:"primary",label:"Novo QR Code","icon-right":"mdi-qrcode-scan",disable:!t.isAdmin},on:{click:function(e){return t.handleRequestNewQrCode(a,"btn-qrCode")}}}):t._e()],1):t._e(),"OPENING"==a.status?e("div",{staticClass:"row items-center q-gutter-sm flex flex-inline"},[e("div",{staticClass:"text-bold"},[t._v("\n                  Conectando\n                ")]),e("q-spinner-radio",{attrs:{color:"positive",size:"2em"}}),e("q-separator",{attrs:{vertical:"",spaced:""}})],1):t._e(),["OPENING","CONNECTED","PAIRING","TIMEOUT"].includes(a.status)&&!a.type.includes("hub")?e("q-btn",{staticClass:"btn-rounded-50 q-mx-sm",attrs:{color:"negative",label:"Desconectar",icon:"eva-wifi-off-outline",disable:!t.isAdmin},on:{click:function(e){return t.handleDisconectWhatsSession(a.id)}}}):t._e()]:t._e(),e("q-btn",{staticClass:"absolute-bottom-right",attrs:{color:"negative",icon:"eva-trash-outline",disable:!t.isAdmin,dense:"",round:"",flat:""},on:{click:function(e){return t.deleteWhatsapp(a)}}},[e("q-tooltip",[t._v("\n                Deletar conexão\n              ")])],1)],2)]}))],2)],1),e("ModalHub",{model:{value:t.modalHub,callback:function(e){t.modalHub=e},expression:"modalHub"}}),e("ModalQrCode",{attrs:{abrirModalQR:t.abrirModalQR,channel:t.cDadosWhatsappSelecionado},on:{"update:abrirModalQR":function(e){t.abrirModalQR=e},"update:abrir-modal-q-r":function(e){t.abrirModalQR=e},"gerar-novo-qrcode":e=>t.handleRequestNewQrCode(e,"btn-qrCode")}}),e("ModalWhatsapp",{attrs:{modalWhatsapp:t.modalWhatsapp,whatsAppEdit:t.whatsappSelecionado},on:{"update:modalWhatsapp":function(e){t.modalWhatsapp=e},"update:modal-whatsapp":function(e){t.modalWhatsapp=e},"update:whatsAppEdit":function(e){t.whatsappSelecionado=e},"update:whats-app-edit":function(e){t.whatsappSelecionado=e},"recarregar-lista":t.listarWhatsapps}}),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)]):t._e()},i=[],o=a("5c26"),n=a("b166"),r=a("e3ee"),l=a("d9d6"),c=a.n(l),p=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{value:t.abrirModalQR,persistent:""},on:{hide:t.fecharModalQrModal}},[e("q-card",{staticClass:"container-rounded-10"},[e("q-card-section",[e("div",{staticClass:"text-h6 font-family-main text-center"},[t._v("\n        Leia o QRCode para iniciar a sessão\n        "),e("q-btn",{staticClass:"q-ml-md float-right",attrs:{round:"",flat:"",color:"negative",icon:"eva-close"},on:{click:t.fecharModalQrModal}})],1)]),e("q-card-section",{staticClass:"text-center q-ma-lg container-rounded-10 container-border",style:t.$q.dark.isActive?"background: white !important":""},[t.cQrcode?e("QrcodeVue",{attrs:{value:t.cQrcode,size:300,level:"H"}}):e("span",[e("span",{staticStyle:{"font-size":"10px"}},[t._v("\n          AGUARDANDO A LEITURA DO QRCODE...\n        ")])])],1),e("q-card-section",[e("div",{staticClass:"text-center q-mb-lg",staticStyle:{"font-size":"14px"}},[t._v("Caso tenha problema com a leitura, solicite um novo QRCode ")]),e("div",{staticClass:"row col-12 justify-center"},[e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{label:"Novo QR Code",icon:"mdi-qrcode"},on:{click:t.solicitarQrCode}})],1)])],1)],1)},d=[],u=a("d7b0"),h={name:"ModalQrCode",components:{QrcodeVue:u["a"]},props:{abrirModalQR:{type:Boolean,default:!1},channel:{type:Object,default:()=>({id:null,qrcode:""})}},watch:{channel:{handler(t){"CONNECTED"===this.channel.status&&this.fecharModalQrModal()},deep:!0}},computed:{cQrcode(){return this.channel.qrcode}},methods:{solicitarQrCode(){this.$emit("gerar-novo-qrcode",this.channel),this.fecharModalQrModal(),setTimeout((()=>{window.location.reload()}),1e3)},fecharModalQrModal(){this.$emit("update:abrirModalQR",!1)}}},m=h,g=a("2877"),b=a("24e8"),v=a("f09f"),w=a("a370"),f=a("9c40"),q=a("eebe"),C=a.n(q),y=Object(g["a"])(m,p,d,!1,null,"2b63be14",null),S=y.exports;C()(y,"components",{QDialog:b["a"],QCard:v["a"],QCardSection:w["a"],QBtn:f["a"]});var k=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{value:t.value,persistent:""},on:{hide:t.close}},[e("q-card",{staticClass:"container-rounded-10 q-pa-md",staticStyle:{width:"500px"}},[e("q-card-section",{staticClass:"row q-col-gutter-md"},[e("div",{staticClass:"text-h6"},[t._v("Alterar Hub Token")])]),e("q-card-section",{staticClass:"row q-col-gutter-md"},[e("q-input",{staticClass:"col-12",attrs:{label:"Hub Token"},model:{value:t.hubToken,callback:function(e){t.hubToken=e},expression:"hubToken"}})],1),e("q-card-actions",{attrs:{align:"right"}},[e("q-btn",{attrs:{flat:"",label:"Cancelar"},on:{click:t.close}}),e("q-btn",{attrs:{flat:"",label:"Salvar",color:"primary"},on:{click:t.saveHubToken}})],1)],1)],1)},x=[],M=a("7963"),_={name:"HubModal",props:{value:{type:Boolean,default:!1}},data(){return{hubToken:""}},methods:{async listarConfiguracoes(){try{const{data:t}=await Object(M["b"])(),e=t.find((t=>"hubToken"===t.key));e&&(this.hubToken=e.value)}catch(t){this.$q.notify({type:"negative",message:"Erro ao carregar configuração do Hub Token",progress:!0})}},close(){this.$emit("input",!1),this.hubToken=""},async saveHubToken(){const t={key:"hubToken",value:this.hubToken};try{await Object(M["a"])(t),this.$q.notify({type:"positive",message:"Hub Token alterado com sucesso!",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.$emit("input",!1),this.close()}catch(e){this.$q.notify({type:"negative",message:"Erro ao salvar Hub Token",progress:!0})}}},watch:{value(t){t&&this.listarConfiguracoes()}}},T=_,O=a("27f9"),E=a("4b7e"),I=Object(g["a"])(T,k,x,!1,null,null,null),A=I.exports;C()(I,"components",{QDialog:b["a"],QCard:v["a"],QCardSection:w["a"],QInput:O["a"],QCardActions:E["a"],QBtn:f["a"]});var N=a("2f62"),$=function(){var t=this,e=t._self._c;return e("q-dialog",{attrs:{value:t.modalWhatsapp,persistent:""},on:{hide:t.fecharModal,show:t.abrirModal}},[e("q-card",{staticClass:"q-pa-md",staticStyle:{width:"500px"}},[e("q-card-section",[e("div",{staticClass:"text-h6"},[e("q-icon",{staticClass:"q-mr-md",attrs:{size:"50px",name:t.whatsapp.type?`img:${t.whatsapp.type}-logo.png`:"mdi-alert"}}),t._v(" "+t._s(t.whatsapp.id?"Editar":"Adicionar")+"\n        Canal\n      ")],1)]),e("q-card-section",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 q-my-sm"},[e("q-select",{attrs:{disable:!!t.whatsapp.id,options:t.optionsWhatsappsTypes,label:"Tipo","emit-value":"","map-options":"",filled:""},model:{value:t.whatsapp.type,callback:function(e){t.$set(t.whatsapp,"type",e)},expression:"whatsapp.type"}})],1),e("div",{staticClass:"col-12"},[e("c-input",{attrs:{outlined:"",label:"Nome",validator:t.$v.whatsapp.name},on:{blur:t.$v.whatsapp.name.$touch},model:{value:t.whatsapp.name,callback:function(e){t.$set(t.whatsapp,"name",e)},expression:"whatsapp.name"}})],1),t.whatsapp.id?e("div",{staticClass:"col-12"},[e("q-input",{staticClass:"q-my-md",style:`background: ${t.whatsapp.color} `,attrs:{filled:"","hide-bottom-space":"",rules:["anyColor"],dark:!1,rounded:""},scopedSlots:t._u([{key:"preappend",fn:function(){},proxy:!0},{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"colorize"}},[e("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-color",{attrs:{"format-model":"hex",rounded:"","default-view":"palette","no-header":"",bordered:""},model:{value:t.whatsapp.color,callback:function(e){t.$set(t.whatsapp,"color",e)},expression:"whatsapp.color"}})],1)],1)]},proxy:!0}],null,!1,2866004907),model:{value:t.whatsapp.color,callback:function(e){t.$set(t.whatsapp,"color",e)},expression:"whatsapp.color"}})],1):t._e(),"hub"===t.whatsapp.type?e("div",{staticClass:"col-12 q-my-sm"},[e("q-select",{attrs:{rounded:"",outlined:"",dense:"",options:t.hubOptions,label:"Selecione um Hub",filled:""},model:{value:t.selectedHubOption,callback:function(e){t.selectedHubOption=e},expression:"selectedHubOption"}})],1):t._e(),"telegram"===t.whatsapp.type?e("div",{staticClass:"col-12 q-mt-md"},[e("c-input",{attrs:{outlined:"",label:"Token Telegram"},model:{value:t.whatsapp.tokenTelegram,callback:function(e){t.$set(t.whatsapp,"tokenTelegram",e)},expression:"whatsapp.tokenTelegram"}})],1):t._e(),"instagram"===t.whatsapp.type?e("div",{staticClass:"q-mt-md row full-width justify-center"},[e("div",{staticClass:"col"},[e("fieldset",{staticClass:"full-width q-pa-md"},[e("legend",[t._v("Dados da conta do Instagram")]),e("legend",[t._v("Somente use se seu servidor é no BRASIL")]),"instagram"===t.whatsapp.type?e("div",{staticClass:"col-12 q-mb-md"},[e("c-input",{attrs:{outlined:"",label:"Usuário",hint:"Seu usuário do Instagram (sem @)"},model:{value:t.whatsapp.instagramUser,callback:function(e){t.$set(t.whatsapp,"instagramUser",e)},expression:"whatsapp.instagramUser"}})],1):t._e(),"instagram"!==t.whatsapp.type||t.isEdit?t._e():e("div",{staticClass:"text-center"},[e("q-btn",{staticClass:"bg-padrao",attrs:{flat:"",color:"info",icon:"edit",label:"Nova senha"},on:{click:function(e){t.isEdit=!t.isEdit}}},[e("q-tooltip",[t._v("\n                    Alterar senha\n                  ")])],1)],1),"instagram"===t.whatsapp.type&&t.isEdit?e("div",{staticClass:"col-12"},[e("c-input",{attrs:{filled:"",label:"Senha",type:t.isPwd?"password":"text",hint:"Senha utilizada para logar no Instagram",placeholder:"*************",disable:!t.isEdit},scopedSlots:t._u([{key:"after",fn:function(){return[e("q-btn",{staticClass:"bg-padrao",attrs:{round:"",flat:"",color:"negative",icon:"mdi-close"},on:{click:function(e){t.isEdit=!t.isEdit}}},[e("q-tooltip",[t._v("\n                        Cancelar alteração de senha\n                      ")])],1)]},proxy:!0},{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"visibility_off":"visibility"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}],null,!1,4120386499),model:{value:t.whatsapp.instagramKey,callback:function(e){t.$set(t.whatsapp,"instagramKey",e)},expression:"whatsapp.instagramKey"}})],1):t._e()])])]):t._e()]),t.whatsapp.id?e("div",{staticClass:"row q-my-md"},[e("div",{staticClass:"col-12"},[e("label",{staticClass:"text-caption"},[t._v("Mensagem de Despedida do Atendimento:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.whatsapp.farewellMessage,expression:"whatsapp.farewellMessage"}],ref:"inputFarewellMessage",staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:t.whatsapp.farewellMessage},on:{input:function(e){e.target.composing||t.$set(t.whatsapp,"farewellMessage",e.target.value)}}})]),e("q-btn",{attrs:{round:"",flat:"",dense:""}},[e("q-icon",{attrs:{size:"2em",name:"mdi-variable"}}),e("q-tooltip",[t._v("\n            Variáveis\n          ")]),e("q-menu",{attrs:{"touch-position":""}},[e("q-list",{staticStyle:{"min-width":"100px"},attrs:{dense:""}},t._l(t.variaveis,(function(a){return e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:a.label,attrs:{clickable:""},on:{click:function(e){return t.onInsertSelectVariable(a.value)}}},[e("q-item-section",[t._v(t._s(a.label))])],1)})),1)],1)],1),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",flat:""}},[e("q-icon",{attrs:{size:"2em",name:"mdi-emoticon-happy-outline"}}),e("q-tooltip",[t._v("\n              Emoji\n            ")]),e("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[e("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:t.onInsertSelectEmoji}})],1)],1)],1):t._e(),t.whatsapp.id?e("q-checkbox",{attrs:{label:"Enviar mensagem aceitar TICKET"},model:{value:t.whatsapp.sendGreetingAccepted,callback:function(e){t.$set(t.whatsapp,"sendGreetingAccepted",e)},expression:"whatsapp.sendGreetingAccepted"}}):t._e(),1==t.whatsapp.sendGreetingAccepted?e("div",{staticClass:"row q-my-md"},[e("div",{staticClass:"col-12"},[e("label",{staticClass:"text-caption"},[t._v(" Mensagem para enviar ao aceitar TICKET")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.whatsapp.sendGreetingAcceptedMSG,expression:"whatsapp.sendGreetingAcceptedMSG"}],ref:"inputsendGreetingAcceptedMSG",staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:t.whatsapp.sendGreetingAcceptedMSG},on:{input:function(e){e.target.composing||t.$set(t.whatsapp,"sendGreetingAcceptedMSG",e.target.value)}}}),e("q-btn",{attrs:{round:"",flat:"",dense:""}},[e("q-icon",{attrs:{size:"2em",name:"mdi-variable"}}),e("q-tooltip",[t._v("\n            Variáveis\n          ")]),e("q-menu",{attrs:{"touch-position":""}},[e("q-list",{staticStyle:{"min-width":"100px"},attrs:{dense:""}},t._l(t.variaveis2,(function(a){return e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:a.label,attrs:{clickable:""},on:{click:function(e){return t.onInsertSelectVariable2(a.value)}}},[e("q-item-section",[t._v(t._s(a.label))])],1)})),1)],1)],1)],1)]):t._e(),t.whatsapp.id?e("q-checkbox",{attrs:{label:"Enviar mensagem transferir TICKET"},model:{value:t.whatsapp.sendMsgTransfTicket,callback:function(e){t.$set(t.whatsapp,"sendMsgTransfTicket",e)},expression:"whatsapp.sendMsgTransfTicket"}}):t._e(),1==t.whatsapp.sendMsgTransfTicket?e("div",{staticClass:"row q-my-md"},[e("div",{staticClass:"col-12"},[e("label",{staticClass:"text-caption"},[t._v("Mensagem para enviar ao transferir TICKET")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.whatsapp.sendMsgTransfTicketMSG,expression:"whatsapp.sendMsgTransfTicketMSG"}],ref:"inputsendMsgTransfTicketMSG",staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:t.whatsapp.sendMsgTransfTicketMSG},on:{input:function(e){e.target.composing||t.$set(t.whatsapp,"sendMsgTransfTicketMSG",e.target.value)}}}),e("q-btn",{attrs:{round:"",flat:"",dense:""}},[e("q-icon",{attrs:{size:"2em",name:"mdi-variable"}}),e("q-tooltip",[t._v("\n            Variáveis\n          ")]),e("q-menu",{attrs:{"touch-position":""}},[e("q-list",{staticStyle:{"min-width":"100px"},attrs:{dense:""}},t._l(t.variaveis2,(function(a){return e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:a.label,attrs:{clickable:""},on:{click:function(e){return t.onInsertSelectVariable3(a.value)}}},[e("q-item-section",[t._v(t._s(a.label))])],1)})),1)],1)],1)],1)]):t._e(),t.whatsapp.id?e("q-checkbox",{attrs:{label:"Habilitar avaliação de atendimento"},model:{value:t.whatsapp.rating,callback:function(e){t.$set(t.whatsapp,"rating",e)},expression:"whatsapp.rating"}}):t._e(),1==t.whatsapp.rating?e("div",{staticClass:"row q-my-md"},[e("div",{staticClass:"col-12"},[e("label",{staticClass:"text-caption"},[t._v("Mensagem para solicitar avaliação(nota do 1 ao 3):")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.whatsapp.ratingMessage,expression:"whatsapp.ratingMessage"}],staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:t.whatsapp.ratingMessage},on:{input:function(e){e.target.composing||t.$set(t.whatsapp,"ratingMessage",e.target.value)}}}),e("label",{staticClass:"text-caption"},[t._v("Mensagem após cliente avaliar atendimento:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.whatsapp.ratingClosing,expression:"whatsapp.ratingClosing"}],staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:t.whatsapp.ratingClosing},on:{input:function(e){e.target.composing||t.$set(t.whatsapp,"ratingClosing",e.target.value)}}}),e("label",{staticClass:"text-caption"},[t._v("Mensagem caso avaliação seja invalida:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.whatsapp.ratingInvalid,expression:"whatsapp.ratingInvalid"}],staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:t.whatsapp.ratingInvalid},on:{input:function(e){e.target.composing||t.$set(t.whatsapp,"ratingInvalid",e.target.value)}}}),e("label",{staticClass:"text-caption"},[t._v("Tempo em minutor que aguarda cliente avaliar:")]),e("div",{staticClass:"col-12"},[e("c-input",{attrs:{outlined:"",label:"Tempo",type:"number"},model:{value:t.whatsapp.timeRating,callback:function(e){t.$set(t.whatsapp,"timeRating",e)},expression:"whatsapp.timeRating"}})],1)])]):t._e(),t.whatsapp.id?e("q-checkbox",{attrs:{label:"Converter áudio em texto"},model:{value:t.whatsapp.transcription,callback:function(e){t.$set(t.whatsapp,"transcription",e)},expression:"whatsapp.transcription"}}):t._e(),1==t.whatsapp.transcription?e("div",{staticClass:"row q-my-md"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"col-12"},[e("c-input",{attrs:{outlined:"",label:"Chave da API Converter Áudio para Texto"},model:{value:t.whatsapp.transcriptionkey,callback:function(e){t.$set(t.whatsapp,"transcriptionkey",e)},expression:"whatsapp.transcriptionkey"}})],1),e("td",[e("a",{attrs:{href:"https://console.groq.com/keys",target:"_blank",rel:"noopener noreferrer"}},[t._v("Obter chave da API Converter Áudio para Texto")])])])]):t._e(),e("q-card-actions",{staticClass:"q-mt-lg",attrs:{align:"center"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-lg",attrs:{flat:"",label:"Sair",color:"negative"}}),e("q-btn",{staticClass:"q-px-md",attrs:{flat:"",label:"Salvar",color:"primary"},on:{click:function(e){return t.handleSaveWhatsApp(t.whatsapp)}}})],1)],1)],1)],1)},Q=[],D=a("b5ae"),P=a("8982");function W(t){return Object(P["a"])({url:"/hub-channel/",method:"post",data:t})}function R(){return Object(P["a"])({url:"/hub-channel/",method:"get"})}var G=a("446a"),j=a("cdde"),H=a("2a19"),F=a("79b5"),U={components:{cInput:G["a"],VEmojiPicker:F["a"]},name:"ModalWhatsapp",props:{modalWhatsapp:{type:Boolean,default:!1},whatsAppId:{type:Number,default:null},whatsAppEdit:{type:Object,default:()=>{}}},data(){return{isPwd:!0,isEdit:!1,hubOptions:[],selectedHubOption:null,whatsapp:{name:"",isDefault:!1,tokenTelegram:"",instagramUser:"",instagramKey:"",tokenAPI:"",type:"whatsapp",farewellMessage:"",ratingMessage:"",rating:!1,ratingClosing:"",ratingInvalid:"",timeRating:null,transcription:!1,transcriptionkey:"",sendMsgTransfTicket:!1,sendGreetingAcceptedMSG:"",sendGreetingAccepted:!1,sendMsgTransfTicketMSG:"",color:""},optionsWhatsappsTypes:[{label:"Whatsapp",value:"whatsapp"},{label:"Telegram",value:"telegram"},{label:"Hub Instagram - Facebook",value:"hub"}],variaveis:[{label:"Nome Completo",value:"{{name}}"},{label:"Nome",value:"{{firstName}}"},{label:"Saudação",value:"{{greeting}}"},{label:"Protocolo",value:"{{protocol}}"},{label:"Telefone",value:"{{phoneNumber}}"},{label:"Email do Contato",value:"{{email}}"},{label:"Numero Ticket",value:"{{ticket_id}}"},{label:"Hora",value:"{{hour}}"},{label:"Data",value:"{{date}}"},{label:"Fila",value:"{{fila}}"},{label:"Nome atendente",value:"{{user}}"},{label:"Email atendente",value:"{{userEmail}}"}],variaveis2:[{label:"Nome",value:"{{name}}"},{label:"Saudação",value:"{{greeting}}"},{label:"Telefone",value:"{{phoneNumber}}"},{label:"Email do Contato",value:"{{email}}"},{label:"Nome do Atendente",value:"{{user}}"}]}},validations:{whatsapp:{name:{required:D["required"],minLength:Object(D["minLength"])(3),maxLength:Object(D["maxLength"])(50)},isDefault:{}}},watch:{"whatsapp.type"(t){"hub"===t&&this.listarHubOptions()}},methods:{async listarHubOptions(){try{const t=await R();this.hubOptions=t.data.filter((t=>"facebook"===t.channel||"instagram"===t.channel||"webchat"===t.channel)).map((t=>({label:t.name,value:t})))}catch(t){console.error("Erro ao listar Hubs:",t)}},onInsertSelectEmoji(t){const e=this;var a=this.$refs.inputFarewellMessage,s=a.selectionStart,i=a.selectionEnd,o=s,n=a.value;t.data&&(e.txtContent=this.whatsapp.farewellMessage,e.txtContent=n.substring(0,s)+t.data+n.substring(i,n.length),this.whatsapp.farewellMessage=e.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=o+t.data.length}),10))},copy(t){Object(j["a"])(t).then(this.$notificarSucesso("URL de integração copiada!")).catch()},onInsertSelectVariable(t){const e=this;var a=this.$refs.inputFarewellMessage,s=a.selectionStart,i=a.selectionEnd,o=s,n=a.value;t&&(e.txtContent=this.whatsapp.farewellMessage,e.txtContent=n.substring(0,s)+t+n.substring(i,n.length),this.whatsapp.farewellMessage=e.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=o+1}),10))},onInsertSelectVariable2(t){const e=this;var a=this.$refs.inputsendGreetingAcceptedMSG,s=a.selectionStart,i=a.selectionEnd,o=s,n=a.value;t&&(e.txtContent=this.whatsapp.sendGreetingAcceptedMSG,e.txtContent=n.substring(0,s)+t+n.substring(i,n.length),this.whatsapp.sendGreetingAcceptedMSG=e.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=o+1}),10))},onInsertSelectVariable3(t){const e=this;var a=this.$refs.inputsendMsgTransfTicketMSG,s=a.selectionStart,i=a.selectionEnd,o=s,n=a.value;t&&(e.txtContent=this.whatsapp.sendMsgTransfTicketMSG,e.txtContent=n.substring(0,s)+t+n.substring(i,n.length),this.whatsapp.sendMsgTransfTicketMSG=e.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=o+1}),10))},fecharModal(){this.whatsapp={name:"",isDefault:!1,tokenTelegram:"",instagramUser:"",instagramKey:"",tokenAPI:"",type:"whatsapp",farewellMessage:"",ratingMessage:"",rating:!1,ratingClosing:"",ratingInvalid:"",timeRating:null,transcription:!1,sendMsgTransfTicket:!1,sendGreetingAcceptedMSG:"",sendGreetingAccepted:!1,sendMsgTransfTicketMSG:"",color:""},this.isEdit=!1,this.$emit("update:whatsAppEdit",{}),this.$emit("update:modalWhatsapp",!1)},abrirModal(){this.whatsAppEdit.id&&(this.whatsapp={...this.whatsAppEdit})},async handleSaveWhatsApp(t){if(this.$v.whatsapp.$touch(),"hub"!==t.type){if(this.$v.whatsapp.$error)return this.$q.notify({type:"warning",progress:!0,position:"top",message:"Ops! Verifique os erros...",actions:[{icon:"close",round:!0,color:"white"}]});try{this.whatsAppEdit.id?await Object(o["i"])(this.whatsAppEdit.id,t):await Object(o["a"])(t),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Whatsapp ${this.whatsAppEdit.id?"editado":"criado"} com sucesso!`,actions:[{icon:"close",round:!0,color:"white"}]}),this.$emit("recarregar-lista"),this.fecharModal()}catch(e){if(console.error(e,"ERR_NO_PERMISSION_CONNECTIONS_LIMIT"===e.data.error),"ERR_NO_PERMISSION_CONNECTIONS_LIMIT"!==e.data.error)return console.error(e),this.$q.notify({type:"error",progress:!0,position:"top",message:"Ops! Verifique os erros... O nome da conexão não pode existir na plataforma, é um identificador único.",actions:[{icon:"close",round:!0,color:"white"}]});H["a"].create({type:"negative",message:"Limite de conexões atingida.",caption:"ERR_NO_PERMISSION_CONNECTIONS_LIMIT",position:"top",progress:!0})}}else if("hub"===t.type){if(this.$v.whatsapp.$error)return this.$q.notify({type:"warning",progress:!0,position:"top",message:"Ops! Verifique os erros...",actions:[{icon:"close",round:!0,color:"white"}]});if(!this.selectedHubOption)return this.$q.notify({type:"warning",message:"Por favor, selecione um Hub antes de continuar.",position:"top",actions:[{icon:"close",round:!0,color:"white"}]});const t=this.selectedHubOption.value,a={name:this.whatsapp.name,status:"CONNECTED",isDefault:!1,type:"hub_"+t.channel,wabaId:t.id,number:t.id,profilePic:t.profile_pic,phone:t},s={channels:[a]};try{const t=await W(s);console.log(t),this.$q.notify({type:"positive",message:"Hub adicionado com sucesso!",position:"top"}),this.$emit("recarregar-lista"),this.fecharModal()}catch(e){console.error("Erro ao adicionar o Hub:",e),this.$q.notify({type:"negative",message:"Erro ao adicionar o Hub. Por favor, tente novamente.",position:"top"})}}}},destroyed(){this.$v.whatsapp.$reset()}},L=U,B=a("0016"),z=a("ddd8"),V=a("7cbe"),K=a("b498"),J=a("05c0"),X=a("8f8e"),Y=a("4e73"),Z=a("1c1c"),tt=a("66e5"),et=a("4074"),at=a("7f67"),st=Object(g["a"])(L,$,Q,!1,null,"6cfed192",null),it=st.exports;C()(st,"components",{QDialog:b["a"],QCard:v["a"],QCardSection:w["a"],QIcon:B["a"],QSelect:z["a"],QInput:O["a"],QPopupProxy:V["a"],QColor:K["a"],QBtn:f["a"],QTooltip:J["a"],QCheckbox:X["a"],QMenu:Y["a"],QList:Z["a"],QItem:tt["a"],QItemSection:et["a"],QCardActions:E["a"]}),C()(st,"directives",{ClosePopup:at["a"]});var ot=a("8039"),nt=a("824a"),rt=a("ee0e"),lt=a("9a1b"),ct=a("a0b3");const pt=JSON.parse(localStorage.getItem("usuario"));var dt={name:"IndexSessoesWhatsapp",components:{ModalQrCode:S,ModalWhatsapp:it,ModalHub:A,ItemStatusChannel:ot["a"]},data(){return{userProfile:"user",loading:!1,userLogado:pt,isAdmin:!1,abrirModalQR:!1,modalWhatsapp:!1,modalHub:!1,whatsappNumber:null,whatsappSelecionado:{},listaChatFlow:[],listaFila:[],listaUsuario:[],pageNumber:1,hasMore:!0,whatsAppId:null,canais:[],objStatus:{qrcode:""},columns:[{name:"name",label:"Nome",field:"name",align:"left"},{name:"status",label:"Status",field:"status",align:"center"},{name:"session",label:"Sessão",field:"status",align:"center"},{name:"number",label:"Número",field:"number",align:"center"},{name:"updatedAt",label:"Última Atualização",field:"updatedAt",align:"center",format:t=>this.formatarData(t,"dd/MM/yyyy HH:mm")},{name:"isDefault",label:"Padrão",field:"isDefault",align:"center"},{name:"acoes",label:"Ações",field:"acoes",align:"center"}],FB:{},FBscope:{},FBLoginOptions:{scope:"pages_manage_metadata,pages_messaging,instagram_basic,pages_show_list,pages_read_engagement,instagram_manage_messages"},FBPageList:[],fbSelectedPage:{name:null,id:null},fbPageName:"",fbUserToken:""}},watch:{whatsapps:{handler(){this.canais=JSON.parse(JSON.stringify(this.whatsapps))},deep:!0}},computed:{...Object(N["b"])(["whatsapps"]),cFbAppId(){return"23156312477653241"},cDadosWhatsappSelecionado(){const{id:t}=this.whatsappSelecionado;return this.whatsapps.find((e=>e.id===t))}},methods:{async fetchConfigurations(){try{const t=await Object(ct["b"])(),e=t.data;this.whatsappNumber=e.whatsappnumber||null}catch(t){console.error("Erro ao buscar configurações:",t)}},abrirWhatsApp(){if(this.whatsappNumber){const t=`https://wa.me/${this.whatsappNumber}?text=Ol%C3%A1%21+tenho+duvidas+conexão`;window.open(t,"_blank")}},async reiniciarConexoes(){try{await Object(o["e"])(),this.$q.notify({type:"positive",message:"Conexões reiniciadas com sucesso!"})}catch(t){this.$q.notify({type:"negative",message:"Erro ao reiniciar conexões!"}),console.error(t)}},formatarData(t,e){return Object(n["a"])(Object(r["a"])(t),e,{locale:c.a})},handleSdkInit({FB:t}){this.FB=t},async changeIaOption(t){const e={is_open_ia:t.is_open_ia,queurId:t.queue_transf};await Object(o["h"])(t.id,e)},async buscaFilas(){const{data:t}=await Object(rt["d"])();this.listaFila=t.filter((t=>t.isActive))},async listarUsuario(){try{const{data:t}=await Object(lt["e"])({pageNumber:this.pageNumber});this.listaUsuario=[...this.listaUsuario,...t.users],this.hasMore=t.hasMore,this.hasMore&&(this.pageNumber+=1,this.listarUsuario())}catch(t){console.error("Erro ao carregar usuários:",t)}},handleOpenQrModal(t){this.whatsappSelecionado=t,this.abrirModalQR=!0},handleOpenModalWhatsapp(t){this.whatsappSelecionado=t,this.modalWhatsapp=!0},async handleDisconectWhatsSession(t){this.$q.dialog({title:"Atenção!! Deseja realmente desconectar? ",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(o["c"])(t).then((()=>{const e=this.whatsapps.find((e=>e.id===t));this.$store.commit("UPDATE_WHATSAPPS",{...e,status:"DISCONNECTED"})})).finally((t=>{this.loading=!1}))}))},async handleStartWhatsAppSession(t){try{await Object(o["g"])(t)}catch(e){console.error(e)}},async handleRequestNewQrCode(t,e){"telegram"!==t.type||t.tokenTelegram||this.$notificarErro("Necessário informar o token para Telegram"),this.loading=!0;try{await Object(o["f"])({id:t.id,isQrcode:!0}),setTimeout((()=>{this.handleOpenQrModal(t)}),2e3)}catch(a){console.error(a)}this.loading=!1,setTimeout((()=>{window.location.reload()}),1e3)},async listarWhatsapps(){const{data:t}=await Object(o["d"])();this.$store.commit("LOAD_WHATSAPPS",t)},async deleteWhatsapp(t){this.$q.dialog({title:"Atenção!! Deseja realmente deletar? ",message:"Não é uma boa ideia apagar se já tiver gerado atendimentos para esse whatsapp.",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(o["b"])(t.id).then((e=>{this.$store.commit("DELETE_WHATSAPPS",t.id)})).finally((t=>{this.loading=!1}))}))},async listarChatFlow(){const{data:t}=await Object(nt["c"])();this.listaChatFlow=t.chatFlow},async handleSaveWhatsApp(t){try{await Object(o["i"])(t.id,t),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Whatsapp ${t.id?"editado":"criado"} com sucesso!`,actions:[{icon:"close",round:!0,color:"white"}]})}catch(e){return console.error(e),this.$q.notify({type:"error",progress:!0,position:"top",message:"Ops! Verifique os erros... O nome da conexão não pode existir na plataforma, é um identificador único.",actions:[{icon:"close",round:!0,color:"white"}]})}},handleUpdateSession(t){this.$store.commit("UPDATE_SESSION",t),this.atualizarPagina()},atualizarPagina(){location.reload()}},beforeDestroy(){this.$root.$off("UPDATE_SESSION",this.handleUpdateSession)},mounted(){this.fetchConfigurations(),this.userProfile=localStorage.getItem("profile"),this.isAdmin=localStorage.getItem("profile"),this.buscaFilas(),this.listarUsuario(),this.listarWhatsapps(),this.listarChatFlow(),this.$root.$on("UPDATE_SESSION",this.handleUpdateSession)}},ut=dt,ht=a("cb32"),mt=a("0170"),gt=a("eb85"),bt=a("9564"),vt=a("9569"),wt=a("74f7"),ft=a("cf57"),qt=Object(g["a"])(ut,s,i,!1,null,"157779d6",null);e["default"]=qt.exports;C()(qt,"components",{QCard:v["a"],QCardSection:w["a"],QIcon:B["a"],QBtn:f["a"],QItem:tt["a"],QItemSection:et["a"],QAvatar:ht["a"],QItemLabel:mt["a"],QSeparator:gt["a"],QToggle:bt["a"],QSelect:z["a"],QTooltip:J["a"],QCheckbox:X["a"],QCardActions:E["a"],QSpinnerRadio:vt["a"],QInnerLoading:wt["a"],QSpinnerGears:ft["a"]})}}]);