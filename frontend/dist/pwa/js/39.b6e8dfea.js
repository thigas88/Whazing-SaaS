(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[39],{"076b":function(a,e,t){"use strict";t.r(e);var i=function(){var a=this,e=a._self._c;return e("div",[e("q-table",{staticClass:"contact-table container-rounded-10 my-sticky-dynamic q-ma-lg",attrs:{flat:"",bordered:"",square:"","hide-bottom":"",data:a.mensagensRapidas,columns:a.columns,loading:a.loading,"row-key":"id",pagination:a.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(e){a.pagination=e}},scopedSlots:a._u([{key:"top-left",fn:function(){return[e("div",[e("h2",{class:a.$q.dark.isActive?"text-green":""},[e("q-icon",{attrs:{name:"mdi-reply-all-outline"}}),a._v("\n          Mensagens rápidas\n        ")],1),e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{icon:"eva-plus-outline",label:"Adicionar"},on:{click:function(e){a.mensagemRapidaEmEdicao={},a.modalMensagemRapida=!0}}})],1)]},proxy:!0},{key:"body-cell-isActive",fn:function(a){return[e("q-td",{staticClass:"text-center"},[e("q-icon",{attrs:{size:"24px",name:a.value?"mdi-check-circle-outline":"mdi-close-circle-outline",color:a.value?"positive":"negative"}})],1)]}},{key:"body-cell-media",fn:function(t){return[e("q-td",{attrs:{props:t}},[t.row.media?e("span",[e("a",{staticStyle:{"text-decoration":"underline",cursor:"pointer"},attrs:{href:a.generateMediaUrl(t.row.media),target:"_blank"}},[a._v("\n            Abrir Arquivo\n          ")])]):e("span",[a._v("\n          Sem Arquivo\n        ")])])]}},{key:"body-cell-acoes",fn:function(t){return[e("q-td",{staticClass:"text-center"},[e("q-btn",{class:a.$q.dark.isActive?"text-green":"",attrs:{flat:"",round:"",icon:"eva-edit-outline"},on:{click:function(e){return a.editarMensagem(t.row)}}}),e("q-btn",{class:a.$q.dark.isActive?"text-green":"",attrs:{flat:"",round:"",icon:"eva-trash-outline"},on:{click:function(e){return a.deletarMensagem(t.row)}}})],1)]}}])}),e("ModalMensagemRapida",{attrs:{modalMensagemRapida:a.modalMensagemRapida,mensagemRapidaEmEdicao:a.mensagemRapidaEmEdicao},on:{"update:modalMensagemRapida":function(e){a.modalMensagemRapida=e},"update:modal-mensagem-rapida":function(e){a.modalMensagemRapida=e},"update:mensagemRapidaEmEdicao":function(e){a.mensagemRapidaEmEdicao=e},"update:mensagem-rapida-em-edicao":function(e){a.mensagemRapidaEmEdicao=e},"mensagemRapida:criada":a.mensagemCriada,"mensagemRapida:editada":a.mensagemEditada}})],1)},s=[],n=function(){var a=this,e=a._self._c;return e("q-dialog",{attrs:{persistent:"",value:a.modalMensagemRapida},on:{hide:a.fecharModal,show:a.abrirModal}},[e("q-card",{staticClass:"q-pa-lg modal-container container-rounded-10"},[e("q-card-actions",{staticClass:"q-mt-md",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",color:"negative",icon:"eva-close"}})],1),e("q-card-section",[e("div",{staticClass:"text-h6 text-center font-family-main"},[a._v("\n        "+a._s(a.mensagemRapida.id?"Editar":"Criar")+" Mensagem Rápida "+a._s(a.mensagemRapida.id?`(ID: ${a.mensagemRapida.id})`:"")+"\n      ")])]),e("q-card-section",{staticClass:"q-pa-none"},[e("div",{staticClass:"row q-my-md q-pa-lg container-border container-rounded-10"},[e("div",{staticClass:"full-width text-h6 font-family-main q-mb-sm"},[a._v("Chave")]),e("div",{staticClass:"full-width"},[e("q-input",{attrs:{rounded:"",outlined:"",label:"Chave"},model:{value:a.mensagemRapida.key,callback:function(e){a.$set(a.mensagemRapida,"key",e)},expression:"mensagemRapida.key"}}),e("p",{staticClass:"text-center",staticStyle:{"font-size":"10px"}},[a._v("\n            A chave é o atalho para pesquisa da mensagem pelos usuários.\n          ")])],1)]),e("div",{staticClass:"row items-center container-border container-rounded-10 q-pa-lg"},[e("div",{staticClass:"text-h6 full-width font-family-main q-mb-sm"},[a._v("Mensagem")]),e("div",{staticClass:"col-xs-3 col-sm-2 col-md-1"},[e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",flat:""}},[e("q-icon",{attrs:{size:"2em",name:"mdi-emoticon-happy-outline"}}),e("q-tooltip",[a._v("Emoji")]),e("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[e("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:a.onInsertSelectEmoji}})],1)],1),e("q-btn",{staticClass:"q-ml-sm",attrs:{round:"",flat:""}},[e("q-icon",{attrs:{size:"2em",name:"mdi-variable"}}),e("q-tooltip",[a._v("\n            Variáveis\n          ")]),e("q-menu",{attrs:{"touch-position":""}},[e("q-list",{staticStyle:{"min-width":"100px"},attrs:{dense:""}},a._l(a.variaveis,(function(t){return e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.label,attrs:{clickable:""},on:{click:function(e){return a.onInsertSelectVariable(t.value)}}},[e("q-item-section",[a._v(a._s(t.label))])],1)})),1)],1)],1)],1),e("div",{staticClass:"col-xs-8 col-sm-10 col-md-11 q-pl-sm"},[e("label",{staticClass:"text-caption"},[a._v("Mensagem:")]),e("textarea",{ref:"inputEnvioMensagem",staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:a.mensagemRapida.message},on:{input:e=>a.mensagemRapida.message=e.target.value}})]),e("div",{staticClass:"col-xs-8 col-sm-10 col-md-11 q-pl-sm"},[e("q-file",{attrs:{dense:"",outlined:"",label:"Escolha o arquivo",filled:""},model:{value:a.arquivoCarregado,callback:function(e){a.arquivoCarregado=e},expression:"arquivoCarregado"}})],1)])]),e("q-card-actions",{staticClass:"q-mt-md",attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mr-md btn-rounded-50",attrs:{label:"Cancelar",color:"negative"}}),e("q-btn",{staticClass:"generate-button btn-rounded-50",attrs:{label:"Salvar",icon:"eva-save-outline"},on:{click:a.handleMensagemRapida}})],1)],1)],1)},o=[],l=t("79b5"),d=t("1394"),m={name:"ModalMensagemRapida",components:{VEmojiPicker:l["a"]},props:{modalMensagemRapida:{type:Boolean,default:!1},mensagemRapidaEmEdicao:{type:Object,default:()=>({id:null,key:"",message:"",medias:""})}},data(){return{mensagemRapida:{key:null,message:"",medias:null},arquivoCarregado:null,loading:!1,variaveis:[{label:"Nome Completo",value:"{{name}}"},{label:"Nome",value:"{{firstName}}"},{label:"Saudação",value:"{{greeting}}"},{label:"Protocolo",value:"{{protocol}}"},{label:"Telefone",value:"{{phoneNumber}}"},{label:"Email do Contato",value:"{{email}}"},{label:"Numero Ticket",value:"{{ticket_id}}"},{label:"Hora",value:"{{hour}}"},{label:"Data",value:"{{date}}"},{label:"Fila",value:"{{fila}}"},{label:"Nome atendente",value:"{{user}}"},{label:"Email atendente",value:"{{userEmail}}"}]}},methods:{limparArquivo(){this.arquivoCarregado=null},onInsertSelectVariable(a){const e=this;var t=this.$refs.inputEnvioMensagem,i=t.selectionStart,s=t.selectionEnd,n=i,o=t.value;a&&(e.txtContent=this.mensagemRapida.message,e.txtContent=o.substring(0,i)+a+o.substring(s,o.length),this.mensagemRapida.message=e.txtContent,setTimeout((()=>{t.selectionStart=t.selectionEnd=n+1}),10))},onInsertSelectEmoji(a){const e=this;var t=this.$refs.inputEnvioMensagem,i=t.selectionStart,s=t.selectionEnd,n=i,o=t.value;a.data&&(e.txtContent=this.mensagemRapida.message,e.txtContent=o.substring(0,i)+a.data+o.substring(s,o.length),this.mensagemRapida.message=e.txtContent,setTimeout((()=>{t.selectionStart=t.selectionEnd=n+a.data.length}),10))},fecharModal(){this.$emit("update:mensagemRapidaEmEdicao",{id:null}),this.$emit("update:modalMensagemRapida",!1)},abrirModal(){this.mensagemRapidaEmEdicao.id?(this.mensagemRapida={...this.mensagemRapidaEmEdicao},this.arquivoCarregado=this.mensagemRapidaEmEdicao.media):(this.mensagemRapida={key:null,message:"",medias:null},this.arquivoCarregado=null)},async handleMensagemRapida(){if(this.mensagemRapida.key)if(this.mensagemRapida.message||this.arquivoCarregado){this.loading=!0;try{let a;const e=new FormData;e.append("key",this.mensagemRapida.key),e.append("message",this.mensagemRapida.message),this.arquivoCarregado?e.append("medias",this.arquivoCarregado):e.append("medias",null),this.mensagemRapida.id?(a=await Object(d["a"])(this.mensagemRapida.id,e),this.$emit("mensagemRapida:editada",{...this.mensagemRapida,...a.data})):(a=await Object(d["b"])(e),this.$emit("mensagemRapida:criada",{...this.mensagemRapida,...a.data})),this.$q.notify({type:"positive",message:this.mensagemRapida.id?"Mensagem rápida atualizada com sucesso!":"Mensagem rápida criada com sucesso!"}),this.fecharModal()}catch(a){console.error(a),this.$q.notify({type:"negative",message:"Ocorreu um erro ao salvar a mensagem rápida."})}finally{this.loading=!1}}else this.$q.notify({type:"negative",message:"Você deve preencher a mensagem ou escolher um arquivo."});else this.$q.notify({type:"negative",message:"A chave não pode estar em branco."})}}},r=m,c=t("2877"),p=t("24e8"),g=t("f09f"),u=t("4b7e"),h=t("9c40"),v=t("a370"),b=t("27f9"),f=t("0016"),q=t("05c0"),R=t("4e73"),y=t("1c1c"),C=t("66e5"),E=t("4074"),M=t("7d53"),k=t("7f67"),w=t("eebe"),x=t.n(w),S=Object(c["a"])(r,n,o,!1,null,"1a1b0c51",null),_=S.exports;x()(S,"components",{QDialog:p["a"],QCard:g["a"],QCardActions:u["a"],QBtn:h["a"],QCardSection:v["a"],QInput:b["a"],QIcon:f["a"],QTooltip:q["a"],QMenu:R["a"],QList:y["a"],QItem:C["a"],QItemSection:E["a"],QFile:M["a"]}),x()(S,"directives",{ClosePopup:k["a"]});var $={name:"MensagensRapidas",components:{ModalMensagemRapida:_},data(){return{loading:!1,mensagensRapidas:[],modalMensagemRapida:!1,mensagemRapidaEmEdicao:{},columns:[{name:"id",label:"#",field:"id",align:"left"},{name:"key",label:"Chave",field:"key",align:"left"},{name:"message",label:"Mensagem",field:"message",align:"left"},{name:"media",label:"Arquivo",field:"media",align:"left"},{name:"acoes",label:"Ações",field:"acoes",align:"center"}],pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0}}},methods:{generateMediaUrl(a){return`http://localhost:3100/public/${a}`},async listarMensagensRapidas(){const{data:a}=await Object(d["d"])();this.mensagensRapidas=a},mensagemCriada(a){this.mensagensRapidas.unshift(a)},mensagemEditada(a){const e=[...this.mensagensRapidas],t=e.findIndex((e=>e.id===a.id));t>-1&&(e[t]=a),this.mensagensRapidas=[...e]},editarMensagem(a){this.mensagemRapidaEmEdicao={...a},this.modalMensagemRapida=!0},deletarMensagem(a){this.$q.dialog({title:"Atenção!!",message:`Deseja realmente deletar a mensagem de chave "${a.key}"?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(d["c"])(a).then((e=>{let t=[...this.mensagensRapidas];t=t.filter((e=>e.id!==a.id)),this.mensagensRapidas=[...t],this.$q.notify({type:"positive",progress:!0,position:"top",message:"Mensagem deletada!",actions:[{icon:"close",round:!0,color:"white"}]})})),this.loading=!1}))}},mounted(){this.listarMensagensRapidas()}},Q=$,A=t("eaac"),j=t("db86"),I=Object(c["a"])(Q,i,s,!1,null,"3a6f4728",null);e["default"]=I.exports;x()(I,"components",{QTable:A["a"],QIcon:f["a"],QBtn:h["a"],QTd:j["a"]})}}]);