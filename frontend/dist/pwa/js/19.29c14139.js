(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{1842:function(e,t,a){"use strict";a("af79")},af79:function(e,t,a){},eb1e:function(e,t,a){"use strict";a.r(t);a("14d9");var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"WAL position-relative bg-grey-3",style:e.style},[t("q-layout",{attrs:{container:"",view:"lHr LpR lFr"}},[t("q-header",{staticClass:"full-width",staticStyle:{position:"fixed !important",top:"unset",bottom:"unset"}},[t("q-toolbar",{staticClass:"bg-white text-black"},[t("q-btn",{staticClass:"WAL__drawer-open q-mr-sm",attrs:{round:"",flat:"",icon:"keyboard_arrow_left"},on:{click:e.toggleLeftDrawer}}),t("q-btn",{attrs:{round:"",flat:"",disable:e.cDisableActions}},[t("q-avatar",{attrs:{color:"primary","text-color":"white"}},[e._v("\n              "+e._s(e.Value(e.selectedContact.name.charAt(0),"name"))+"\n            ")])],1),t("span",{staticClass:"q-subtitle-1 q-pl-md"},[e._v("\n            "+e._s(e.Value(e.selectedContact.name,"name"))+"\n            "),e.Value(e.selectedContact.name,"name")?e._e():t("q-skeleton",{staticStyle:{width:"230px"},attrs:{animation:"none"}})],1),t("q-space")],1)],1),t("q-drawer",{staticClass:"overflow-y-off",attrs:{"show-if-above":"",bordered:"",breakpoint:690},model:{value:e.leftDrawerOpen,callback:function(t){e.leftDrawerOpen=t},expression:"leftDrawerOpen"}},[t("q-toolbar",{staticClass:"bg-grey-3"},[t("q-btn",{staticClass:"btn-rounded",class:e.$q.dark.isActive?"text-green":"",attrs:{flat:"",icon:"eva-undo-outline"},on:{click:()=>e.$router.push({name:"home-dashboard"})}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Retornar ao menu\n            ")])],1),t("q-separator"),t("q-btn",{staticClass:"btn-rounded q-ml-xs",class:e.$q.dark.isActive?"text-green":"",attrs:{flat:"",icon:"eva-message-circle-outline"},on:{click:()=>e.$router.push({name:"chat-empty"})}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Atendimento\n            ")])],1),t("q-space")],1),t("q-toolbar",[t("q-input",{staticClass:"WAL__field full-width",attrs:{rounded:"",outlined:"",dense:"","bg-color":"grey-7",placeholder:"Pesquisar..."},on:{input:function(t){return e.buscarTicketFiltro()}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.searchParam,callback:function(t){e.searchParam=t},expression:"searchParam"}})],1),t("q-tabs",{staticClass:"q-pa-sm flex-gap-1 btn-rounded",class:{"text-green":e.$q.dark.isActive,"text-black":!e.$q.dark.isActive},attrs:{"inline-label":"",dense:"","narrow-indicator":"","active-bg-color":e.$q.dark.isActive?"primary":"grey-3",align:"justify"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t("q-tab",{staticClass:"q-mr-sm btn-rounded-50",class:e.$q.dark.isActive?"text-green":"bg-grey-3 q-tab-personalized",attrs:{ripple:!1,name:"users",icon:"eva-person-outline",label:"Usuários"}}),t("q-tab",{staticClass:"btn-rounded-50",class:e.$q.dark.isActive?"text-green":"bg-grey-3 q-tab-personalized",attrs:{ripple:!1,name:"groups",icon:"eva-people-outline",label:"Equipes"}})],1),[t("q-tab-panels",{attrs:{animated:"",swipeable:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t("q-tab-panel",{staticClass:"tabChat",attrs:{name:"users"}},[t("q-scroll-area",{staticStyle:{height:"calc(96vh - 158px) !important"}},[t("q-list",e._l(e.searchedUsers,(function(a){return t("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a.id,attrs:{clickable:""},on:{click:function(t){return e.openChat(a,!1)}}},[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",{attrs:{color:"primary","text-color":"white"}},[e._v("\n                        "+e._s(a.name.charAt(0))+"\n                        "),t("q-tooltip",[e._v("\n                          "+e._s(a.isOnline?"Online":"Offline")+"\n                        ")]),a.isOnline?t("q-badge",{staticStyle:{"background-color":"green"},attrs:{floating:""}}):e._e(),a.isOnline?e._e():t("q-badge",{staticStyle:{"background-color":"red"},attrs:{floating:""}})],1)],1),t("q-item-section",[t("q-item-label",{attrs:{lines:"1"}},[e._v("\n                        "+e._s(a.name)+"\n                        "),t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                          "+e._s(a.name)+"\n                        ")])],1),t("q-item-label",{staticClass:"conversation__summary",attrs:{caption:""}},[null!==a.read?t("q-icon",{attrs:{name:"mdi-check-all",size:"1.2em",color:a.read?"blue-12":""}}):e._e(),e._v("\n                        "+e._s(a.text?a.text:"")+"\n                      ")],1)],1),t("q-item-section",{attrs:{side:""}},[t("q-item-label",{attrs:{caption:""}},[e._v("\n                        "+e._s(e.dataInWords(a.timestamp))+"\n                      ")]),a.count>0?t("q-badge",{attrs:{color:"teal"}},[e._v(e._s(a.count))]):e._e()],1)],1)})),1)],1)],1),t("q-tab-panel",{staticClass:"tabChat",attrs:{name:"groups"}},[t("q-scroll-area",{staticStyle:{height:"calc(96vh - 158px) !important"}},[t("q-list",e._l(e.searchedGroup,(function(a){return t("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a.id,attrs:{clickable:""},on:{click:function(t){return e.openChat(a,!0)}}},[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",{attrs:{color:"primary","text-color":"white"}},[e._v("\n                        "+e._s(a.name.charAt(0))+"\n                      ")])],1),t("q-item-section",[t("q-item-label",{attrs:{lines:"1"}},[e._v("\n                        "+e._s(a.name)+"\n                        "),t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                          "+e._s(a.name)+"\n                        ")])],1),t("q-item-label",{staticClass:"conversation__summary",attrs:{caption:""}},[e._v("\n                        "+e._s(a.text?a.text:"")+"\n                      ")])],1),t("q-item-section",{attrs:{side:""}},[t("q-item-label",{attrs:{caption:""}},[e._v("\n                        "+e._s(e.dataInWords(a.timestamp))+"\n                      ")]),a.count>0?t("q-badge",{attrs:{color:"teal"}},[e._v(e._s(a.count))]):e._e()],1)],1)})),1)],1)],1)],1)]],2),t("q-page-container",{staticClass:"bg-grey-2",style:e.styleChatArea},[t("q-scroll-area",{ref:"chatPanel",staticClass:"scroll-y chatarea",style:e.cStyleScrolll,on:{scroll:e.scrollArea}},[t("div",{staticClass:"q-pa-md"},[t("transition-group",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},e._l(e.messages,(function(a,s){return t("div",{key:a.id,staticClass:"text-weight-medium"},[e.isLineDate?t("hr",{directives:[{name:"show",rawName:"v-show",value:0===s||e.formatarData(a.timestamp)!==e.formatarData(e.messages[s-1].timestamp),expression:"index === 0 || formatarData(message.timestamp) !== formatarData(messages[index - 1].timestamp)"}],key:"hr-"+s,staticClass:"hr-text q-mt-lg q-mb-md",attrs:{"data-content":e.formatarData(a.timestamp)}}):e._e(),t("q-chat-message",{ref:a.id,refInFor:!0,attrs:{id:a.id,name:a.sender.id==e.usuario.userId?"Eu":a.sender.name,"bg-color":a.sender.id==e.usuario.userId?"blue-4":"green-4",stamp:e.dataInWordsMessage(Number(a.timestamp)),sent:a.sender.id==e.usuario.userId}},[t("div",{staticStyle:{width:"200px"}},[a.sender.id==e.usuario.userId?t("q-icon",{staticClass:"absolute-bottom-right q-pr-xs q-pb-xs",attrs:{name:"mdi-check-all",size:"1.2em",color:a.read?"blue-12":""}}):e._e(),"image"===a.mediaType?[t("q-img",{staticClass:"q-mt-md",staticStyle:{cursor:"pointer","min-width":"280px","max-width":"280px"},attrs:{src:a.mediaUrl,"spinner-color":"primary"},on:{click:function(t){e.urlMedia=a.mediaUrl,e.abrirModalImagem=!0}}}),t("VueEasyLightbox",{attrs:{moveDisabled:"",visible:e.abrirModalImagem,imgs:e.urlMedia,index:a.ticketId||1},on:{hide:function(t){e.abrirModalImagem=!1}}})]:e._e(),"video"===a.mediaType?[t("video",{staticClass:"q-mt-md",staticStyle:{height:"150px","min-width":"280px","max-width":"280px",objectFit:"cover",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",borderBottomLeftRadius:"8px",borderBottomRightRadius:"8px"},attrs:{src:a.mediaUrl,controls:""}})]:e._e(),!["audio","contactMessage","image","video"].includes(a.mediaType)&&a.mediaUrl?[t("div",{staticClass:"text-center full-width hide-scrollbar no-scroll",staticStyle:{"min-width":"280px","max-width":"280px"}},[e.isPDF(a.mediaUrl)?t("iframe",{staticClass:"no-scroll hide-scrollbar",staticStyle:{"min-width":"280px","max-width":"280px","overflow-y":"hidden","-ms-overflow-y":"hidden"},attrs:{frameBorder:"0",scrolling:"no",src:a.mediaUrl,id:"frame-pdf"}},[e._v("\n                          Faça download do PDF\n                        ")]):e._e(),t("q-btn",{staticClass:"q-mt-sm text-center text-black btn-rounded text-grey-9 ellipsis",attrs:{type:"a",color:e.$q.dark.isActive?"":"grey-3","no-wrap":"","no-caps":"",stack:"",dense:"",download:"",target:e.isPDF(a.mediaUrl)?"_blank":"",href:a.mediaUrl}},[a.mediaUrl?t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                            Baixar: "+e._s(a.mediaName)+"\n                            "+e._s(a.text)+"\n                          ")]):e._e(),t("div",{staticClass:"row items-center q-ma-xs"},[t("div",{staticClass:"ellipsis col-grow q-pr-sm",staticStyle:{"max-width":"290px"}},[e._v("\n                              "+e._s(e.formatarMensagem(a.text||a.mediaName))+"\n                            ")]),t("q-icon",{attrs:{name:"mdi-download"}})],1)],1)],1)]:e._e(),"chat"===a.mediaType?t("div",{staticClass:"q-message-container row items-end no-wrap"},[e._v("\n                      "+e._s(a.text)+"\n                    ")]):e._e()],2)])],1)})),0),t("div",{attrs:{id:"inicioListaMensagensChat"}})],1)])],1),t("q-footer",[t("q-toolbar",{staticClass:"bg-grey-3 text-black row"},[[e.$q.screen.width>500?t("q-btn",{class:e.$q.dark.isActive?"text-green":"",attrs:{icon:"mdi-paperclip",round:"",flat:"",disable:e.cDisableActions,dense:"",color:e.$q.dark.isActive?"green":""},on:{click:e.abrirEnvioArquivo}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                Anexar Arquivo\n              ")])],1):e._e(),e.$q.screen.width>500?t("q-btn",{staticClass:"btn-rounded q-mx-xs",class:e.$q.dark.isActive?"text-green":"",attrs:{flat:"",dense:"",icon:"mdi-emoticon-happy-outline",disable:e.cDisableActions||e.cMostrarEnvioArquivo,color:e.$q.dark.isActive?"green":""}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                Emoji\n              ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:e.onInsertSelectEmoji}})],1)],1):e._e(),t("q-input",{directives:[{name:"show",rawName:"v-show",value:!e.cMostrarEnvioArquivo,expression:"!cMostrarEnvioArquivo"}],ref:"inputEnvioMensagem",staticClass:"col-grow q-mx-xs text-grey-10 inputEnvioMensagem",attrs:{"hide-bottom-space":"",disable:e.cDisableActions,id:"inputEnvioMensagem",type:"textarea","bg-color":"white",color:"grey-7",placeholder:"Digita sua mensagem","input-style":"max-height: 30vh",autogrow:"",rounded:"",dense:"",outlined:"",value:e.newMenssage},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),(()=>e.newMenssage.trim().length?e.sendMessage():"").apply(null,arguments))}},scopedSlots:e._u([e.$q.screen.width<500?{key:"prepend",fn:function(){return[t("q-btn",{attrs:{flat:"",icon:"mdi-emoticon-happy-outline",disable:e.cDisableActions,dense:"",round:"",color:e.$q.dark.isActive?"green":""}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                    Emoji\n                  ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:e.onInsertSelectEmoji}})],1)],1)]},proxy:!0}:null],null,!0),model:{value:e.newMenssage,callback:function(t){e.newMenssage=t},expression:"newMenssage"}}),t("q-file",{directives:[{name:"show",rawName:"v-show",value:e.cMostrarEnvioArquivo,expression:"cMostrarEnvioArquivo"}],ref:"PickerFileMessage",staticClass:"col-grow q-mx-xs PickerFileMessage",attrs:{disable:e.cDisableActions,id:"PickerFileMessage","bg-color":"green","input-style":"max-height: 30vh",outlined:"","use-chips":"",multiple:"",autogrow:"",dense:"",rounded:"",append:"","max-files":5,"max-file-size":52428800,"max-total-size":52428800,accept:".txt, .xml, .jpg, .png, image/jpeg, .pdf, .doc, .docx, .mp4, .xls, .xlsx, .jpeg, .zip, .ppt, .pptx, image/*"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),(()=>e.arquivos.length>0?e.sendMessage():"").apply(null,arguments))},rejected:e.onRejectedFiles},model:{value:e.arquivos,callback:function(t){e.arquivos=t},expression:"arquivos"}}),t("q-btn",{ref:"btnEnviarMensagem",staticClass:"btn-rounded q-mx-xs",class:e.$q.dark.isActive?"text-green":"",attrs:{flat:"",icon:"mdi-send",disable:e.cDisableActions,color:e.$q.dark.isActive?"green":""},on:{click:function(t){return e.sendMessage()}}},[t("q-tooltip",{attrs:{"content-class":" text-bold"}},[e._v("\n                Enviar Mensagem\n              ")])],1)]],2)],1)],1)],1)},i=[],n=a("2f62"),r=a("9a1b"),o=a("e018"),l=a("1556"),c=a("b166"),d=a("3d09"),m=a("c3f3"),h=a("825ae"),u=a("79b5"),p=a("cd82"),g=a.n(p),I=a("cd36"),b=a.n(I),v={name:"WhatsappLayout",props:{isLineDate:{type:Boolean,default:!0},showMenu:{type:Boolean,default:!1}},data(){return{usuario:{},leftDrawerOpen:!1,abrirModalImagem:!1,search:"",message:"",newMenssage:"",urlMedia:"",tab:"users",searchParam:"",searchedUsers:[],searchedGroup:[],arquivos:[],messages:[],userId:0,heigthInputMensagem:0,abrirFilePicker:!1,selectedContact:{id:null,name:"",isOnline:!1,messages:[],hasMore:!1}}},computed:{...Object(n["b"])(["userChat","mensagemChatInterno","chatFocado","unreadMessageInterna","listaUsuarios","listaGrupos"]),cMostrarEnvioArquivo(){return this.arquivos.length>0},style(){return{height:this.$q.screen.height+"px"}},styleChatArea(){return{backgroundImage:this.$q.dark.isActive?`url(${b.a}) !important`:`url(${g.a}) !important`,backgroundPosition:"center !important",minHeight:"100vh"}},cDisableActions(){return null==this.selectedContact.id},cStyleScrolll(){const e=0,t=this.heigthInputMensagem+e;return`min-height: calc(100vh - ${100+t}px) !important; width: 100%`}},watch:{listaUsuarios:{handler(){this.searchedUsers=this.listaUsuarios,this.searchParam.length>0&&(this.searchedUsers=this.listaUsuarios.filter((e=>0==e.name.toLowerCase().indexOf(this.searchParam.toLowerCase()))))}},listaGrupos:{handler(){this.searchedGroup=this.listaGrupos,this.searchParam.length>0&&(this.searchedGroup=this.listaGrupos.filter((e=>0==e.name.toLowerCase().indexOf(this.searchParam.toLowerCase()))))}},unreadMessageInterna:{handler(){const e=JSON.parse(localStorage.getItem("usuario"));if(null!==this.selectedContact.id&&this.selectedContact.id==this.unreadMessageInterna.receiverId&&this.messages.forEach((e=>{e.sender.id==this.unreadMessageInterna.senderId&&(e.read=!0,this.$forceUpdate())})),this.unreadMessageInterna.senderId==e.userId){const e=this.listaUsuarios.findIndex((e=>e.id==this.unreadMessageInterna.receiverId)),t={...this.listaUsuarios[e]};t.read=!0,this.$store.commit("LISTA_USUARIOS_CHAT_INTERNO",{action:"update",data:t})}}},userChat:{handler(){this.usuarios.forEach((e=>{e.id===this.userChat.userId&&(e.isOnline=this.userChat.isOnline,this.$forceUpdate())}))}},mensagemChatInterno:{handler(){const e=JSON.parse(localStorage.getItem("usuario"));if(null!==this.selectedContact.id&&(this.selectedContact.id==this.mensagemChatInterno.senderId&&null==this.mensagemChatInterno.groupId||this.selectedContact.id==this.mensagemChatInterno.groupId&&null==this.mensagemChatInterno.receiverId&&this.mensagemChatInterno.senderId!=e.userId)){const e={id:this.mensagemChatInterno.id,text:this.mensagemChatInterno.text,timestamp:this.mensagemChatInterno.timestamp,sender:this.mensagemChatInterno.sender,received:this.mensagemChatInterno.receiverId,mediaType:this.mensagemChatInterno.mediaType,mediaName:this.mensagemChatInterno.mediaName,mediaUrl:this.mensagemChatInterno.mediaUrl};if(console.log("this.mensagemChatInterno.mediaType: ",this.mensagemChatInterno),console.log("mensagens: ",e),this.messages.push(e),this.selectedContact.isGroup){const e=this.listaGrupos.findIndex((e=>e.id==this.mensagemChatInterno.groupId)),t={...this.listaGrupos[e]};t.senderId=this.mensagemChatInterno.senderId,t.timestamp=this.mensagemChatInterno.timestamp,t.text=this.mensagemChatInterno.text,t.read=null,this.$store.commit("LISTA_GRUPOS_CHAT_INTERNO",{action:"update",data:t})}else{const e=this.listaUsuarios.findIndex((e=>e.id==this.mensagemChatInterno.senderId)),t={...this.listaUsuarios[e]};t.senderId=this.mensagemChatInterno.senderId,t.timestamp=this.mensagemChatInterno.timestamp,t.text=this.mensagemChatInterno.text,t.read=null,this.$store.commit("LISTA_USUARIOS_CHAT_INTERNO",{action:"update",data:t})}this.$forceUpdate(),this.marcarMensagemComoLida(this.selectedContact.id,this.selectedContact.isGroup),this.scrollToBottom()}else{if(null!=this.mensagemChatInterno.groupId&&this.mensagemChatInterno.senderId!=e.userId){const e=this.listaGrupos.findIndex((e=>e.id==this.mensagemChatInterno.groupId)),t={...this.listaGrupos[e]};t.senderId=this.mensagemChatInterno.senderId,t.timestamp=this.mensagemChatInterno.timestamp,t.text=this.mensagemChatInterno.text,t.read=null,t.count++,this.$store.commit("LISTA_GRUPOS_CHAT_INTERNO",{action:"update",data:t})}else{const e=this.listaUsuarios.findIndex((e=>e.id==this.mensagemChatInterno.senderId)),t={...this.listaUsuarios[e]};t.senderId=this.mensagemChatInterno.senderId,t.timestamp=this.mensagemChatInterno.timestamp,t.text=this.mensagemChatInterno.text,t.read=null,t.count++,this.$store.commit("LISTA_USUARIOS_CHAT_INTERNO",{action:"update",data:t})}this.$forceUpdate()}}},notificacaoChatInterno:{handler(){const e=JSON.parse(localStorage.getItem("usuario"));if(this.notificacaoChatInterno.groupId&&this.notificacaoChatInterno.senderId!==e.userId){const e=this.listaGrupos.findIndex((e=>e.id==this.notificacaoChatInterno.groupId)),t=this.listaGrupos[e];return e>=0&&!this.chatFocado||this.chatFocado&&this.chatFocado.id!==t.id?void this.$store.commit("LISTA_NOTIFICACOES_CHAT_INTERNO",{action:"update",data:1}):void 0}this.chatFocado&&this.chatFocado.id===this.notificacaoChatInterno.senderId||this.notificacaoChatInterno.senderId===e.userId||this.$store.commit("LISTA_NOTIFICACOES_CHAT_INTERNO",{action:"update",data:1})}}},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},async openChat(e,t){this.$store.commit("CHAT_FOCADO_UPDATE",e),this.selectedContact=e,this.selectedContact.isGroup=t,this.listarMensagens(e.id,t),this.scrollToBottom(),await this.marcarMensagemComoLida(e.id,t)},abrirEnvioArquivo(e){this.newMenssage="",this.abrirFilePicker=!0,this.$refs.PickerFileMessage.pickFiles(e)},onRejectedFiles(e){this.$q.notify({html:!0,message:"Ops... Ocorreu um erro! <br>\n        <ul>\n          <li>Verifique o tamanho do arquivo.</li>\n          <li>Em caso de múltiplos arquivos, o tamanho total (soma de todos) deve ser de até 50MB.</li>\n        </ul>",type:"negative",progress:!0,position:"top",actions:[{icon:"close",round:!0,color:"white"}]})},async listarMensagens(e,t){try{const{data:a}=await Object(m["d"])(e,t);this.messages=a.mensagens.map((e=>({id:e.id,text:e.text,timestamp:e.timestamp,sender:e.sender,mediaType:e.mediaType,mediaName:e.mediaName,mediaUrl:e.mediaUrl,received:e.receiverId,read:e.read}))),this.userId=e,this.scrollToBottom()}catch(a){console.error(a)}},async marcarMensagemComoLida(e,t){try{if(await Object(m["e"])(e,t),t){const t=this.listaGrupos.findIndex((t=>t.id==e)),a={...this.listaGrupos[t]};this.$store.commit("LISTA_NOTIFICACOES_CHAT_INTERNO",{action:"remove",data:a.count}),a.count=0,this.$store.commit("LISTA_GRUPOS_CHAT_INTERNO",{action:"update",data:a})}else{const t=this.listaUsuarios.findIndex((t=>t.id==e)),a={...this.listaUsuarios[t]};this.$store.commit("LISTA_NOTIFICACOES_CHAT_INTERNO",{action:"remove",data:a.count}),a.count=0,this.$store.commit("LISTA_USUARIOS_CHAT_INTERNO",{action:"update",data:a})}}catch(a){console.error("Erro ao marcar mensagem como não lida:",a)}},async sendMessage(){if(""!==this.newMenssage.trim()||this.cMostrarEnvioArquivo){try{const e=JSON.parse(localStorage.getItem("usuario"));let t=0;const a=new Date;this.messages.forEach((e=>{e.id>t&&(t=e.id)}));const s={id:t+1,text:this.newMenssage,timestamp:a.getTime(),sender:e.userId,receiverId:this.selectedContact.id,tenantId:e.tenantId,mediaType:"chat",read:!1,arquivos:this.arquivos,isGroup:this.selectedContact.isGroup};let i;if(this.cMostrarEnvioArquivo){const s=new FormData;this.arquivos.forEach((i=>{s.append("id",t),s.append("medias",i),s.append("text",i.name),s.append("read",!1),s.append("isGroup",this.selectedContact.isGroup),s.append("tenantId",e.tenantId),s.append("receiverId",this.selectedContact.id),s.append("sender",e.userId),s.append("timestamp",a.getTime())})),i=await Object(m["a"])(s)}else i=await Object(m["a"])(s);delete s.receiverId,s.received=this.selectedContact.id,s.mediaType=i.data.mensagem.mediaType,s.mediaName=i.data.mensagem.mediaName,s.mediaUrl=i.data.mensagem.mediaUrl,s.sender={id:e.userId,name:e.username},this.messages.push(s),this.$forceUpdate(),this.scrollToBottom();const n=this.listaUsuarios.findIndex((e=>e.id==this.selectedContact.id)),r={...this.listaUsuarios[n]};r.senderId=e.userId,r.timestamp=i.data.mensagem.timestamp,r.text=""===this.newMenssage.trim()?i.data.mensagem.mediaName:this.newMenssage,r.read=!1,this.$store.commit("LISTA_USUARIOS_CHAT_INTERNO",{action:"update",data:r}),this.newMenssage="",this.arquivos=[]}catch(e){console.error(e)}this.scrollToBottom()}},async listarUsuarios(){try{const{data:e}=await Object(r["f"])(this.params);this.$store.commit("LISTA_USUARIOS_CHAT_INTERNO",{action:"create",data:e.users})}catch(e){console.error(e)}},async listarGrupos(){const e=JSON.parse(localStorage.getItem("usuario")),{data:t}=await Object(m["c"])(e.userId);this.$store.commit("LISTA_GRUPOS_CHAT_INTERNO",{action:"create",data:t})},buscarTicketFiltro(){this.searchedUsers=this.listaUsuarios.filter((e=>0==e.name.toLowerCase().indexOf(this.searchParam.toLowerCase()))),this.searchedGroup=this.listaGrupos.filter((e=>0==e.name.toLowerCase().indexOf(this.searchParam.toLowerCase())))},dataInWords(e){return e?Object(l["a"])(new Date(Number(e)),new Date,{locale:o["a"]}):null},dataInWordsMessage(e){return Object(c["a"])(Object(d["a"])(new Date(e)),"HH:mm",{locale:o["a"]})},onInsertSelectEmoji(e){const t=this;var a=this.$refs.inputEnvioMensagem.$refs.input,s=a.selectionStart,i=a.selectionEnd,n=s,r=a.value;e.data&&(t.txtContent=this.newMenssage,t.txtContent=r.substring(0,s)+e.data+r.substring(i,r.length),this.newMenssage=t.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=n+e.data.length}),10))},Value(e){return e||""},scrollToBottom(){setTimeout((()=>{this.$nextTick((()=>{document.getElementById("inicioListaMensagensChat").scrollIntoView()}))}),200)},scrollArea(e){this.hideOptions=!0,setTimeout((()=>{e&&(this.scrollIcon=e.verticalSize-(e.verticalPosition+e.verticalContainerSize)>2e3)}),200)},isPDF(e){if(!e)return!1;const t=e.split("."),a=t[t.length-1];return"pdf"===a},formatarMensagem(e){if(!e)return;let t=e;function a(e){var t=e.charCodeAt();return!!(t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57)}function s(e,t,s,i){for(var n=[],r=0;r<e.length;r++)e[r]===t?n.length%2?" "!=e[r-1]&&(("undefined"==typeof e[r+1]||!a(e[r+1]))&&n.push(r)):"undefined"!=typeof e[r+1]&&(" "!=e[r+1]&&(("undefined"==typeof e[r-1]||!a(e[r-1]))&&n.push(r))):10==e[r].charCodeAt()&&n.length%2&&n.pop();n.length%2&&n.pop();var o=0;return n.forEach((function(t,a){var n=a%2?i:s;t+=o,e=e.substr(0,t)+n+e.substr(t+1),o+=n.length-1})),e}return t=s(t,"_","<i>","</i>"),t=s(t,"*","<b>","</b>"),t=s(t,"~","<s>","</s>"),t=t.replace(/\n/gi,"<br>"),t},formatarData(e,t="dd/MM/yyyy"){const a=new Date(Number(e));return Object(c["a"])(a,t,{locale:o["a"]})}},async mounted(){localStorage.getItem("reloaded")?localStorage.removeItem("reloaded"):(localStorage.setItem("reloaded","true"),window.location.reload()),this.$store.commit("UPDATE_SHOW_MENU",this.showMenu),this.listarUsuarios(),this.listarGrupos()},created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),setInterval((()=>{this.recalcularHora++}),2e4)},components:{VEmojiPicker:u["a"],VueEasyLightbox:h["a"]}},f=v,C=(a("1842"),a("2877")),q=a("4d5a"),x=a("e359"),_=a("65c6"),w=a("9c40"),y=a("cb32"),A=a("293e"),S=a("2c91"),T=a("9404"),k=a("05c0"),O=a("eb85"),M=a("27f9"),U=a("0016"),E=a("429b"),N=a("7460"),$=a("adad"),L=a("823b"),D=a("4983"),R=a("1c1c"),P=a("66e5"),F=a("4074"),G=a("58a81"),j=a("0170"),Q=a("09e3"),H=a("8169"),B=a("068f"),z=a("7ff0"),V=a("4e73"),W=a("7d53"),J=a("8572"),K=a("714f"),X=a("eebe"),Y=a.n(X),Z=Object(C["a"])(f,s,i,!1,null,null,null);t["default"]=Z.exports;Y()(Z,"components",{QLayout:q["a"],QHeader:x["a"],QToolbar:_["a"],QBtn:w["a"],QAvatar:y["a"],QSkeleton:A["a"],QSpace:S["a"],QDrawer:T["a"],QTooltip:k["a"],QSeparator:O["a"],QInput:M["a"],QIcon:U["a"],QTabs:E["a"],QTab:N["a"],QTabPanels:$["a"],QTabPanel:L["a"],QScrollArea:D["a"],QList:R["a"],QItem:P["a"],QItemSection:F["a"],QBadge:G["a"],QItemLabel:j["a"],QPageContainer:Q["a"],QChatMessage:H["a"],QImg:B["a"],QFooter:z["a"],QMenu:V["a"],QFile:W["a"],QField:J["a"]}),Y()(Z,"directives",{Ripple:K["a"]})}}]);