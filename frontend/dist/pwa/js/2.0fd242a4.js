(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"3c5d":function(e,t,a){},"3ec7":function(e,t,a){"use strict";a("3c5d")},7466:function(e,t,a){"use strict";a("eb0b")},"923d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-white no-scroll hide-scrollbar overflow-hidden",style:e.style},[t("InforCabecalhoChat",{on:{"updateTicket:resolver":function(t){return e.atualizarStatusTicket("closed")},"updateTicket:retornar":function(t){return e.atualizarStatusTicket("pending")},"updateTicket:reabrir":function(t){return e.atualizarStatusTicket("open")},"abrir:modalAgendamentoMensagem":function(t){return e.onClickOpenAgendamentoMensagem()}}}),t("q-scroll-area",{ref:"scrollContainer",staticClass:"scroll-y q-pb-lg",style:e.cStyleScroll,on:{scroll:e.scrollArea}},[t("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[e.cMessages.length?t("infinite-loading",{attrs:{direction:"top",identificador:e.ticketFocado.id,spinner:"spiral"},on:{infinite:e.onLoadMore}},[t("div",{attrs:{slot:"no-results"},slot:"no-results"},[e.cMessages.length?e._e():t("div",[e._v("Sem resultados :(")])]),t("div",{attrs:{slot:"no-more"},slot:"no-more"},[e._v("Nada mais a carregar :)")])]):e._e()],1),e.cMessages.length&&e.ticketFocado.id&&("pending"!==e.ticketFocado.status||"admin"===e.userProfile||e.userSpyTicket)?t("MensagemChat",{attrs:{replyingMessage:e.replyingMessage,mensagens:e.cMessages,ativarMultiEncaminhamento:e.ativarMultiEncaminhamento,mensagensParaEncaminhar:e.mensagensParaEncaminhar},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t},"mensagem-chat:encaminhar-mensagem":e.abrirModalEncaminharMensagem,"update:ativarMultiEncaminhamento":function(t){e.ativarMultiEncaminhamento=t},"update:ativar-multi-encaminhamento":function(t){e.ativarMultiEncaminhamento=t},"update:mensagensParaEncaminhar":function(t){e.mensagensParaEncaminhar=t},"update:mensagens-para-encaminhar":function(t){e.mensagensParaEncaminhar=t}}}):e._e(),t("div",{attrs:{id:"inicioListaMensagensChat"}})],1),e.ticketFocado.id?e._e():t("div",{staticClass:"absolute-center items-center",class:{"row col text-center q-col-gutter-lg":!e.$q.screen.xs,"full-width text-center":e.$q.screen.xs}},[t("div",{staticStyle:{"margin-left":"30vw",display:"flex","justify-content":"center","align-items":"center"}},[t("img",{staticStyle:{width:"400px",height:"160px"},attrs:{src:e.generateMediaUrl()}})]),t("h1",{staticClass:"text-green row col justify-center",class:{"full-width":e.$q.screen.xs}})]),e.cMessages.length?t("div",{staticClass:"relative-position"},[t("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[e.scrollIcon?t("div",[t("q-btn",{staticClass:"vac-icon-scroll",attrs:{color:"white","text-color":"green",icon:"mdi-arrow-down",round:"",push:"",ripple:"",dense:""},on:{click:e.scrollToBottom}})],1):e._e()]),"pending"===e.ticketFocado.status?t("div",{staticClass:"bg-transparent fast-messages-list flex flex-center"},[t("q-btn",{staticClass:"generate-button btn-rounded-50",class:{"generate-button-dark":e.$q.dark.isActive},attrs:{flat:"",icon:"mdi-send-circle",label:"Iniciar o atendimento"},on:{click:function(t){return e.iniciarAtendimento(e.ticketFocado)}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n            Iniciar o atendimento\n          ")])],1)],1):e._e()],1):e._e(),t("q-footer",{staticClass:"bg-white"},[t("q-separator",{staticClass:"bg-grey-4"}),e.replyingMessage?t("q-list",{staticClass:"q-pa-none q-py-md text-black row items-center col justify-center full-width",class:{"bg-grey-1":!e.$q.dark.isActive,"bg-grey-10":e.$q.dark.isActive},staticStyle:{"max-height":"100px"},style:"border-top: 1px solid #; max-height: 140px; width: 100%;"},[t("q-item",{staticClass:"q-card--bordered q-pb-sm btn-rounded",class:{"bg-blue-1":!e.replyingMessage.fromMe&&!e.$q.dark.isActive,"bg-blue-2 text-black":!e.replyingMessage.fromMe&&e.$q.dark.isActive,"bg-grey-2 text-black":e.replyingMessage.fromMe},style:"\n            width: 460px;\n            min-width: 460px;\n            max-width: 460px;\n            max-height: 110px;\n          "},[t("q-item-section",[e.replyingMessage.fromMe?e._e():t("q-item-label",{class:{"text-black":e.$q.dark.isActive},attrs:{caption:""}},[e._v("\n              "+e._s(e.replyingMessage.contact&&e.replyingMessage.contact.name)+"\n            ")]),t("q-item-label",{attrs:{lines:"4"},domProps:{innerHTML:e._s(e.formatarMensagemWhatsapp(e.replyingMessage.body))}})],1),t("q-btn",{staticClass:"float-right absolute-top-right z-max",attrs:{dense:"",flat:"",round:"",icon:"close",disabled:e.loading||"open"!==e.ticketFocado.status},on:{click:function(t){e.replyingMessage=null}}})],1)],1):e._e(),e.mensagensParaEncaminhar.length>0?t("q-banner",{staticClass:"text-grey-8",scopedSlots:e._u([{key:"action",fn:function(){return[t("q-btn",{staticClass:"bg-padrao q-px-sm",attrs:{flat:"",color:"negative",label:"Cancelar"},on:{click:e.cancelarMultiEncaminhamento}}),t("q-btn",{staticClass:"bg-padrao q-px-sm",attrs:{flat:"",color:"positive",label:"Enviar",icon:"mdi-send"},on:{click:function(t){return e.confirmarEncaminhamentoMensagem(e.mensagensParaEncaminhar)}}})]},proxy:!0}],null,!1,1463545920)},[t("span",{staticClass:"text-bold text-h5"},[e._v(" "+e._s(e.mensagensParaEncaminhar.length)+" de 10 mensagens")]),e._v(" selecionadas para\n        serem encaminhadas.\n        "),t("q-separator",{staticClass:"bg-grey-4"}),t("q-select",{ref:"selectAutoCompleteContato",staticClass:"q-my-md",attrs:{dense:"",autofocus:"",outlined:"",rounded:"","hide-dropdown-icon":"",loading:e.loading,options:e.contatos,"input-debounce":"700","use-input":"","hide-selected":"","fill-input":"",clearable:"","option-label":"name","option-value":"id",label:"Localize e selecione o contato",hint:"Digite no mínimo duas letras para localizar o contato. É possível selecionar apenas 1 contato!"},on:{filter:e.localizarContato},scopedSlots:e._u([{key:"option",fn:function(a){return[a.opt.name?t("q-item",e._g(e._b({},"q-item",a.itemProps,!1),a.itemEvents),[t("q-item-section",[t("q-item-label",[e._v(" "+e._s(a.opt.name))]),t("q-item-label",{attrs:{caption:""}},[e._v(e._s(a.opt.number))])],1)],1):e._e()]}}],null,!1,1212698310),model:{value:e.contatoSelecionado,callback:function(t){e.contatoSelecionado=t},expression:"contatoSelecionado"}})],1):e._e(),e.mensagensParaEncaminhar.length?e._e():t("InputMensagem",{attrs:{mensagensRapidas:e.mensagensRapidas,replyingMessage:e.replyingMessage},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t}}}),t("q-resize-observer",{on:{resize:e.onResizeInputMensagem}})],1),t("q-dialog",{attrs:{persistent:""},on:{hide:function(t){e.mensagemEncaminhamento={}}},model:{value:e.modalEncaminhamentoMensagem,callback:function(t){e.modalEncaminhamentoMensagem=t},expression:"modalEncaminhamentoMensagem"}},[t("q-card",{style:e.$q.screen.width<770?"min-width: 98vw; max-width: 98vw":"min-width: 50vw; max-width: 50vw"},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("\n            Encaminhando Mensagem\n            "),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"bg-padrao btn-rounded float-right",attrs:{flat:"",color:"negative",icon:"close"}})],1)]),t("q-separator",{attrs:{inset:""}}),t("q-card-section",[t("MensagemChat",{attrs:{isShowOptions:!1,replyingMessage:e.replyingMessage,mensagens:[e.mensagemEncaminhamento]},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t}}})],1),t("q-card-section",[t("q-select",{ref:"selectAutoCompleteContato",staticClass:"q-px-lg",attrs:{autofocus:"",outlined:"",rounded:"","hide-dropdown-icon":"",loading:e.loading,options:e.contatos,"input-debounce":"700","use-input":"","hide-selected":"","fill-input":"",clearable:"","option-label":"name","option-value":"id",label:"Localize e selecione o contato",hint:"Digite no mínimo duas letras para localizar o contato. É possível selecionar apenas 1 contato!"},on:{filter:e.localizarContato},scopedSlots:e._u([{key:"option",fn:function(a){return[a.opt.name?t("q-item",e._g(e._b({},"q-item",a.itemProps,!1),a.itemEvents),[t("q-item-section",[t("q-item-label",[e._v(" "+e._s(a.opt.name))]),t("q-item-label",{attrs:{caption:""}},[e._v(e._s(a.opt.number))])],1)],1):e._e()]}}]),model:{value:e.contatoSelecionado,callback:function(t){e.contatoSelecionado=t},expression:"contatoSelecionado"}})],1),t("q-card-actions",{staticClass:"q-pa-md",attrs:{align:"right"}},[t("q-btn",{staticClass:"bg-padrao q-px-sm",attrs:{flat:"",color:"positive",label:"Enviar",icon:"mdi-send"},on:{click:function(t){return e.confirmarEncaminhamentoMensagem([e.mensagemEncaminhamento])}}})],1)],1)],1)],1)},s=[],n=a("a700"),o=function(){var e=this,t=e._self._c;return t("div",[t("q-header",{staticClass:"bg-white text-black no-border-radius"},[t("q-toolbar",{staticClass:"no-border-radius q-pa-none",staticStyle:{"min-height":"60px",height:"60px"}},[e.$q.screen.lt.md?t("q-btn",{staticClass:"q-mx-xs-none q-ml-md",attrs:{flat:"",dense:"",round:"",icon:"mdi-menu",color:e.$q.dark.isActive?"green":""},on:{click:function(t){return e.$root.$emit("infor-cabecalo-chat:acao-menu")}}}):e._e(),t("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"q-ma-none q-pa-none full",staticStyle:{"min-height":"60px",height:"60px",width:"300px"},attrs:{clickable:""},on:{click:function(t){return e.$root.$emit("update-ticket:info-contato")}}},[t("q-item-section",{staticClass:"q-pl-sm",attrs:{avatar:""}},[t("q-btn",{attrs:{round:"",flat:""}},[t("q-avatar",{staticClass:"bg-grey blur-effect"},[t("q-img",{attrs:{src:e.Value(e.cticket.contact,"profilePicUrl")}})],1)],1)],1),t("q-item-section",{attrs:{id:"InfoCabecalhoChat"}},[t("q-item-label",{staticClass:"text-bold blur-effect"},[e._v("\n            "+e._s(e.Value(e.cticket.contact,"name"))+"\n            "),e.Value(e.cticket.contact,"name")?e._e():t("q-skeleton",{staticStyle:{width:"230px"},attrs:{animation:"none"}})],1),t("q-item-label",{staticStyle:{"margin-top":"2px !important"},style:e.$q.screen.width<500?"max-width: 170px":"",attrs:{caption:"",lines:"1"}},[e.Value(e.cticket.user,"name")?t("span",[e._v(" Atribuido à: "+e._s(e.Value(e.cticket.user,"name"))+" ")]):t("q-skeleton",{staticClass:"text-caption",staticStyle:{width:"150px"},attrs:{type:"text",animation:"none"}})],1),t("q-item-label",{staticStyle:{"margin-top":"0px !important"},attrs:{lines:"1"}},[e.Value(e.cticket.contact,"name")?t("span",{staticStyle:{"font-size":"11px"}},[e._v(" Ticket: "+e._s(e.cticket.id))]):e._e()])],1)],1),t("q-space"),e.Value(e.cticket.contact,"name")?t("div",{staticClass:"q-gutter-xs q-pr-sm"},[e.$q.screen.xs?[t("q-fab",{staticClass:"bg-padrao text-bold",class:{"bg-black":e.$q.dark.isActive},attrs:{disable:"closed"==e.cticket.status,color:"primary",flat:"",dense:"",icon:"keyboard_arrow_left",direction:"down",padding:"5px",label:"Ações"}},[t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black":e.$q.dark.isActive},attrs:{color:"primary",flat:"",icon:"mdi-comment-check"},on:{click:function(t){return e.$emit("updateTicket:resolver")}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                Resolver\n              ")])],1),t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black":e.$q.dark.isActive},attrs:{flat:"",icon:"mdi-replay",color:"primary"},on:{click:function(t){return e.$emit("updateTicket:retornar")}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                Retornar Ticket para a Fila\n              ")])],1),t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black-dark":e.$q.dark.isActive},attrs:{flat:"",color:"primary"},on:{click:e.listarFilas}},[t("q-icon",{attrs:{name:"mdi-transfer"}}),t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n                Transferir\n              ")])],1),t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black":e.$q.dark.isActive},attrs:{flat:"",color:"primary"},on:{click:function(t){return e.$emit("abrir:modalAgendamentoMensagem")}}},[t("q-icon",{attrs:{name:"mdi-message-text-clock-outline"}}),t("q-tooltip",{attrs:{"content-class":"primary text-bold"}},[e._v("\n                Agendamento de mensagem\n              ")])],1)],1)]:["admin"===e.userProfile||e.userReopenTicket?t("q-btn",{staticClass:"btn-rounded",class:{"text-green bg-black":e.$q.dark.isActive,"tab-item":!e.$q.dark.isActive},attrs:{flat:"",autofocus:"",icon:"eva-refresh-outline",disable:"open"==e.cticket.status||"pending"==e.cticket.status},on:{click:function(t){return e.$emit("updateTicket:reabrir")}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Reabrir Ticket\n            ")])],1):e._e(),"whatsapp"===e.ticketFocado.channel?t("q-btn",{staticClass:"btn-rounded",class:{"text-green bg-black":e.$q.dark.isActive,"tab-item":!e.$q.dark.isActive},attrs:{flat:"",icon:"eva-clock-outline",disable:"closed"==e.cticket.status||"pending"==e.cticket.status},on:{click:function(t){return e.$emit("abrir:modalAgendamentoMensagem")}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Agendamento de mensagem\n            ")])],1):e._e(),t("q-btn",{staticClass:"btn-rounded",class:{"text-green bg-black":e.$q.dark.isActive,"tab-item":!e.$q.dark.isActive},attrs:{flat:"",icon:"eva-arrow-back-outline",disable:"closed"==e.cticket.status||"pending"==e.cticket.status},on:{click:function(t){return e.$emit("updateTicket:retornar")}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Retornar Ticket para a Fila\n            ")])],1),t("q-btn",{staticClass:"btn-rounded",class:{"text-green bg-black":e.$q.dark.isActive,"tab-item":!e.$q.dark.isActive},attrs:{flat:"",icon:"eva-checkmark-circle-2-outline",disable:"closed"==e.cticket.status},on:{click:function(t){return e.$emit("updateTicket:resolver")}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Resolver\n            ")])],1),t("q-btn",{staticClass:"btn-rounded",class:{"text-green bg-black":e.$q.dark.isActive,"tab-item":!e.$q.dark.isActive},attrs:{flat:"",disable:"closed"==e.cticket.status},on:{click:e.listarFilas}},[t("q-icon",{attrs:{name:"eva-corner-down-right-outline"}}),t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n              Transferir\n            ")])],1)]],2):e._e()],1),t("q-separator")],1),t("q-dialog",{attrs:{persistent:""},on:{hide:function(t){e.modalTransferirTicket=!1}},model:{value:e.modalTransferirTicket,callback:function(t){e.modalTransferirTicket=t},expression:"modalTransferirTicket"}},[t("q-card",{staticClass:"q-pa-md",staticStyle:{width:"500px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("Selecione o destino:")])]),t("q-card-section",[t("q-select",{attrs:{square:"",outlined:"",options:e.filas,"emit-value":"","map-options":"","option-value":"id","option-label":"queue",label:"Fila de destino"},model:{value:e.filaSelecionada,callback:function(t){e.filaSelecionada=t},expression:"filaSelecionada"}})],1),t("q-card-section",[t("q-select",{attrs:{square:"",outlined:"",options:e.usuarios.filter(e.filterUsers),"emit-value":"","map-options":"","option-value":"id","option-label":"name",label:"Usuário destino"},model:{value:e.usuarioSelecionado,callback:function(t){e.usuarioSelecionado=t},expression:"usuarioSelecionado"}})],1),t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mr-lg",attrs:{label:"Sair",color:"negative"}}),t("q-btn",{attrs:{label:"Salvar",color:"primary"},on:{click:e.confirmarTransferenciaTicket}})],1)],1)],1)],1)},r=[],c=a("2f62"),l=a("9a1b"),d=a("ee0e"),m=a("c5bd");const u=+localStorage.getItem("userId");var g={name:"InfoCabecalhoMensagens",data(){return{userProfile:"user",userReopenTicket:null,modalTransferirTicket:!1,usuarioSelecionado:null,filaSelecionada:null,usuarios:[],filas:[],pageNumber:1,hasMore:!0}},computed:{...Object(c["b"])(["ticketFocado"]),cticket(){const e={contact:{profilePicUrl:"",name:""},user:{name:""}};return Object.keys(this.ticketFocado).includes("contact")?this.ticketFocado:e}},methods:{async listarConfiguracoes(){const e=JSON.parse(localStorage.getItem("configuracoes")),t=null===e||void 0===e?void 0:e.find((e=>"userReopenTicket"===e.key));t&&(this.userReopenTicket="enabled"===t.value)},Value(e,t){try{return e[t]}catch(a){return""}},filterUsers(e,t,a){const i=this.filaSelecionada;if(null==i)return!0;const s=e.queues.filter((function(e,t,a){return e.id==i}));return s.length>0},async listarFilas(){try{const{data:e}=await Object(d["d"])();this.filas=e.filter((e=>e.isActive)),this.modalTransferirTicket=!0,this.listarUsuarios()}catch(e){console.error(e),this.$notificarErro("Problema ao carregar filas",e)}},async listarUsuarios(){try{const{data:e}=await Object(l["e"])({pageNumber:this.pageNumber});this.usuarios=[...this.usuarios,...e.users],this.hasMore=e.hasMore,this.modalTransferirTicket=!0,this.hasMore&&(this.pageNumber+=1,this.listarUsuarios())}catch(e){console.error(e),this.$notificarErro("Problema ao carregar usuários",e)}},async confirmarTransferenciaTicket(){this.filaSelecionada&&(this.ticketFocado.userId!==this.usuarioSelecionado||null==this.ticketFocado.userId?this.ticketFocado.userId!==u||u!==this.usuarioSelecionado?this.ticketFocado.queueId!==this.filaSelecionada||this.ticketFocado.userId!==this.usuarioSelecionado?(await Object(m["c"])(this.ticketFocado.id,{userId:this.usuarioSelecionado,queueId:this.filaSelecionada,status:null==this.usuarioSelecionado?"pending":"open",isTransference:1}),this.$q.notify({type:"positive",message:"Ticket transferido.",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.modalTransferirTicket=!1,this.$store.commit("TICKET_FOCADO",{})):this.$q.notify({type:"info",message:"Ticket já pertece a esta fila e usuário",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}):this.$q.notify({type:"info",message:"Ticket já pertece ao seu usuário",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}):this.$q.notify({type:"info",message:"Ticket já pertece ao usuário selecionado.",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}))}},mounted(){this.listarConfiguracoes(),this.userProfile=localStorage.getItem("profile")}},p=g,h=a("2877"),v=a("e359"),b=a("65c6"),f=a("9c40"),q=a("66e5"),k=a("4074"),y=a("cb32"),x=a("068f"),M=a("0170"),w=a("293e"),C=a("2c91"),S=a("05c0"),$=a("0016"),A=a("c294"),E=a("72db"),_=a("eb85"),T=a("24e8"),I=a("f09f"),R=a("a370"),P=a("ddd8"),D=a("4b7e"),F=a("714f"),j=a("7f67"),Q=a("eebe"),O=a.n(Q),L=Object(h["a"])(p,o,r,!1,null,null,null),z=L.exports;O()(L,"components",{QHeader:v["a"],QToolbar:b["a"],QBtn:f["a"],QItem:q["a"],QItemSection:k["a"],QAvatar:y["a"],QImg:x["a"],QItemLabel:M["a"],QSkeleton:w["a"],QSpace:C["a"],QTooltip:S["a"],QIcon:$["a"],QFab:A["a"],QFabAction:E["a"],QSeparator:_["a"],QDialog:T["a"],QCard:I["a"],QCardSection:R["a"],QSelect:P["a"],QCardActions:D["a"]}),O()(L,"directives",{Ripple:F["a"],ClosePopup:j["a"]});var B=a("ef42"),U=a("f9c6"),N=a("fcbb"),V=a("0b67"),K=a("e166"),H=a.n(K),J=a("73ad"),W=a("cd82"),Z=a.n(W),G=a("cd36"),X=a.n(G),Y={name:"Chat",mixins:[n["a"],N["a"],V["a"]],props:{mensagensRapidas:Array},components:{InforCabecalhoChat:z,MensagemChat:B["a"],InputMensagem:U["default"],InfiniteLoading:H.a},data(){return{userProfile:"user",scrollIcon:!1,loading:!1,exibirContato:!1,heigthInputMensagem:0,params:{ticketId:null,pageNumber:1},agendamentoMensagem:{scheduleDate:""},replyingMessage:null,modalAgendamentoMensagem:!1,modalEncaminhamentoMensagem:!1,mensagemEncaminhamento:{},userSpyTicket:null,mensagensParaEncaminhar:[],ativarMultiEncaminhamento:!1,contatoSelecionado:{id:"",name:""},contatos:[]}},computed:{cMessages(){return this.replyingMessage=null,this.mensagensTicket},style(){return{backgroundImage:this.$q.dark.isActive?`url(${X.a}) !important`:`url(${Z.a}) !important`,backgroundPosition:"center !important"}},cStyleScroll(){const e=0,t=this.heigthInputMensagem+e;return`min-height: calc(100vh - ${62+t}px); height: calc(100vh - ${62+t}px); width: 100%`}},methods:{async listarConfiguracoes(){const e=JSON.parse(localStorage.getItem("configuracoes")),t=null===e||void 0===e?void 0:e.find((e=>"spyticket"===e.key));t&&(this.userSpyTicket="enabled"===t.value)},generateMediaUrl(){return"http://localhost:3100/public/logos/atendimento.png"},onClickOpenAgendamentoMensagem(){this.$q.dialog({component:()=>a.e(29).then(a.bind(null,"69d0")),parent:this,mensagensRapidas:this.mensagensRapidas,replyingMessage:this.replyingMessage})},async onResizeInputMensagem(e){this.heigthInputMensagem=e.height},async onLoadMore(e){var t;if(!this.loading){if(!this.hasMore||null===(t=this.ticketFocado)||void 0===t||!t.id)return e.complete();try{this.loading=!0,this.params.ticketId=this.ticketFocado.id,this.params.pageNumber+=1,await this.$store.dispatch("LocalizarMensagensTicket",this.params),this.loading=!1,e.loaded()}catch(a){e.complete()}this.loading=!1}},scrollArea(e){this.hideOptions=!0,setTimeout((()=>{e&&(this.scrollIcon=e.verticalSize-(e.verticalPosition+e.verticalContainerSize)>2e3)}),200)},scrollToBottom(){document.getElementById("inicioListaMensagensChat").scrollIntoView()},abrirModalEncaminharMensagem(e){this.mensagemEncaminhamento=e,this.modalEncaminhamentoMensagem=!0},async localizarContato(e,t,a){if(e.length<2)return this.contatos.length&&t((()=>{this.contatos=[...this.contatos]})),void a();this.loading=!0;const{data:i}=await Object(J["h"])({searchParam:e});t((()=>{i.contacts.length?this.contatos=i.contacts:this.contatos=[{}]})),this.loading=!1},cancelarMultiEncaminhamento(){this.mensagensParaEncaminhar=[],this.ativarMultiEncaminhamento=!1},confirmarEncaminhamentoMensagem(e){this.contatoSelecionado.id?Object(m["l"])(e,this.contatoSelecionado).then((e=>{this.$notificarSucesso(`Mensagem encaminhada para ${this.contatoSelecionado.name} | Número: ${this.contatoSelecionado.number}`),this.mensagensParaEncaminhar=[],this.ativarMultiEncaminhamento=!1})).catch((e=>{this.$notificarErro("Não foi possível encaminhar mensagem. Tente novamente em alguns minutos!",e)})):this.$notificarErro("Selecione o contato de destino das mensagens.")}},created(){this.$root.$on("scrollToBottomMessageChat",this.scrollToBottom),this.socketTicket()},mounted(){this.listarConfiguracoes(),this.socketMessagesList(),this.userProfile=localStorage.getItem("profile")},destroyed(){this.$root.$off("scrollToBottomMessageChat",this.scrollToBottom)}},ee=Y,te=(a("3ec7"),a("4983")),ae=a("7ff0"),ie=a("1c1c"),se=a("54e1"),ne=a("3980"),oe=Object(h["a"])(ee,i,s,!1,null,null,null);t["default"]=oe.exports;O()(oe,"components",{QScrollArea:te["a"],QBtn:f["a"],QTooltip:S["a"],QFooter:ae["a"],QSeparator:_["a"],QList:ie["a"],QItem:q["a"],QCard:I["a"],QItemSection:k["a"],QItemLabel:M["a"],QBanner:se["a"],QSelect:P["a"],QResizeObserver:ne["a"],QDialog:T["a"],QCardSection:R["a"],QCardActions:D["a"]}),O()(oe,"directives",{ClosePopup:j["a"]})},cfdb:function(e,t,a){"use strict";a("d2bc")},d2bc:function(e,t,a){},eb0b:function(e,t,a){},f9c6:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.cMensagensRapidas.length>0&&"open"===e.ticketFocado.status?t("div",{staticClass:"bg-transparent fast-messages-list"},e._l(e.cMensagensRapidas,(function(a,i){return t("q-badge",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:a.key,staticClass:"text-white item-fast-messages-list q-pa-sm",class:e.getBadgeClass(i),attrs:{clickable:""},on:{click:function(t){return e.mensagemRapidaSelecionada(a)}}},[t("q-item-label",{staticClass:"text-bold"},[e._v("\n        "+e._s(a.key)+"\n      ")]),t("q-tooltip",{attrs:{"content-class":"bg-padrao text-grey-9 text-bold",anchor:"top middle",self:"bottom middle"}},[e._v("\n        "+e._s(a.message)+"\n      ")])],1)})),1):e._e(),t("div",{on:{drop:function(t){return t.preventDefault(),e.handleFileDrop.apply(null,arguments)},dragover:function(e){e.preventDefault()}}},[t("div",{staticClass:"drop-area",on:{drop:e.handleFileDrop,dragover:e.handleDragOver,dragleave:e.handleDragLeave}},[e.isScheduleDate?t("div",{staticClass:"row q-col-gutter-md"},[t("div",{staticClass:"col-xs-12 col-md-6"},[t("q-select",{attrs:{options:e.schedule.options,"map-options":"",outlined:""},on:{input:e.onSelectSchedule},model:{value:e.schedule.selected,callback:function(t){e.$set(e.schedule,"selected",t)},expression:"schedule.selected"}})],1),t("div",{staticClass:"col-xs-12 col-md-6"},[t("q-datetime-picker",{attrs:{outlined:"","stack-label":"",label:"Data/Hora Agendamento",mode:"datetime",format24h:"",readonly:"custom"!==e.schedule.selected.value},model:{value:e.scheduleDate,callback:function(t){e.scheduleDate=t},expression:"scheduleDate"}})],1)]):e._e(),t("div",{staticClass:"q-py-md row bg-white justify-start items-center text-grey-9 relative-position"},[e.isRecordingAudio?[t("div",{staticClass:"full-width items-center row justify-end"},[t("q-skeleton",{staticClass:"col-grow q-mx-md",attrs:{animation:"pulse-y",type:"text"}}),e.isRecordingAudio?t("div",{staticClass:"flex flex-center items-center",staticStyle:{width:"200px"}},[t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",icon:"mdi-close",color:"negative"},on:{click:e.handleCancelRecordingAudio}}),t("RecordingTimer",{staticClass:"text-bold",class:{"text-green":e.$q.dark.isActive}}),t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",icon:"mdi-send-circle-outline",color:"positive"},on:{click:e.handleStopRecordingAudio}})],1):e._e()],1)]:[e.$q.screen.width>500?t("q-btn",{staticClass:"btn-rounded q-mx-xs",class:{"text-green bg-black":e.$q.dark.isActive,"":!e.$q.dark.isActive},attrs:{flat:"",dense:"",icon:"mdi-emoticon-happy-outline",disable:e.cDisableActions,color:e.$q.dark.isActive?"green":""}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v(" Emoji ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:e.calculateEmojisByRow(),labelSearch:"Localizar...",lang:"pt-BR"},on:{select:e.onInsertSelectEmoji}})],1)],1):e._e(),e.$q.screen.width>500?t("q-btn",{class:{"text-green bg-black":e.$q.dark.isActive,"tab-item":!e.$q.dark.isActive},attrs:{flat:"",dense:"",round:"",icon:"eva-plus-outline"}},[t("q-menu",[t("q-list",{staticStyle:{"min-width":"100px"}},[t("q-item",{staticClass:"text-left",staticStyle:{padding:"0"}},[t("q-btn",{staticClass:"btn-rounded full-width",attrs:{flat:"",icon:"mdi-paperclip",disable:e.cDisableActions||e.desabilitarInput,color:e.$q.dark.isActive?"green":"",label:"Enviar arquivo"},on:{click:e.abrirEnvioArquivo}})],1),t("q-item",{staticStyle:{padding:"0"}},[t("q-btn",{attrs:{flat:"",icon:"mdi-message-video",disable:e.cDisableActions||e.desabilitarInput,color:e.$q.dark.isActive?"green":"",label:"Enviar videoconferência"},on:{click:e.handlSendLinkVideo}})],1)],1)],1)],1):e._e(),e.mensagemRapidaMedia?t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",dense:"",icon:"mdi-cancel",color:(e.$q.dark.isActive,"red")},on:{click:e.removerMediaMensagemRapida}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v(" Remover Mídia da Mensagem Rápida ")])],1):e._e(),t("q-input",{directives:[{name:"show",rawName:"v-show",value:!e.cMostrarEnvioArquivo,expression:"!cMostrarEnvioArquivo"}],ref:"inputEnvioMensagem",staticClass:"col-grow q-mx-xs text-grey-10 inputEnvioMensagem",attrs:{"hide-bottom-space":"",loading:e.loading,disable:e.cDisableActions,id:"inputEnvioMensagem",type:"textarea","bg-color":"grey-2",color:"grey-7",placeholder:"Digita sua mensagem","input-style":"max-height: 30vh",autogrow:"",rounded:"",dense:"",outlined:"",value:e.textChat},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),(()=>e.textChat.trim().length?e.enviarMensagem():"").apply(null,arguments))},paste:e.handleInputPaste},scopedSlots:e._u([e.$q.screen.width<500?{key:"prepend",fn:function(){return[t("q-btn",{attrs:{flat:"",icon:"mdi-emoticon-happy-outline",disable:e.cDisableActions,dense:"",round:"",color:e.$q.dark.isActive?"green":""}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v(" Emoji ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:e.calculateEmojisByRow(),labelSearch:"Localizar...",lang:"pt-BR"},on:{select:e.onInsertSelectEmoji}})],1)],1)]},proxy:!0}:null,{key:"append",fn:function(){return[e.$q.screen.width<500?t("q-btn",{staticClass:"bg-padrao full-width",attrs:{flat:"",icon:"mdi-paperclip",disable:e.cDisableActions,dense:"",round:"",color:e.$q.dark.isActive?"green":""},on:{click:e.abrirEnvioArquivo}},[t("q-tooltip",{attrs:{"content-class":" text-bold"}},[e._v(" Enviar arquivo ")])],1):e._e(),"admin"===e.userProfile?t("q-toggle",{staticClass:"q-mx-sm q-ml-md",attrs:{"keep-color":"",dense:"",color:e.sign?"positive":"black",type:"toggle"},on:{input:e.handleSign},model:{value:e.sign,callback:function(t){e.sign=t},expression:"sign"}},[t("q-tooltip",[e._v(" "+e._s(e.sign?"Desativar":"Ativar")+" Assinatura ")])],1):e._e(),e.disabledSign&&"admin"!==e.userProfile?t("q-toggle",{staticClass:"q-mx-sm q-ml-md",attrs:{"keep-color":"",dense:"",color:e.sign?"positive":"black",type:"toggle"},on:{input:e.handleSign},model:{value:e.sign,callback:function(t){e.sign=t},expression:"sign"}},[t("q-tooltip",[e._v(" "+e._s(e.sign?"Desativar":"Ativar")+" Assinatura ")])],1):e._e()]},proxy:!0}],null,!0),model:{value:e.textChat,callback:function(t){e.textChat=t},expression:"textChat"}}),t("q-file",{directives:[{name:"show",rawName:"v-show",value:e.cMostrarEnvioArquivo,expression:"cMostrarEnvioArquivo"}],ref:"PickerFileMessage",staticClass:"col-grow q-mx-xs PickerFileMessage",attrs:{loading:e.loading,disable:e.cDisableActions||e.desabilitarInput,id:"PickerFileMessage","bg-color":"blue-grey-1","input-style":"max-height: 30vh",outlined:"","use-chips":"",multiple:"",autogrow:"",dense:"",rounded:"",append:"","max-files":5,"max-file-size":"hub_instagram"===e.ticketFocado.channel?8388608:52428800,"max-total-size":"hub_instagram"===e.ticketFocado.channel?8388608:52428800,accept:"hub_instagram"===e.ticketFocado.channel?".jpeg, .png, .ico, .bmp, .webp, .*":".txt, .xml, .jpg, .png, image/jpeg, .pdf, .doc, .docx, .mp4, .ogg, .mp3, .xls, .xlsx, .jpeg, .rar, .zip, .ppt, .pptx, image/*"},on:{rejected:e.onRejectedFiles},model:{value:e.arquivos,callback:function(t){e.arquivos=t},expression:"arquivos"}}),e.textChat||e.cMostrarEnvioArquivo||e.removeMedia?t("q-btn",{ref:"btnEnviarMensagem",staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{disabled:"open"!==e.ticketFocado.status,flat:"",icon:"mdi-send",color:e.$q.dark.isActive?"green":""},on:{click:e.enviarMensagem}},[t("q-tooltip",{attrs:{"content-class":" text-bold"}},[e._v(" Enviar Mensagem ")])],1):e._e(),e.textChat||e.cMostrarEnvioArquivo||e.isRecordingAudio?e._e():t("q-btn",{staticClass:"btn-rounded q-mx-xs",class:{"text-green bg-black":e.$q.dark.isActive,"":!e.$q.dark.isActive},attrs:{disabled:e.cDisableActions||e.desabilitarInput,flat:"",icon:"eva-mic-outline",color:e.$q.dark.isActive?"green":""},on:{click:e.handleSartRecordingAudio}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v(" Enviar Áudio ")])],1)]],2),t("q-dialog",{attrs:{position:"right"},on:{hide:e.hideModalPreviewImagem,show:e.showModalPreviewImagem},model:{value:e.abrirModalPreviewImagem,callback:function(t){e.abrirModalPreviewImagem=t},expression:"abrirModalPreviewImagem"}},[t("q-card",{staticClass:"q-pa-md",staticStyle:{height:"90vh","min-width":"60vw","max-width":"60vw"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("\n              "+e._s(e.urlMediaPreview.title)+"\n              "),t("q-btn",{staticClass:"float-right",attrs:{icon:"close",color:"negative",round:"",outline:""},on:{click:e.hideModalPreviewImagem}})],1)]),t("q-card-section",[t("q-img",{staticClass:"img-responsive mdi-image-auto-adjust q-uploader__file--img",staticStyle:{height:"60vh","min-width":"55vw","max-width":"55vw"},attrs:{src:e.urlMediaPreview.src,"spinner-color":"green"}})],1),t("q-card-actions",{attrs:{align:"center"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],ref:"qbtnPasteEnvioMensagem",attrs:{label:"Enviar",color:"primary"},on:{click:e.enviarMensagem,keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.enviarMensagem()}}})],1),t("span",{staticClass:"row col text-caption text-blue-grey-10"},[e._v("* Confirmar envio: Enter")]),t("span",{staticClass:"row col text-caption text-blue-grey-10"},[e._v("** Cancelar: ESC")])],1)],1)],1)])])},s=[],n=(a("88a7"),a("271a"),a("5494"),a("18d6")),o=a("1732"),r=a("a700"),c=a("c5bd"),l=a("79b5"),d=a("2f62"),m=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"timerBox"},[t("span",[e._v(e._s(e.addZero(e.timer.minutes))+":"+e._s(e.addZero(e.timer.seconds)))])])])},u=[],g={name:"RecordingTimer",data(){return{timer:{minutes:0,seconds:0}}},methods:{interval(){setInterval((()=>{59===this.timer.seconds&&(this.timer={...this.timer,minutes:this.timer.minutes+1,seconds:0}),this.timer={...this.timer,seconds:this.timer.seconds+1}}),1e3)},stopInteval(){clearInterval(this.interval)},addZero(e){return e<10?"0"+e:e}},mounted(){this.interval()},destroyed(){this.stopInteval()}},p=g,h=(a("7466"),a("2877")),v=Object(h["a"])(p,m,u,!1,null,"3fda5757",null),b=v.exports,f=a("9de0"),q=a.n(f),k=a("2230"),y=a("b166"),x=a("7963");const M=new q.a({bitRate:128});var w={name:"InputMensagem",mixins:[r["a"]],props:{replyingMessage:{type:Object,default:null},isScheduleDate:{type:Boolean,default:!1},mensagensRapidas:{type:Array,default:()=>[]}},components:{VEmojiPicker:l["a"],RecordingTimer:b},data(){return{schedule:{selected:{label:"Agendamento customizado",value:"custom",func:null},options:[{label:"Agendamento customizado",value:"custom",func:null},{label:"Em 30 minutos",value:"30_mins",func:()=>Object(k["a"])(new Date,{minutes:30})},{label:"Amanhã",value:"amanha",func:()=>Object(k["a"])(new Date,{days:1})},{label:"Próxima semana",value:"prox_semana",func:()=>Object(k["a"])(new Date,{weeks:1})}]},loading:!1,abrirFilePicker:!1,abrirModalPreviewImagem:!1,isRecordingAudio:!1,urlMediaPreview:{title:"",src:""},visualizarMensagensRapidas:!1,arquivos:[],textChat:"",sign:!1,scheduleDate:null,userProfile:"user",mensagemRapidaMedia:"",mensagemRapidaSetada:!1,removeMedia:!1,disabledSign:!1}},computed:{...Object(d["b"])(["ticketFocado"]),cMostrarEnvioArquivo(){return this.arquivos.length>0},cDisableActions(){return this.isRecordingAudio||"open"!==this.ticketFocado.status},cMensagensRapidas(){var e;let t=null===(e=this.textChat)||void 0===e?void 0:e.toLowerCase();return t&&t.trim().startsWith("/")&&(t=t.replace("/","")),t?this.mensagensRapidas.filter((e=>-1!==e.key.toLowerCase().indexOf(t))):this.mensagensRapidas}},methods:{onSelectSchedule(e){if(!e.func)return void(this.scheduleDate=null);const t=e.func();this.scheduleDate=Object(y["a"])(t,"yyyy-MM-dd HH:mm")},handleFileDrop(e){const t=e.dataTransfer.files;var a,i;t.length&&(this.textChat="",this.arquivos=[t[0]],this.abrirModalPreviewImagem=!0,this.urlMediaPreview={title:`Enviar imagem para ${null===(a=this.ticketFocado)||void 0===a||null===(i=a.contact)||void 0===i?void 0:i.name}`,src:this.openFilePreviewDD(t[0])},this.$refs.inputEnvioMensagem.focus())},handleDragOver(e){e.preventDefault(),e.currentTarget.classList.add("dragover")},handleDragLeave(e){e.currentTarget.classList.remove("dragover")},openFilePreviewDD(e){const t=window.URL.createObjectURL(e);return t},async listarConfiguracoes(){const{data:e}=await Object(x["b"])();this.configuracoes=e,this.configuracoes.forEach((e=>{let t=e.value;"botTicketActive"===e.key&&e.value&&(t=+e.value),this.$data[e.key]=t}));const t=this.configuracoes.filter((e=>"userDisableSignature"===e.key))[0];"enabled"===t.value?this.disabledSign=!0:(n["a"].set("sign",!0),this.disabledSign=!1)},openFilePreview(e){const t=e.clipboardData.files[0],a=window.URL.createObjectURL(t);return a},handleInputDrop(e){const t=this.accept.split(",").map((e=>e.trim()));this.textChat="",this.arquivos=[...this.arquivos,...[...e.dataTransfer.files].filter((e=>{const a=e.name.split(".").pop(),i=t.map((e=>e.replace(/\./g,"\\.").replace(/\*/g,".*"))).join("|"),s=new RegExp(`^(${i})$`,"i");return s.test(e.type)||s.test("."+a)}))],this.arquivos.length?this.$refs.inputEnvioMensagem.focus():this.$q.notify({message:"Arquivo inválido!",caption:`Formatos aceitos: ${t.join(", ")}`,type:"negative"})},handleInputPaste(e){var t,a,i;null!==(t=this.ticketFocado)&&void 0!==t&&t.id&&(e.clipboardData.files[0]&&(this.textChat="",this.arquivos=[e.clipboardData.files[0]],this.abrirModalPreviewImagem=!0,this.urlMediaPreview={title:`Enviar imagem para ${null===(a=this.ticketFocado)||void 0===a||null===(i=a.contact)||void 0===i?void 0:i.name}`,src:this.openFilePreview(e)},this.$refs.inputEnvioMensagem.focus()))},removerMediaMensagemRapida(){this.removeMedia=!1,this.mensagemRapidaMedia="",this.mensagemRapidaSetada=!1},mensagemRapidaSelecionada(e){"null"!==e.message&&(this.textChat=e.message),null!==this.mensagemRapidaMedia&&(this.mensagemRapidaMedia=e.media,this.removeMedia=!0),null!==this.mensagemRapidaMedia&&(this.mensagemRapidaSetada=!0,this.removeMedia=!0),setTimeout((()=>{this.$refs.inputEnvioMensagem.focus()}),300)},onInsertSelectEmoji(e){const t=this;var a=this.$refs.inputEnvioMensagem.$refs.input,i=a.selectionStart,s=a.selectionEnd,n=i,o=a.value;e.data&&(t.txtContent=this.textChat,t.txtContent=o.substring(0,i)+e.data+o.substring(s,o.length),this.textChat=t.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=n+e.data.length}),10))},abrirEnvioArquivo(e){this.textChat="",this.abrirFilePicker=!0,this.$refs.PickerFileMessage.pickFiles(e)},async handleSartRecordingAudio(){try{await navigator.mediaDevices.getUserMedia({audio:!0}),await M.start(),this.isRecordingAudio=!0}catch(e){this.isRecordingAudio=!1}},async handleStopRecordingAudio(){this.loading=!0;try{const[,e]=await M.stop().getMp3();if(e.size<1e4)return this.loading=!1,void(this.isRecordingAudio=!1);const t=new FormData,a=`${(new Date).getTime()}.mp3`;t.append("medias",e,a),t.append("body",a),t.append("fromMe",!0),this.isScheduleDate&&t.append("scheduleDate",this.scheduleDate);const i=this.ticketFocado.id;await Object(c["m"])(i,t),this.arquivos=[],this.textChat="",this.$emit("update:replyingMessage",null),this.abrirFilePicker=!1,this.abrirModalPreviewImagem=!1,this.isRecordingAudio=!1,this.loading=!1,setTimeout((()=>{this.scrollToBottom()}),300)}catch(e){this.isRecordingAudio=!1,this.loading=!1,this.$notificarErro("Ocorreu um erro!",e)}},async handleCancelRecordingAudio(){try{await M.stop().getMp3(),this.isRecordingAudio=!1,this.loading=!1}catch(e){this.$notificarErro("Ocorreu um erro!",e)}},prepararUploadMedia(){if(!this.arquivos.length)throw new Error("Não existem arquivos para envio");const e=new FormData;return e.append("fromMe",!0),this.arquivos.forEach((t=>{e.append("medias",t),e.append("body",t.name),e.append("idFront",Object(o["a"])()),this.isScheduleDate&&e.append("scheduleDate",this.scheduleDate)})),e},prepararMensagemTexto(){if(""===this.textChat.trim()&&!this.removeMedia)throw new Error("Mensagem Inexistente");if(this.textChat.trim()&&this.textChat.trim().startsWith("/")){let e=this.textChat.trim().toLowerCase();e=e.replace("/","");const t=this.cMensagensRapidas.find((t=>t.key.toLowerCase()===e));if(null===t||void 0===t||!t.message){const e=this.cMensagensRapidas.length>1?"Várias mensagens rápidas encontradas. Selecione uma ou digite uma chave única da mensagem.":"/ indica que você deseja enviar uma mensagem rápida, mas nenhuma foi localizada. Cadastre ou apague a / e digite sua mensagem.";throw this.$notificarErro(e),this.loading=!1,console.error(e),new Error(e)}this.textChat=t.message}let e=this.textChat.trim();const t=localStorage.getItem("username");t&&this.sign&&(e=`*${t}*:\n ${e}`);const a={read:1,fromMe:!0,mediaUrl:this.mensagemRapidaSetada?`${this.mensagemRapidaMedia}`:"",body:e,scheduleDate:this.isScheduleDate?this.scheduleDate:null,quotedMsg:this.replyingMessage,idFront:Object(o["a"])()};return this.isScheduleDate&&(a.scheduleDate=this.scheduleDate),a},async enviarMensagem(){if(this.isScheduleDate&&!this.scheduleDate)return void this.$notificarErro("Para agendar uma mensagem, informe o campo Data/Hora Agendamento.");this.loading=!0,this.mensagemRapidaSetada&&(this.cMostrarEnvioArquivo=!1);const e=this.ticketFocado.id,t=this.cMostrarEnvioArquivo?this.prepararUploadMedia():this.prepararMensagemTexto();try{if(!this.cMostrarEnvioArquivo&&!this.textChat&&!this.removeMedia)return;await Object(c["m"])(e,t),this.arquivos=[],this.textChat="",this.$emit("update:replyingMessage",null),this.abrirFilePicker=!1,this.abrirModalPreviewImagem=!1,setTimeout((()=>{this.scrollToBottom()}),300)}catch(a){this.isRecordingAudio=!1,this.removeMedia=!1,this.mensagemRapidaMedia="",this.mensagemRapidaSetada=!1,this.loading=!1,this.$notificarErro("Ocorreu um erro!",a),console.error("Erro ao enviar mensagem:",a)}this.removeMedia=!1,this.mensagemRapidaMedia="",this.mensagemRapidaSetada=!1,this.isRecordingAudio=!1,this.loading=!1,setTimeout((()=>{this.$refs.inputEnvioMensagem.focus()}),300)},async handlSendLinkVideo(){const e=`https://meet.jit.si/${Object(o["a"])()}/${Object(o["a"])()}`;let t=e;const a=localStorage.getItem("username");a&&this.sign&&(t=`*${a}*:\n ${t}`);const i={read:1,fromMe:!0,mediaUrl:"",body:t,scheduleDate:this.isScheduleDate?this.scheduleDate:null,quotedMsg:this.replyingMessage,idFront:Object(o["a"])(),ticket:this.ticketFocado,group:this.ticketFocado.isGroup};this.loading=!0;const s=this.ticketFocado.id;try{await Object(c["m"])(s,i),setTimeout((()=>{this.scrollToBottom()}),200),setTimeout((()=>{window.open(e,"_blank")}),800)}catch(n){this.loading=!1,this.$notificarErro("Ocorreu um erro!",n)}this.loading=!1},handlerInputMensagem(e){this.textChat=e.target.value},showModalPreviewImagem(){this.$nextTick((()=>{setTimeout((()=>{this.$refs.qbtnPasteEnvioMensagem.$el.focus()}),20)}))},hideModalPreviewImagem(){this.arquivos=[],this.urlMediaPreview={},this.abrirModalPreviewImagem=!1},onRejectedFiles(e){let t;t="hub_instagram"===this.ticketFocado.channel?"Ops... Ocorreu um erro! <br>\n    <ul>\n    <li>Cada arquivo deve ter no máximo 8MB.</li>\n    <li>Apenas arquivos nos formatos .jpeg, .png, .ico, .bmp, .webp e .* são aceitos.</li>\n    </ul>":"Ops... Ocorreu um erro! <br>\n    <ul>\n    <li>Verique o tamanho do arquivo.</li>\n    <li>Em caso de múltiplos arquivos, o tamanho total (soma de todos) deve ser de até 50MB.</li>\n    </ul>",this.$q.notify({html:!0,message:t,type:"negative",progress:!0,position:"top",actions:[{icon:"close",round:!0,color:"white"}]})},onResize(){this.$forceUpdate()},calculateEmojisByRow(){const e=window.innerWidth;return e<600?5:e>=600&&e<1200?10:20},getBadgeClass(e){const t=["bg-green-6","bg-orange-6","bg-teal-6","bg-blue-6","bg-deep-purple-6","bg-yellow-6","bg-brown-6","bg-cyan-6"],a=e%8;return t[a]},handleSign(e){this.sign=e,n["a"].set("sign",this.sign)}},mounted(){this.$root.$on("mensagem-chat:focar-input-mensagem",(()=>this.$refs.inputEnvioMensagem.focus()));const e=this;window.addEventListener("paste",e.handleInputPaste),this.listarConfiguracoes(),this.userProfile=localStorage.getItem("profile"),[null,void 0].includes(n["a"].getItem("sign"))||this.handleSign(n["a"].getItem("sign"))},beforeDestroy(){const e=this;window.removeEventListener("paste",e.handleInputPaste)},destroyed(){this.$root.$off("mensagem-chat:focar-input-mensagem")}},C=w,S=(a("cfdb"),a("58a81")),$=a("0170"),A=a("05c0"),E=a("ddd8"),_=a("52ee"),T=a("9c40"),I=a("4e73"),R=a("1c1c"),P=a("66e5"),D=a("27f9"),F=a("9564"),j=a("7d53"),Q=a("293e"),O=a("24e8"),L=a("f09f"),z=a("a370"),B=a("068f"),U=a("ee89"),N=a("4b7e"),V=a("7f67"),K=a("eebe"),H=a.n(K),J=Object(h["a"])(C,i,s,!1,null,"166cb384",null);t["default"]=J.exports;H()(J,"components",{QBadge:S["a"],QItemLabel:$["a"],QTooltip:A["a"],QSelect:E["a"],QDate:_["a"],QBtn:T["a"],QMenu:I["a"],QList:R["a"],QItem:P["a"],QInput:D["a"],QToggle:F["a"],QFile:j["a"],QSkeleton:Q["a"],QDialog:O["a"],QCard:L["a"],QCardSection:z["a"],QImg:B["a"],QUploader:U["a"],QCardActions:N["a"]}),H()(J,"directives",{ClosePopup:V["a"]})}}]);