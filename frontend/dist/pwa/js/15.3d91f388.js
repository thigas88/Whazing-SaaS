(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{5211:function(a,t,e){"use strict";e.r(t);var n=function(){var a=this,t=a._self._c;return"admin"===a.userProfile?t("div",[t("q-table",{staticClass:"contact-table my-sticky-dynamic container-rounded-10",attrs:{title:"Agendamentos",data:a.agendamentos,columns:a.columns,loading:a.loading,"row-key":"id","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:a.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(t){a.pagination=t},"virtual-scroll":a.onScroll},scopedSlots:a._u([{key:"top-left",fn:function(){return[t("div",[t("h2",{class:a.$q.dark.isActive?"text-green":""},[t("q-icon",{attrs:{name:"eva-clock-outline q-pr-sm"}}),a._v("\n          Agendamentos\n        ")],1),t("div",{staticClass:"contact-header full-width"},[t("DatePick",{staticClass:"row col",attrs:{dense:"",rounded:"",outlined:"",label:"Data Inicial"},on:{input:a.onDateChange},model:{value:a.params.startDate,callback:function(t){a.$set(a.params,"startDate",t)},expression:"params.startDate"}}),t("DatePick",{staticClass:"row col",attrs:{dense:"",rounded:"",outlined:"",label:"Data Final"},on:{input:a.onDateChange},model:{value:a.params.endDate,callback:function(t){a.$set(a.params,"endDate",t)},expression:"params.endDate"}})],1)])]},proxy:!0},{key:"body-cell-mediaUrl",fn:function(e){return[t("q-td",{attrs:{props:e}},[e.row.mediaUrl?t("span",[t("a",{staticStyle:{"text-decoration":"underline",cursor:"pointer"},attrs:{href:e.row.mediaUrl,target:"_blank"}},[a._v("\n            Abrir Arquivo\n          ")])]):t("span",[a._v("\n          Sem Arquivo\n        ")])])]}},{key:"body-cell-ticketId",fn:function(e){return[t("q-td",{attrs:{props:e}},[t("a",{attrs:{href:a.getTicketUrl(e.row.ticketId)}},[a._v(a._s(e.row.ticketId))])])]}},{key:"body-cell-contactId",fn:function(e){return[t("q-td",{attrs:{props:e}},[a._v("\n        "+a._s(e.row.contactName||"Carregando...")+"\n      ")])]}},{key:"body-cell-userId",fn:function(e){return[t("q-td",{attrs:{props:e}},[a._v("\n        "+a._s(a.formatUser(e.row.userId))+"\n      ")])]}},{key:"body-cell-createdAt",fn:function(e){return[t("q-td",{attrs:{props:e}},[a._v("\n        "+a._s(a.formatDate(e.row.createdAt))+"\n      ")])]}},{key:"body-cell-acoes",fn:function(e){return[t("q-td",{staticClass:"text-center"},[t("q-btn",{class:a.$q.dark.isActive?"text-green":"",attrs:{flat:"",round:"",icon:"eva-trash-outline"},on:{click:function(t){return a.deletarMensagem(e.row)}}})],1)]}},{key:"pagination",fn:function({pagination:t}){return[a._v("\n      "+a._s(a.agendamentos.length)+"/"+a._s(t.rowsNumber)+"\n    ")]}}],null,!1,1355479621)})],1):a._e()},s=[],r=e("c5bd"),o=e("9a1b"),i={name:"Protocolos",data(){return{userProfile:"user",contatosCache:{},usuarios:[],agendamentos:[],pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},params:{pageNumber:1,startDate:null,endDate:null,hasMore:!0},loading:!1,columns:[{name:"body",label:"Mensagem",field:a=>a.body.substring(0,20)+"...",align:"left"},{name:"mediaUrl",label:"Arquivo",field:"mediaUrl",align:"left"},{name:"ticketId",label:"Ticket",field:"ticketId",align:"left"},{name:"scheduleDate",label:"Data Envio",field:"scheduleDate",align:"left",format:a=>this.formatDate(a)},{name:"userId",label:"Usuário",field:"userId",align:"center",format:a=>this.formatUser(a)},{name:"createdAt",label:"Data foi agendado",field:"createdAt",align:"center",format:a=>this.formatDate(a)},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{deletarMensagem(a){this.$q.dialog({title:"Atenção!! Deseja realmente deletar essa mensagem? ",message:"Mensagens antigas não serão apagadas no cliente.",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(r["i"])(a).then((t=>{this.loading=!1,a.isDeleted=!0,window.location.reload()})).catch((a=>{this.loading=!1,console.error(a),this.$notificarErro("Não foi possível apagar a mensagem",a)}))})).onCancel((()=>{}))},async listarUsuarios(){const a=await Object(o["e"])();this.usuarios=a.data.users},async listarAgendamentos(){this.loading=!0;try{const a=await Object(r["o"])({startDate:this.params.startDate,endDate:this.params.endDate,pageNumber:this.params.pageNumber,tenantId:localStorage.getItem("tenantId")});a.data&&Array.isArray(a.data.messages)?(this.agendamentos=[...this.agendamentos,...await Promise.all(a.data.messages.map((async a=>a)))],this.pagination.rowsNumber=a.data.count||0,this.pagination.hasMore=a.data.hasMore):console.error("Resposta da API não está no formato esperado:",a.data)}catch(a){console.error("Erro ao listar agendamentos:",a)}finally{this.loading=!1}},formatUser(a){const t=this.usuarios.find((t=>t.id===a));return t?t.name:"Usuário não encontrado"},getTicketUrl(a){const t=this.$router.resolve({path:`/atendimento/${a}`});return t.href},formatDate(a){const t=new Date(a),e={timeZone:"America/Sao_Paulo",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1},n=new Intl.DateTimeFormat("pt-BR",e);return n.format(t).replace(",","")},async filtrarProtocolos(){this.params.pageNumber=1,this.params.hasMore=!0,this.agendamentos=[],await this.listarAgendamentos()},onDateChange(){this.params.startDate&&this.params.endDate&&this.filtrarProtocolos()},onScroll({to:a,ref:t,...e}){!this.loading&&this.params.hasMore&&a>=this.agendamentos.length-10&&(this.loading=!0,this.params.pageNumber++,this.listarAgendamentos())}},async mounted(){await this.listarAgendamentos(),await this.listarUsuarios(),this.userProfile=localStorage.getItem("profile")}},l=i,d=(e("f69d"),e("2877")),c=e("eaac"),u=e("0016"),m=e("db86"),g=e("9c40"),p=e("eebe"),f=e.n(p),h=Object(d["a"])(l,n,s,!1,null,null,null);t["default"]=h.exports;f()(h,"components",{QTable:c["a"],QIcon:u["a"],QTd:m["a"],QBtn:g["a"]})},ae51:function(a,t,e){},f69d:function(a,t,e){"use strict";e("ae51")}}]);