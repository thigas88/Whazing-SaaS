(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[26],{"0648":function(a,i,o){},"9bad":function(a,i,o){"use strict";o.r(i);var s=function(){var a=this,i=a._self._c;return"admin"===a.userProfile?i("div",[i("q-table",{staticClass:"contact-table my-sticky-dynamic container-rounded-10",attrs:{data:a.usuarios,title:"Usuários",columns:a.columns,loading:a.loading,"row-key":"id","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:a.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(i){a.pagination=i},"virtual-scroll":a.onScroll},scopedSlots:a._u([{key:"top-left",fn:function(){return[i("div",[i("h2",{class:a.$q.dark.isActive?"text-green":""},[i("q-icon",{attrs:{name:"mdi-account-group-outline q-pr-sm"}}),a._v("\n          Usuarios\n        ")],1),i("div",{staticClass:"row flex-gap-1"},[i("q-input",{staticClass:"contact-search col-grow",staticStyle:{width:"300px"},attrs:{filled:"",dense:"",debounce:"500",clearable:"",placeholder:"Localize"},on:{input:a.filtrarUsuario},scopedSlots:a._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!1,2901929698),model:{value:a.filter,callback:function(i){a.filter=i},expression:"filter"}}),i("q-btn",{staticClass:"generate-button btn-rounded-50 q-ml-md",class:{"text-green":a.$q.dark.isActive,"q-ml-none q-mt-md q-mr-md":a.$q.screen.width<500},attrs:{icon:"eva-plus-outline ",label:"Adicionar"},on:{click:function(i){a.usuarioSelecionado={},a.modalUsuario=!0}}})],1)])]},proxy:!0},{key:"body-cell-acoes",fn:function(o){return[i("q-td",{staticClass:"text-center"},[i("q-btn",{class:a.$q.dark.isActive?"text-green":"",attrs:{flat:"",round:"",icon:"mdi-arrow-decision-outline"},on:{click:function(i){return a.gerirFilasUsuario(o.row)}}},[i("q-tooltip",[a._v("\n            Gestão de Filas do usuário\n          ")])],1),i("q-btn",{class:a.$q.dark.isActive?"text-green":"",attrs:{flat:"",round:"",icon:"eva-edit-outline"},on:{click:function(i){return a.editarUsuario(o.row)}}}),i("q-btn",{class:a.$q.dark.isActive?"text-green":"",attrs:{flat:"",round:"",icon:"eva-trash-outline"},on:{click:function(i){return a.deletarUsuario(o.row)}}})],1)]}},{key:"pagination",fn:function({pagination:i}){return[a._v("\n      "+a._s(a.usuarios.length)+"/"+a._s(i.rowsNumber)+"\n    ")]}}],null,!1,2687989948)}),i("ModalUsuario",{attrs:{modalUsuario:a.modalUsuario,usuarioEdicao:a.usuarioSelecionado},on:{"update:modalUsuario":function(i){a.modalUsuario=i},"update:modal-usuario":function(i){a.modalUsuario=i},"modalUsuario:usuario-editado":a.UPDATE_USUARIO,"modalUsuario:usuario-criado":a.usuarioCriado,"update:usuarioEdicao":function(i){a.usuarioSelecionado=i},"update:usuario-edicao":function(i){a.usuarioSelecionado=i}}}),i("ModalFilaUsuario",{attrs:{modalFilaUsuario:a.modalFilaUsuario,usuarioSelecionado:a.usuarioSelecionado,filas:a.filas},on:{"update:modalFilaUsuario":function(i){a.modalFilaUsuario=i},"update:modal-fila-usuario":function(i){a.modalFilaUsuario=i},"update:usuarioSelecionado":function(i){a.usuarioSelecionado=i},"update:usuario-selecionado":function(i){a.usuarioSelecionado=i},"modalFilaUsuario:sucesso":a.UPDATE_USUARIO}})],1):a._e()},e=[],t=(o("14d9"),o("9a1b")),r=o("ee0e"),l=o("25c4"),n=function(){var a=this,i=a._self._c;return i("q-dialog",{attrs:{persistent:"",value:a.modalFilaUsuario},on:{hide:a.fecharModal,show:a.abrirModal}},[i("q-card",{staticClass:"q-pa-lg container-rounded-10"},[i("q-card-section",{staticClass:"q-pa-none"},[i("div",{staticClass:"full-width text-h6 row col font-family-main q-pa-sm"},[a._v("Filas Usuário")]),i("div",{staticClass:"text-caption text-bold row col q-px-sm q-pt-sm",staticStyle:{"font-size":"1em"}},[a._v("Nome: "+a._s(a.usuarioSelecionado.name))]),i("div",{staticClass:"text-caption text-bold row col q-px-sm",staticStyle:{"font-size":"1em"}},[a._v("Email: "+a._s(a.usuarioSelecionado.email))]),i("q-separator",{attrs:{spaced:""}})],1),i("q-card-section",[a._l(a.filas,(function(o){return[i("div",{key:o.id,staticClass:"row col"},[i("q-checkbox",{attrs:{disable:!o.isActive,label:`${o.queue} ${o.isActive?"":"(Inativo)"}`,val:o.id},model:{value:a.filasUsuario,callback:function(i){a.filasUsuario=i},expression:"filasUsuario"}})],1)]}))],2),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-sm btn-rounded-50",attrs:{label:"Cancelar",color:"negative"}}),i("q-btn",{staticClass:"btn-rounded-50 generate-button",attrs:{label:"Salvar",icon:"eva-save-outline"},on:{click:a.handleFilaUsuario}})],1)],1)],1)},u=[],c={name:"ModalFilaUsuario",props:{modalFilaUsuario:{type:Boolean,default:!1},usuarioSelecionado:{type:Object,default:()=>({id:null})},filas:{type:Array,default:()=>[]}},data(){return{filasUsuario:[]}},methods:{abrirModal(){this.usuarioSelecionado.id&&(this.filasUsuario=[...this.usuarioSelecionado.queues.map((a=>a.id))])},fecharModal(){this.$emit("update:usuarioSelecionado",{}),this.$emit("update:modalFilaUsuario",!1)},async handleFilaUsuario(){const a={...this.usuarioSelecionado,queues:[...this.filasUsuario]},{data:i}=await Object(t["h"])(a.id,a);this.$emit("modalFilaUsuario:sucesso",i),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Filas do usuário editadas com sucesso!",actions:[{icon:"close",round:!0,color:"white"}]}),this.fecharModal()}}},d=c,m=o("2877"),p=o("24e8"),f=o("f09f"),h=o("a370"),U=o("eb85"),b=o("8f8e"),g=o("4b7e"),v=o("9c40"),q=o("7f67"),S=o("eebe"),w=o.n(S),y=Object(m["a"])(d,n,u,!1,null,"26272582",null),x=y.exports;w()(y,"components",{QDialog:p["a"],QCard:f["a"],QCardSection:h["a"],QSeparator:U["a"],QCheckbox:b["a"],QCardActions:g["a"],QBtn:v["a"]}),w()(y,"directives",{ClosePopup:q["a"]});var k={name:"IndexUsuarios",components:{ModalUsuario:l["a"],ModalFilaUsuario:x},data(){return{userProfile:"user",usuarios:[],usuarioSelecionado:{},modalFilaUsuario:!1,filas:[],optionsProfile:[{value:"user",label:"Usuário"},{value:"admin",label:"Administrador"}],modalUsuario:!1,filter:null,pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},params:{pageNumber:1,searchParam:null,hasMore:!0},loading:!1,columns:[{name:"id",label:"#",field:"id",align:"left"},{name:"name",label:"Nome",field:"name",align:"left"},{name:"email",label:"E-mail",field:"email",align:"left"},{name:"queues",label:"Filas",field:"queues",align:"left",format:a=>a?a.map((a=>a.queue)).join(", "):"",classes:"ellipsis",style:"max-width: 400px;"},{name:"profile",label:"Perfil",field:"profile",align:"left",format:a=>this.optionsProfile.find((i=>i.value==a)).label},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{LOAD_USUARIOS(a){const i=[];a.forEach((a=>{const o=this.usuarios.findIndex((i=>i.id===a.id));-1!==o?this.usuarios[o]=a:i.push(a)})),this.usuarios=[...this.usuarios,...i]},UPDATE_USUARIO(a){let i=[...this.usuarios];const o=i.findIndex((i=>i.id===a.id));-1!==o?i[o]=a:i=[a,...i],this.usuarios=[...i]},DELETE_USUARIO(a){const i=[...this.usuarios.filter((i=>i.id!==a))];this.usuarios=[...i]},async listarUsuarios(){this.loading=!0;try{const a=await Object(t["e"])(this.params);a.data&&Array.isArray(a.data.users)?(this.usuarios=[...this.usuarios,...a.data.users],this.pagination.rowsNumber=a.data.count||0,this.pagination.hasMore=a.data.hasMore):console.error("Resposta da API não está no formato esperado:",a.data)}catch(a){console.error("Erro ao listar usuários:",a)}finally{this.loading=!1}},filtrarUsuario(a){this.usuarios=[],this.params.pageNumber=1,this.params.searchParam=a,this.listarUsuarios()},onScroll({to:a,ref:i,...o}){!this.loading&&this.params.hasMore&&a>=this.usuarios.length-10&&(this.loading=!0,this.params.pageNumber++,this.listarUsuarios())},usuarioCriado(a){const i=[...this.usuarios];i.push(a),this.usuarios=[...i]},editarUsuario(a){this.usuarioSelecionado=a,this.modalUsuario=!0},deletarUsuario(a){this.$q.dialog({title:`Atenção!! Deseja realmente deletar o usuario "${a.name}"?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(t["d"])(a.id).then((i=>{this.DELETE_USUARIO(a.id),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Usuario ${a.name} deletado!`,actions:[{icon:"close",round:!0,color:"white"}]})})).catch((a=>{console.error(a),this.$notificarErro("Não é possível deletar o usuário",a)})),this.loading=!1}))},async listarFilas(){const{data:a}=await Object(r["d"])();this.filas=a},gerirFilasUsuario(a){this.usuarioSelecionado=a,this.modalFilaUsuario=!0}},async mounted(){await this.listarFilas(),await this.listarUsuarios(),this.userProfile=localStorage.getItem("profile")}},A=k,F=(o("c942"),o("eaac")),_=o("0016"),C=o("27f9"),$=o("db86"),E=o("05c0"),I=Object(m["a"])(A,s,e,!1,null,null,null);i["default"]=I.exports;w()(I,"components",{QTable:F["a"],QIcon:_["a"],QInput:C["a"],QBtn:v["a"],QTd:$["a"],QTooltip:E["a"]})},c942:function(a,i,o){"use strict";o("0648")}}]);