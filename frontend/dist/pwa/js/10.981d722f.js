(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{"0248":function(t,a,e){},"0d0c":function(t,a,e){"use strict";e("25a5")},"25a5":function(t,a,e){},"2af7":function(t,a,e){},"631e":function(t,a,e){"use strict";e("2af7")},"6fd3":function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t._self._c;return a("div",{staticClass:"q-py-xs q-px-sm"},[a("board")],1)},o=[],s=function(){var t=this,a=t._self._c;return a("div",[a("wait-dialog",{attrs:{"d-wait":t.dialogWait}}),a("q-card",{staticClass:"no-shadow"},[a("q-card-section",{staticClass:"text-h6 text-bold q-py-xs q-mb-sm"},[t._v("\n      Kanban\n    ")])],1),a("q-card",{staticClass:"no-shadow"},[a("q-card-section",{staticClass:"q-px-sm q-py-none"},[a("draggable",{staticClass:"row justify-between q-mt-none cards",attrs:{group:"upper"},on:{change:function(a){return t.log(a)}},model:{value:t.lists,callback:function(a){t.lists=a},expression:"lists"}},t._l(t.lists,(function(e){return a("List",{key:e.id,staticClass:"col-xs-12 col-sm-6 col-md-4 col-lg-3 q-mt-none q-mb-xs q-gutter-sm",attrs:{data:e},on:{"delete-list":t.deleteList,"update-list":t.updateList,"update-card":t.updateCard,"save-ordenacao":t.salvarOrdem}})})),1),a("q-card",{staticClass:"no-shadow col-auto"},[a("q-card-section",[t.showNew?a("q-form",{on:{reset:t.cancelNewList,submit:t.newList}},[a("div",{staticClass:"row items-center no-wrap"},[a("div",{staticClass:"col q-mr-sm"},[a("q-card",{staticClass:"bg-white btn-rounded q-pa-sm",staticStyle:{width:"100%"},attrs:{bordered:"",flat:""}},[a("q-card-section",{staticClass:"text-bold q-px-none",class:{"text-white":t.$q.dark.isActive}},[t._v("\n                    Nova lista\n                    "),a("q-separator")],1),a("q-card-section",{staticClass:"q-pa-none"},[a("q-input",{class:{"text-white":t.$q.dark.isActive},attrs:{autofocus:"",dense:"",outlined:""},model:{value:t.newListTitle,callback:function(a){t.newListTitle=a},expression:"newListTitle"}}),a("q-input",{staticClass:"q-my-md",class:{"text-white":t.$q.dark.isActive},style:`background: ${t.titleColor} `,attrs:{filled:"",dense:"","hide-bottom-space":"",rules:["anyColor"],dark:!1},scopedSlots:t._u([{key:"preappend",fn:function(){},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"colorize",color:t.$q.dark.isActive?"white":"black"}},[a("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-color",{attrs:{"format-model":"hex",square:"","default-view":"palette","no-header":"",bordered:""},model:{value:t.titleColor,callback:function(a){t.titleColor=a},expression:"titleColor"}})],1)],1)]},proxy:!0}]),model:{value:t.titleColor,callback:function(a){t.titleColor=a},expression:"titleColor"}})],1)],1)],1),a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"close",type:"reset"}}),a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"done",type:"submit"}})],1)])]):a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"add"},on:{click:function(a){return t.showDialog()}}})],1)],1)],1)],1)],1)},n=[],r=(e("14d9"),function(){var t=this,a=t._self._c;return a("q-dialog",{attrs:{value:t.dWait,persistent:""}},[a("q-card",{class:"q-pa-xs "+(t.tDark?"bg-grey-8":"bg-grey-4"),staticStyle:{width:"300px"}},[a("q-card-section",{staticClass:"q-pt-none q-px-none"},[a("div",{staticClass:"text-bold text-center"},[t._v("Aguarde por favor....")]),a("div",{staticClass:"q-mb-md text-caption text-center"},[t._v("\n        Isso pode demorar um pouco.\n      ")]),a("div",{staticClass:"q-pa-xs"},[a("q-linear-progress",{attrs:{indeterminate:""}})],1)])],1)],1)}),c=[],l=e("ff52"),d={name:"WaitDialog",props:{dWait:{type:Boolean}},computed:{tDark(){return l["a"].isActive}}},u=d,m=e("2877"),p=e("24e8"),h=e("f09f"),b=e("a370"),f=e("6b1d"),v=e("eebe"),q=e.n(v),g=Object(m["a"])(u,r,c,!1,null,null,null),y=g.exports;q()(g,"components",{QDialog:p["a"],QCard:h["a"],QCardSection:b["a"],QLinearProgress:f["a"]});var C=e("8982");function k(t){return Object(C["a"])({url:"/kanban/",method:"post",data:t})}function w(){return Object(C["a"])({url:"/kanban/",method:"get"})}function x(t){return Object(C["a"])({url:`/kanban/${t.id}`,method:"put",data:t})}function $(t){return Object(C["a"])({url:`/kanban/${t.id}`,method:"delete"})}function T(t){return Object(C["a"])({url:"/kanban/list/",method:"post",data:t})}var _=e("ee0e"),S=e("9a1b"),O=e("2ef0"),Q=e.n(O),I=e("b76a"),P=e.n(I),A=function(){var t=this,a=t._self._c;return a("q-card",{staticClass:"no-shadow scroll q-my-none q-mt-none scrollBar",staticStyle:{"max-height":"58vh"},style:t.data.color?`border:2px solid ${t.data.color}; border-top:8px solid ${t.data.color};`:"border:2px solid grey; border-top:8px solid grey;"},[a("q-card-section",{staticClass:"q-py-sm q-ma-sm"},[a("div",{staticClass:"row items-center no-wrap"},[a("div",{staticClass:"col"},[t.editTitle?a("q-form",[a("div",{staticClass:"row items-center no-wrap"},[a("div",{staticClass:"col q-mr-sm"},[a("q-card",{staticClass:"bg-white btn-rounded q-pa-sm",staticStyle:{width:"100%"},attrs:{bordered:"",flat:""}},[a("q-card-section",{staticClass:"text-bold q-px-none"},[t._v("\n                  Editar\n                  "),a("q-separator")],1),a("q-card-section",{staticClass:"q-pa-none"},[a("q-input",{attrs:{autofocus:"",dense:"",outlined:""},model:{value:t.newListTitle,callback:function(a){t.newListTitle=a},expression:"newListTitle"}}),a("q-input",{staticClass:"q-my-md",style:`background: ${t.titleColor} `,attrs:{filled:"",dense:"","hide-bottom-space":"",dark:!1},scopedSlots:t._u([{key:"preappend",fn:function(){},proxy:!0},{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"colorize"}},[a("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-color",{attrs:{"format-model":"hex",square:"","default-view":"palette","no-header":"",bordered:""},model:{value:t.titleColor,callback:function(a){t.titleColor=a},expression:"titleColor"}})],1)],1)]},proxy:!0}]),model:{value:t.titleColor,callback:function(a){t.titleColor=a},expression:"titleColor"}})],1)],1)],1),a("div",{staticClass:"col-auto"},[a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"close"},on:{click:t.cancelNewTitle}}),a("q-btn",{attrs:{color:"primary",dense:"",flat:"",icon:"done"},on:{click:t.saveTitle}})],1)])]):a("div",{staticClass:"text-subtitle1 text-weight-medium q-px-sm",class:{"text-grey-10":!t.$q.dark.isActive,"text-white":t.$q.dark.isActive},style:"border-left: 5px; border-radius: 10px; cursor: pointer;",on:{click:function(a){t.editTitle=!0}}},[t._v("\n          "+t._s(t.data.name)+"\n          "),a("q-badge",{attrs:{color:"positive",floating:""}},[t._v(t._s(t.data.cards.length))]),a("q-badge",{attrs:{color:"cyan"}},[t._v(t._s(`$ ${t.sumPrices(t.data.cards)}`))])],1)],1),t.editTitle||0===t.data.id?t._e():a("div",{},[a("q-btn",{attrs:{color:t.$q.dark.isActive?"white":"black",dense:"",flat:"",icon:"more_horiz"}},[a("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v("Opções")]),a("q-menu",{attrs:{"auto-close":"",fit:""}},[a("q-list",[a("q-item",{attrs:{clickable:""}},[a("q-item-section",{attrs:{disabled:0==t.data.id},on:{click:function(a){return t.deleteList(t.data)}}},[t._v("Remove lista")])],1)],1)],1)],1)],1)])]),a("q-card-section",{staticClass:"q-pt-none q-px-none"},[a("draggable",{attrs:{list:t.data.cards,group:"cards",animation:200,"ghost-class":"ghost-card"},on:{change:function(a){return t.logInner(a,t.data.name)}}},t._l(t.data.cards,(function(e,i){return a("ItemKanban",{key:`key-${i}`,staticClass:"anyhover",attrs:{contato:e,filas:t.filas,"title-color":t.data.color},on:{"update-contato":t.updateContato}})})),1)],1)],1)},L=[],j=function(){var t=this,a=t._self._c;return a("div",[a("q-list",{staticClass:"q-mr-sm q-ml-none q-my-sm q-pa-xs",class:t.$q.dark.isActive?"bg-grey-5":"bg-grey-6",staticStyle:{"border-radius":"5px"},attrs:{separator:""}},[a("q-item",{staticClass:"ticketBorder q-px-none",staticStyle:{height:"auto","max-width":"100%",cursor:"move"},style:`\n  background: ${t.$q.dark.isActive?"#000000":"#ebebeb"};\n  ${t.titleColor?`border-left: 3px solid ${t.titleColor} !important;`:""}\n`,attrs:{id:"item-ticket-houve"}},[a("q-item-section",{staticClass:"q-px-xs",attrs:{avatar:""}},[a("q-avatar",{staticClass:"relative-position",attrs:{size:"45px"}},[a("img",{directives:[{name:"show",rawName:"v-show",value:!!t.Value(t.contato,"profilePicUrl"),expression:"!!Value(contato, 'profilePicUrl')"}],attrs:{src:t.Value(t.contato,"profilePicUrl"),onerror:"this.style.display='none'"}}),a("q-icon",{attrs:{size:"45px",name:"mdi-account-circle",color:"grey-8"}})],1)],1),a("q-item-section",{attrs:{id:"ListItemsTicket"}},[a("q-item-label",{staticClass:"text-bold h5",attrs:{lines:"1"}},[a("span",{class:t.$q.dark.isActive?"text-white":""},[t._v(t._s(t.contato.name))])]),a("q-item-label",{staticClass:"text-bold h6",attrs:{lines:"1"}},[a("a",{class:t.$q.dark.isActive?"text-white":"",attrs:{href:t.getPhoneNumberLink(t.contato.number)}},[t._v("\n            "+t._s(t.formatId(t.contato.number))+"\n          ")])]),t.contato.deadline?a("q-item-label",[a("div",{staticClass:"row text-caption q-pt-xs"},[a("q-icon",{staticClass:"q-mr-xs",attrs:{size:"sm",color:"red-5",name:"timer"}}),a("span",[t._v(t._s(t.formatarDataTZ(t.contato.deadline)))])],1)]):t._e(),t.contato.commentary?a("q-item-label",[a("div",{staticClass:"row text-caption q-pt-xs q-pl-none"},[a("div",{staticClass:"col-xs-1"},[a("q-icon",{attrs:{color:"primary",size:"sm",name:"mdi-text"}})],1),a("div",{staticClass:"col-sm-9 q-ml-sm ellipsis"},[t._v("\n              "+t._s(t.contato.commentary)+"\n            ")])])]):t._e()],1),a("q-item-section",{attrs:{side:""}},[a("q-icon",{staticStyle:{cursor:"pointer"},attrs:{name:"edit",color:"blue-10"},on:{click:function(a){return t.openCard(t.contato)}}},[a("q-tooltip",[t._v("Editar")])],1),t.contato.number?a("q-icon",{staticClass:"text-bold q-mt-sm",staticStyle:{cursor:"pointer"},attrs:{name:"mdi-whatsapp",color:"green-10"},on:{click:function(a){return t.handleSaveTicket(t.contato,"whatsapp")}}},[a("q-tooltip",[t._v("Atendimento")])],1):t._e(),t.contato.instagramPK?a("q-icon",{staticClass:"text-bold q-mt-sm",staticStyle:{cursor:"pointer"},attrs:{name:"mdi-instagram",color:"purple"},on:{click:function(a){return t.handleSaveTicket(t.contato,"hub_facebook")}}},[a("q-tooltip",[t._v("Atendimento")])],1):t._e(),t.contato.webchatId?a("q-icon",{staticClass:"text-bold q-mt-sm",staticStyle:{cursor:"pointer"},attrs:{name:"mdi-web",color:"cyan"},on:{click:function(a){return t.handleSaveTicket(t.contato,"hub_webchat")}}},[a("q-tooltip",[t._v("Atendimento")])],1):t._e(),t.contato.messengerId?a("q-icon",{staticClass:"text-bold q-mt-sm",staticStyle:{cursor:"pointer"},attrs:{name:"mdi-facebook-messenger",color:"blue"},on:{click:function(a){return t.handleSaveTicket(t.contato,"hub_facebook")}}},[a("q-tooltip",[t._v("Atendimento")])],1):t._e(),a("q-badge",{attrs:{color:"cyan"}},[t._v(t._s(`$ ${t.formatKanbanPrice(t.contato.kanbanPrice)}`))])],1)],1)],1),a("q-dialog",{model:{value:t.modelCard,callback:function(a){t.modelCard=a},expression:"modelCard"}},[a("CardModal",{attrs:{"data-card":t.openCardData},on:{hide:t.updateContato}})],1),a("q-dialog",{attrs:{persistent:""},on:{hide:function(a){t.modalTransferirTicket=!1}},model:{value:t.modalTransferirTicket,callback:function(a){t.modalTransferirTicket=a},expression:"modalTransferirTicket"}},[a("q-card",{staticClass:"q-pa-md",staticStyle:{width:"500px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Selecione o destino:")])]),a("q-card-section",[a("q-select",{attrs:{square:"",outlined:"",options:t.filas,"emit-value":"","map-options":"","option-value":"id","option-label":"queue",label:"Fila de destino"},model:{value:t.filaSelecionada,callback:function(a){t.filaSelecionada=a},expression:"filaSelecionada"}})],1),a("q-card-section",[a("q-select",{attrs:{square:"",outlined:"",options:t.usuariosTransferencia.filter(t.filterUsers),"emit-value":"","map-options":"","option-value":"id","option-label":"name",label:"Usuário destino"},model:{value:t.usuarioSelecionado,callback:function(a){t.usuarioSelecionado=a},expression:"usuarioSelecionado"}})],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mr-lg",attrs:{flat:"",label:"Sair",color:"negative"}}),a("q-btn",{attrs:{flat:"",label:"Salvar",color:"primary"},on:{click:t.confirmarTransferenciaTicket}})],1)],1)],1)],1)},D=[],N=e("b166"),E=e("e3ee"),W=e("3d09"),K=e("1556"),F=e("e018"),M=e("5a7a"),B=function(){var t=this,a=t._self._c;return a("q-card",{staticStyle:{"min-width":"400px"}},[a("wait-dialog",{attrs:{"d-wait":t.dialogWait}}),a("q-card-section",{staticClass:"bg-secondary q-py-xs"},[a("div",{staticClass:"text-h6"},[t._v("Comentários")])]),a("q-card-section",[a("q-datetime-picker",{attrs:{dense:"",rounded:"","hide-bottom-space":"",outlined:"","stack-label":"","bottom-slots":"",hint:"Data",mode:"date",color:"primary",format24h:""},model:{value:t.deadline,callback:function(a){t.deadline=a},expression:"deadline"}})],1),a("q-card-section",[a("div",[t._v("Comentário")]),a("q-form",[a("q-input",{attrs:{autofocus:"",dense:"",outlined:"",type:"textarea"},model:{value:t.commentary,callback:function(a){t.commentary=a},expression:"commentary"}})],1)],1),a("q-card-actions",{staticClass:"q-mt-xs column items-end q-mr-sm",attrs:{align:"right"}},[a("div",[t._v("Valor em pauta($)")]),a("q-form",[a("q-input",{attrs:{dense:"","input-class":"text-right"},on:{blur:t.formatKanbanPrice},model:{value:t.kanbanPrice,callback:function(a){t.kanbanPrice=a},expression:"kanbanPrice"}})],1)],1),a("q-card-actions",{staticClass:"q-mt-xs",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mr-md",attrs:{flat:"",label:"Cancelar",color:"negative"}}),a("q-btn",{attrs:{flat:"",label:"Salvar",color:"primary"},on:{click:function(a){return t.editarContato()}}})],1)],1)},U=[],z=e("73ad"),V={name:"openCard",props:{dataCard:{type:Object,default:()=>{}}},components:{WaitDialog:y},data:t=>({dialogWait:!1,deadline:t.dataCard.deadline,commentary:t.dataCard.commentary,kanbanPrice:t.dataCard.kanbanPrice}),computed:{teste(){return this.dataCard.commentary}},methods:{formatKanbanPrice(){if(this.kanbanPrice){const t=this.kanbanPrice.toString().replace(",",".");this.kanbanPrice=parseFloat(t).toFixed(2)}},async editarContato(){this.dialogWait=!0;try{const{data:t}=await Object(z["i"])(this.dataCard.contactId),a=this.deadline,e={...t,deadline:a,commentary:this.commentary,kanbanPrice:this.kanbanPrice?Number(this.kanbanPrice):0};await Object(z["d"])(e.id,e),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Contato editado!",actions:[{icon:"close",round:!0,color:"white"}]}),this.$emit("hide",e)}catch(t){console.log(t),this.$notificarErro("Ocorreu um erro ao salvar dados",t)}finally{this.dialogWait=!1}}}},R=V,H=e("52ee"),J=e("0378"),Z=e("27f9"),G=e("4b7e"),X=e("9c40"),Y=e("7f67"),tt=Object(m["a"])(R,B,U,!1,null,"838ede62",null),at=tt.exports;q()(tt,"components",{QCard:h["a"],QCardSection:b["a"],QDate:H["a"],QForm:J["a"],QInput:Z["a"],QCardActions:G["a"],QBtn:X["a"]}),q()(tt,"directives",{ClosePopup:Y["a"]});var et=e("c5bd"),it=e("0582"),ot=e("2f62");const st=+localStorage.getItem("userId");var nt={name:"ItemKanban",components:{CardModal:at},data:()=>({openCardData:{contactId:null,deadline:null,commentary:null,kanbanPrice:null},modelCard:!1,modalTransferirTicket:!1,usuarioSelecionado:null,filaSelecionada:null,filas:[],usuariosTransferencia:[],usuarios:[],dialogWait:!1,outlinedAccountCircle:M["a"],recalcularHora:1,statusAbreviado:{open:"A",pending:"P",closed:"R"},status:{open:"Aberto",pending:"Pendente",closed:"Resolvido"},color:{open:"primary",pending:"negative",closed:"positive"},borderColor:{open:"primary",pending:"negative",closed:"positive"},ticketStatusText:{open:"Ticket aberto",pending:"Ticket pendente",closed:"Ticket encerrado"}}),props:{statusTicket:{type:String,default:()=>null},titleColor:{type:String,default:()=>""},contato:{type:Object,default:()=>{}},buscaTicket:{type:Boolean,default:!1},filas:{type:Array,default:()=>[]}},methods:{async listarFilas(){return new Promise(((t,a)=>{Object(_["d"])().then((({data:t})=>(this.filas=t.filter((t=>t.isActive)),this.modalTransferirTicket=!0,this.listarUsuariosTransferencia()))).then((()=>{this.$once("modalClosed",(()=>{t()}))})).catch((t=>{console.error(t),this.$notificarErro("Problema ao carregar filas",t),a(t)}))}))},async listarUsuariosTransferencia(){try{const{data:t}=await Object(S["e"])();this.usuariosTransferencia=t.users,this.modalTransferirTicket=!0}catch(t){console.error(t),this.$notificarErro("Problema ao carregar usuários",t)}},async listarUsuarios(){try{const{data:t}=await Object(S["e"])();this.usuarios=t.users}catch(t){console.error(t),this.$notificarErro("Problema ao carregar usuários",t)}},filterUsers(t,a,e){const i=this.filaSelecionada;if(null==i)return!0;const o=t.queues.filter((function(t,a,e){return t.id==i}));return o.length>0},getPhoneNumberLink(t){return t.startsWith("55")&&t.charAt(4)>5?`tel:${t.slice(0,4)}9${t.slice(-8)}`:`tel:${t}`},formatKanbanPrice(t){return isNaN(t)?"0.00":Number(t).toFixed(2)},formatId(t){const a=Object(it["a"])(t);return a},formatarDataTZ(t){return Object(N["a"])(Object(E["a"])(t),"dd-MM-yyyy")},updateContato(t){this.modelCard=!1,this.$emit("update-contato",{contato:t})},openCard(t){const a=t.deadline,e={contactId:t.id,deadline:a?Object(N["a"])(Object(E["a"])(a),"yyyy-MM-dd"):Object(N["a"])(new Date,"yyyy-MM-dd"),commentary:t.commentary,kanbanPrice:t.kanbanPrice};this.openCardData=e,this.modelCard=!0},getContactName(t){return null===t||void 0===t?void 0:t.name},Value(t,a){try{return t[a]}catch(e){return""}},dataInWords(t,a){if(!a)return"";let e=Object(W["a"])(a);return t&&(e=new Date(Number(t))),Object(K["a"])(e,new Date,{locale:F["a"]})},async handleSaveTicket(t,a){if(!t.id)return;const e=[],i=null;this.whatsapps.forEach((t=>{t.type===a&&e.push({label:t.name,value:t.id})})),this.$q.dialog({title:`Contato: ${t.name}`,message:"Selecione o canal para iniciar o atendimento.",options:{type:"radio",model:i,isValid:t=>!!t,items:e},ok:{push:!0,color:"positive",label:"Iniciar"},cancel:{push:!0,label:"Cancelar",color:"negative"},persistent:!0}).onOk((async e=>{if(e){this.loading=!0;try{const{data:i}=await Object(et["h"])({contactId:t.id,isActiveDemand:!0,userId:st,channel:a,channelId:e,status:"open"});this.ticketFocado=i,await this.listarFilas(),await this.$store.commit("SET_HAS_MORE",!0),await this.$store.dispatch("AbrirChatMensagens",i),this.$q.notify({message:`Atendimento Iniciado || ${i.contact.name} - Ticket: ${i.id}`,type:"positive",position:"top",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.$router.push({name:"chat",params:{ticketId:i.id}})}catch(s){var i;this.loading=!1,console.log("error",s);const a=(null===s||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||"Ocorreu um erro desconhecido!";if(409===s.status&&"Já existe um ticket"===a){var o;console.log("Erro 409:",s);const a=null===(o=s.data)||void 0===o?void 0:o.ticket;this.abrirAtendimentoExistente(t,a)}else 409===s.status&&(console.log(s),this.$q.dialog({title:"Atenção!!",message:`${a}`,ok:{label:"Fechar",color:"primary",push:!0},persistent:!0}),this.$q.notify({message:a,type:"negative",position:"top",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}))}}}))},abrirChatContato(t){this.$q.screen.lt.md&&"pending"!==t.status&&this.$root.$emit("infor-cabecalo-chat:acao-menu"),"pending"===t.status||t.id===this.$store.getters.ticketFocado.id&&"chat"===this.$route.name||(this.$store.commit("SET_HAS_MORE",!0),this.$store.dispatch("AbrirChatMensagens",t))},abrirAtendimentoExistente(t,a){this.$q.dialog({title:"Atenção!!",message:`${t.name} possui um atendimento em curso (Atendimento: ${a.id}). Deseja abrir o atendimento?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((async()=>{try{this.abrirChatContato(a)}catch(t){this.$notificarErro("Não foi possível atualizar o token",t)}}))},async confirmarTransferenciaTicket(){await Object(et["c"])(this.ticketFocado.id,{userId:this.usuarioSelecionado||st,queueId:this.filaSelecionada||null,status:"open",isTransference:1}),this.$q.notify({type:"positive",message:"Ticket transferido.",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.modalTransferirTicket=!1,this.$emit("modalClosed"),this.$store.commit("TICKET_FOCADO",{})}},mounted(){this.listarUsuarios()},computed:{...Object(ot["b"])(["whatsapps"]),cWhatsapps(){return this.whatsapps.filter((t=>"whatsapp"==t.type&&"CONNECTED"==t.status&&!t.isDeleted&&t.tenantId==this.$store.getters.user.usuario.tenantId))},ctags(){var t,a;return null!==(t=this.ticket)&&void 0!==t&&null!==(a=t.contact)&&void 0!==a&&a.tags?this.ticket.contact.tags.map((t=>t.tag)).join(", "):""},atags(){var t,a;return null!==(t=this.ticket)&&void 0!==t&&null!==(a=t.contact)&&void 0!==a&&a.tags?this.ticket.contact.tags.map((t=>t.tag)):""},colortags(){var t,a;return null!==(t=this.ticket)&&void 0!==t&&null!==(a=t.contact)&&void 0!==a&&a.tags?this.ticket.contact.tags.map((t=>t.color)):[]}},created(){setInterval((()=>{this.recalcularHora++}),5e4)}},rt=nt,ct=(e("0d0c"),e("1c1c")),lt=e("66e5"),dt=e("4074"),ut=e("cb32"),mt=e("0016"),pt=e("0170"),ht=e("05c0"),bt=e("58a81"),ft=e("eb85"),vt=e("ddd8"),qt=Object(m["a"])(rt,j,D,!1,null,null,null),gt=qt.exports;q()(qt,"components",{QList:ct["a"],QItem:lt["a"],QItemSection:dt["a"],QAvatar:ut["a"],QIcon:mt["a"],QItemLabel:pt["a"],QTooltip:ht["a"],QBadge:bt["a"],QSeparator:ft["a"],QDialog:p["a"],QCard:h["a"],QCardSection:b["a"],QSelect:vt["a"],QCardActions:G["a"],QBtn:X["a"]}),q()(qt,"directives",{ClosePopup:Y["a"]});var yt={name:"List",props:["data","filas"],components:{draggable:P.a,ItemKanban:gt},data:t=>({drag:!1,editTitle:!1,titleColor:t.data.color,newListTitle:t.data.name}),computed:{dragOptions(){return{animation:0,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{sumPrices(t){let a=0;return t.forEach((t=>{a+=Number((null===t||void 0===t?void 0:t.kanbanPrice)||0)})),a.toFixed(2)},updateContato(t){this.$emit("update-card",t)},logInner(t,a){console.log("inner",t,a),this.$emit("save-ordenacao")},saveTitle(){this.data.name=this.newListTitle,this.data.color=this.titleColor,this.$emit("update-list",this.data),this.editTitle=!1},cancelNewTitle(){var t,a;this.newListTitle=(null===(t=this.data)||void 0===t?void 0:t.name)||"",this.titleColor=(null===(a=this.data)||void 0===a?void 0:a.color)||"",this.editTitle=!1},deleteList(){this.$emit("delete-list",this.data)}},async mounted(){this.userProfile=localStorage.getItem("profile")}},Ct=yt,kt=(e("631e"),e("7cbe")),wt=e("b498"),xt=e("4e73"),$t=Object(m["a"])(Ct,A,L,!1,null,null,null),Tt=$t.exports;q()($t,"components",{QCard:h["a"],QCardSection:b["a"],QBadge:bt["a"],QForm:J["a"],QInput:Z["a"],QSeparator:ft["a"],QIcon:mt["a"],QPopupProxy:kt["a"],QColor:wt["a"],QBtn:X["a"],QTooltip:ht["a"],QMenu:xt["a"],QList:ct["a"],QItem:lt["a"],QItemSection:dt["a"]});const _t=+localStorage.getItem("userId");var St={name:"Board",components:{List:Tt,WaitDialog:y,draggable:P.a},data:t=>({dialogWait:!1,contatos:[],filas:[],showNew:!1,usuario:{},newListTitle:"",titleColor:null,lists:[{id:0,name:"Contatos",cards:[]}]}),async mounted(){this.userProfile=localStorage.getItem("profile");try{this.dialogWait=!0;const{data:t}=await Object(_["d"])();this.filas=t;const{data:a}=await Object(S["c"])(_t);this.usuario=a,await this.consultarContatos(),await this.listarKanbans(),this.ordenar()}finally{this.dialogWait=!1}},methods:{log(t){},showDialog(){this.newListTitle="",this.titleColor=null,this.showNew=!0},ordenar(){const t=this.usuario.kanbanOrder||[];let a=[];const e=new Set;for(let n=1;n<this.lists.length;n++){var i;const o=this.lists[n].id,s=(null===(i=t.find((t=>t.id==o)))||void 0===i?void 0:i.value)||[];a=[...a,...s],this.lists[n].cards=this.doOrdenacao(this.contatos,s);const r=this.lists[n].cards.map((t=>{if(t.id)return t.id}));for(const t of r)e.add(t)}const o=[...e],s=this.contatos.filter((t=>!a.includes(t.id)&&!o.includes(t.id)));this.lists[0].cards=Q.a.uniqBy(s,(t=>t.id)),this.lists=Q.a.cloneDeep(this.lists)},doOrdenacao(t,a){const e=Q.a.reduce(t,((t,a)=>(t[a.id]=a,t)),{}),i=a.reduce((function(t,a){const i=e[a];return i&&t.push(i),t}),[]);return i},async salvarOrdem(){const t=[];for(const c of this.lists){const a=c.cards.map((t=>t.id)),e=c.id,i={id:e,value:a};t.push(i)}const{email:a,id:e,name:i,tenantId:o,password:s}=this.usuario,n={email:a,id:e,name:i,tenantId:o,password:s,kanbanOrder:t};this.$store.state.user.isAdmin&&(n.profile=this.usuario.profile);try{await Object(S["h"])(n.id,n),this.usuario.kanbanOrder=n.kanbanOrder||[]}catch(r){this.$notificarErro(r),console.log(r)}},async getKanbans(){const{data:t}=await w();return t},async listarKanbans(){const t=await this.getKanbans();this.lists=[...this.lists,...t];const a=this.lists.map((t=>(t.filas=this.filas,0!==t.id?t.cards=[]:t.cards=this.contatos,t)));this.lists=Q.a.cloneDeep(a)},async consultarContatos(){const t=this.usuario.kanbanOrder||[],a=new Set,e=t.map((t=>t.value));for(let o=0;o<e.length;o++)e[o].length>0&&a.add(...e[o]);try{const{data:t}=await T({});this.contatos=t}catch(i){console.error(i),this.$notificarErro("Erro ao consultar atendimentos",i)}},async newList(){try{const{data:t}=await k({name:this.newListTitle,color:this.titleColor});this.lists.push({id:t.id,name:this.newListTitle,cards:[],filas:this.filas,color:this.titleColor}),this.showNew=!1,this.newListTitle="",this.$emit("modal-kanban:criada",t),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Lista Kanban criada!",actions:[{icon:"close",round:!0,color:"white"}]})}catch(t){console.error(t),this.$notificarErro("Ocorreu um erro!",t)}},cancelNewList(){this.newListTitle="",this.titleColor=null,this.showNew=!1},updateCard(t){const{contato:a}=t;for(const e of this.lists){const t=e.cards.findIndex((t=>t.id===a.id));if(t>=0){const{deadline:i,commentary:o,kanbanPrice:s}=a;e.cards[t]={...e.cards[t],deadline:i,commentary:o,kanbanPrice:s,contact:a}}}this.lists=Q.a.cloneDeep(this.lists)},async updateList(t){this.salvarOrdem();try{const{data:a}=await x(t);this.$q.notify({type:"positive",progress:!0,position:"top",message:`Lista ${a.name} atualizada!`,actions:[{icon:"close",round:!0,color:"white"}]})}catch(a){console.error(a),this.$notificarErro("Ocorreu um erro!",a)}},async deleteList(t){this.lists[0].cards=[...this.lists[0].cards,...t.cards],this.salvarOrdem(),await $({id:t.id});let a=[...this.lists];a=a.filter((a=>a.id!==t.id)),this.lists=[...a],this.$q.notify({type:"positive",progress:!0,position:"top",message:`Item ${t.name} deletado!`,actions:[{icon:"close",round:!0,color:"white"}]})}}},Ot=St,Qt=(e("f25d"),Object(m["a"])(Ot,s,n,!1,null,null,null)),It=Qt.exports;q()(Qt,"components",{QCard:h["a"],QCardSection:b["a"],QBtn:X["a"],QForm:J["a"],QSeparator:ft["a"],QInput:Z["a"],QIcon:mt["a"],QPopupProxy:kt["a"],QColor:wt["a"]});var Pt={name:"Kanban",components:{board:It}},At=Pt,Lt=e("9989"),jt=Object(m["a"])(At,i,o,!1,null,null,null);a["default"]=jt.exports;q()(jt,"components",{QPage:Lt["a"]})},f25d:function(t,a,e){"use strict";e("0248")}}]);