(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[32],{d84c:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return"admin"===e.userProfile?t("div",{staticClass:"mass-container container-rounded-10"},[t("div",{staticClass:"col q-pa-md items-center"},[t("h2",{class:{"text-green":e.$q.dark.isActive}},[t("q-icon",{attrs:{name:"mdi-view-dashboard-variant"}}),e._v("\n      Painel Atendimentos\n    ")],1),t("div",{staticClass:"q-mb-md row flex-gap-1"},[t("q-btn",{staticClass:"generate-button btn-rounded-50",class:{"generate-button-dark":e.$q.dark.isActive},attrs:{icon:"mdi-filter",label:"Filtros"},on:{click:function(t){e.visualizarFiltros=!0}}})],1)]),t("q-dialog",{attrs:{"full-height":"",position:"left"},model:{value:e.visualizarFiltros,callback:function(t){e.visualizarFiltros=t},expression:"visualizarFiltros"}},[t("q-card",{staticStyle:{width:"300px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("Filtros")])]),t("q-card-section",{staticClass:"q-gutter-md"},[t("DatePick",{staticClass:"row col",attrs:{dense:"",rounded:"",outlined:""},model:{value:e.pesquisaTickets.dateStart,callback:function(t){e.$set(e.pesquisaTickets,"dateStart",t)},expression:"pesquisaTickets.dateStart"}}),t("DatePick",{staticClass:"row col",attrs:{dense:"",rounded:"",outlined:""},model:{value:e.pesquisaTickets.dateEnd,callback:function(t){e.$set(e.pesquisaTickets,"dateEnd",t)},expression:"pesquisaTickets.dateEnd"}}),"admin"===e.profile?t("q-separator"):e._e(),"admin"===e.profile?t("q-toggle",{staticClass:"q-ml-lg",attrs:{label:"(Admin) - Visualizar Todos"},model:{value:e.pesquisaTickets.showAll,callback:function(t){e.$set(e.pesquisaTickets,"showAll",t)},expression:"pesquisaTickets.showAll"}}):e._e(),"admin"===e.profile?t("q-separator",{staticClass:"q-mb-md"}):e._e(),e.pesquisaTickets.showAll?e._e():t("q-select",{attrs:{square:"",dense:"",outlined:"","hide-bottom-space":"","emit-value":"","map-options":"",multiple:"","options-dense":"","use-chips":"",label:"Filas",color:"primary",options:e.filas,"input-debounce":700,"option-value":"id","option-label":"queue","input-style":"width: 280px; max-width: 280px;"},model:{value:e.pesquisaTickets.queuesIds,callback:function(t){e.$set(e.pesquisaTickets,"queuesIds",t)},expression:"pesquisaTickets.queuesIds"}})],1),t("q-card-section",[t("q-separator"),t("div",{staticClass:"text-h6 q-mt-md"},[e._v("Tipo de visualização")]),t("q-option-group",{attrs:{options:e.optionsVisao,label:"Visão",type:"radio"},model:{value:e.visao,callback:function(t){e.visao=t},expression:"visao"}})],1),t("q-card-actions",{attrs:{align:"center"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{outline:"",label:"Atualizar",color:"primary"},on:{click:e.consultarTickets}})],1)],1)],1),t("div",{staticClass:"scroll"},[e._l(e.sets,(function(s,i){return[t("div",{key:i,staticClass:"row q-pa-md q-col-gutter-md q-mb-sm"},[e._l(s,(function(s,i){return t("div",{key:i,class:e.contentClass},[t("q-card",{staticClass:"container-border container-rounded-50",attrs:{flat:""}},["U"===e.visao||"US"===e.visao?t("q-item",{staticClass:"font-family-main text-bold",class:{"bg-negative text-white":"Pendente"===e.definirNomeUsuario(s[0])}},[t("q-item-section",[t("q-item-label",{staticClass:"font-family-main text-bold text-h6"},[e._v(e._s(e.definirNomeUsuario(s[0])))]),t("q-item-label",{staticClass:"font-family-main",class:{"text-white":"Pendente"===e.definirNomeUsuario(s[0])},attrs:{caption:""}},[e._v("\n                  Atendimentos: "+e._s(s.length)+"\n                ")])],1)],1):e._e(),"F"===e.visao||"FS"===e.visao?t("q-item",{staticClass:"font-family-main text-bold",class:{"bg-negative text-white":"Sem Fila"===e.definirNomeFila(s[0])}},[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",[t("img",{attrs:{src:"https://cdn.quasar.dev/img/boy-avatar.png"}})])],1),t("q-item-section",[t("q-item-label",[e._v(e._s(e.definirNomeFila(s[0])))]),t("q-item-label",{class:{"text-white":"Sem Fila"===e.definirNomeFila(s[0])},attrs:{caption:""}},[e._v("\n                  Abertos: "+e._s(e.counterStatus(s).open)+" | Pendentes: "+e._s(e.counterStatus(s).pending)+" | Total: "+e._s(s.length)+"\n                ")])],1),"sem fila"===e.definirNomeFila(s[0]).toLowerCase()?t("q-btn",{staticClass:"bg-padrao btn-rounded",attrs:{flat:"",color:"primary"},on:{click:e.listarFilas}},[t("q-icon",{attrs:{name:"mdi-transfer"}}),t("q-tooltip",{attrs:{"content-class":"bg-primary text-bold"}},[e._v("\n                  Transferir Atendimentos Sem Fila\n                ")])],1):e._e()],1):e._e(),t("q-separator"),"U"===e.visao||"F"===e.visao?t("q-card-section",{staticClass:"bg-grey-3 scroll",style:{height:"320px"}},e._l(s,(function(s,i){return t("ItemTicket",{key:i,attrs:{ticket:s,filas:e.filas}})})),1):e._e()],1)],1)})),t("q-resize-observer",{on:{resize:e.onResize}})],2)]}))],2)],1):e._e()},a=[],o=(s("14d9"),s("29b2")),r=s("0ffe"),n=s("ab52"),l=s("ee0e"),c=s("9a1b"),d=s("c5bd"),u=s("5c26"),h=s("2ef0"),m=s("b166"),f=s("ef06");const p=JSON.parse(localStorage.getItem("usuario")),k=Object(o["a"])(),v=localStorage.getItem("queues"),b=localStorage.getItem("profile");var g={name:"painel-de-controle",components:{ItemTicket:r["a"]},data(){return{userProfile:"admin",profile:b,visualizarFiltros:!1,slide:0,height:400,optionsVisao:[{label:"Por Usuário",value:"U"},{label:"Por Usuário (Sintético)",value:"US"},{label:"Por Filas",value:"F"},{label:"Por Filas (Sintético)",value:"FS"}],visao:"U",pesquisaTickets:{showAll:!0,dateStart:Object(m["a"])(Object(f["a"])(new Date,{days:30}),"yyyy-MM-dd"),dateEnd:Object(m["a"])(new Date,"yyyy-MM-dd"),queuesIds:[]},tickets:[],listaWhats:[],filas:[],usuarios:[],modalTransferirTicket:!1,usuarioSelecionado:null,filaSelecionada:null,usuarios2:[],usuarios3:[],modalTransferirTicket2:!1,usuarioSelecionado2:null,usuarioSelecionado3:null,sizes:{lg:3,md:3,sm:2,xs:1}}},computed:{contentClass(){let e="col";const t=Object.keys(this.cTicketsUser[0]).length;for(const s of["xl","lg","md","sm","xs"])if(this.sizes[s]){const i=this.sizes[s]>t?t:this.sizes[s];e+=" col-"+s+"-"+12/i}return e},sets(){const e=[],t=Math.ceil(this.cTicketsUser.length/this.itemsPerSet);for(let s=0;s<t;s++){const t=s*this.itemsPerSet,i=t+this.itemsPerSet;e.push(this.cTicketsUser.slice(t,i))}return e[0]},itemsPerSet(){let e=!1;for(const t of["xl","lg","md","sm","xs"])if(e=e||this.$q.screen[t],e&&this.sizes[t])return this.sizes[t];return 1},cUserQueues(){try{const e=JSON.parse(v).map((e=>{if(e.isActive)return e.id}));return this.filas.filter((t=>e.includes(t.id)))||[]}catch(e){return[]}},cTicketsUser(){const e="U"===this.visao||"US"===this.visao?"userId":"queueId";return[Object(h["groupBy"])(this.tickets,e)]}},methods:{async listaWhatsapp(){const{data:e}=await Object(u["d"])();this.listaWhats=e.filter((e=>e.isActive))},filterUsers(e,t,s){const i=this.filaSelecionada;if(null==i)return!0;const a=e.queues.filter((function(e,t,s){return e.id==i}));return a.length>0},async listarFilas(){try{const{data:e}=await Object(l["d"])();this.filas=e,this.modalTransferirTicket=!0,this.listarUsuarios()}catch(e){console.error(e),this.$notificarErro("Problema ao carregar filas",e)}},async listarUsuarios(){try{const{data:e}=await Object(c["e"])();this.usuarios=e.users,this.modalTransferirTicket=!0}catch(e){console.error(e),this.$notificarErro("Problema ao carregar usuários",e)}},async atualizarTicketPorFila(e,t,s,i){await Object(d["c"])(e,{userId:t,queueId:s,status:i,isTransference:1})},async confirmarTransferenciaTicket(){if(null!==this.usuarioSelecionado){try{for(const e of this.tickets)null===e.queueId&&await this.atualizarTicketPorFila(e.id,this.usuarioSelecionado,this.filaSelecionada,e.status)}catch(e){console.error(e),this.$notificarErro("Problema ao realizar transferência",e)}this.modalTransferirTicket=!1}else this.$notificarErro("Selecione o usuário e a fila destino para os atendimentos pendentes!")},async listarUsuarios2(){try{const{data:e}=await Object(c["e"])();this.usuarios2=e.users,this.usuarios3=e.users,this.modalTransferirTicket2=!0}catch(e){console.error(e),this.$notificarErro("Problema ao carregar usuários",e)}},async confirmarTransferenciaTicket2(){if(null!==this.usuarioSelecionado2&&null!==this.usuarioSelecionado3){try{for(const e of this.tickets)e.userId===this.usuarioSelecionado2&&await this.atualizarTicketPorFila(e.id,this.usuarioSelecionado3,e.queueId,e.status)}catch(e){console.error(e),this.$notificarErro("Problema ao realizar transferência",e)}this.modalTransferirTicket2=!1}else this.$notificarErro("Selecione o usuário destino!")},async atualizarTicketPendente(e,t,s){await Object(d["c"])(e,{userId:t,queueId:s,status:"closed",isTransference:1})},async resolverTodosPendentes(){try{const e=this.tickets.filter((e=>"pending"===e.status));for(let t=0;t<e.length;t+=10){const s=e.slice(t,t+10),i=s.map((e=>this.atualizarTicketPendente(e.id,e.userId,e.queueId).catch((t=>{console.log(e.id+" não atualizado: "+t)}))));this.$q.notify({color:"warning",position:"top",message:"Tickets sendo resolvido em blocos de 10 itens."}),await Promise.all(i)}this.$q.notify({color:"warning",position:"top",message:"Aguarde, página será recarregada após a conclusão da ação."}),setTimeout((()=>{window.location.reload()}),1e3)}catch(e){console.error(e),this.$notificarErro("Problema ao fechar atendimentos em massa",e)}this.modaFecharMassa=!1},async resolverTodosAbertos(){try{const e=this.tickets.filter((e=>"open"===e.status));for(let t=0;t<e.length;t+=10){const s=e.slice(t,t+10),i=s.map((e=>this.atualizarTicketPendente(e.id,e.userId,e.queueId).catch((t=>{console.log(e.id+" não atualizado: "+t)}))));this.$q.notify({color:"warning",position:"top",message:"Tickets sendo resolvido em blocos de 10 itens."}),await Promise.all(i)}this.$q.notify({color:"warning",position:"top",message:"Aguarde, página será recarregada após a conclusão da ação."}),setTimeout((()=>{window.location.reload()}),1e3)}catch(e){console.error(e),this.$notificarErro("Problema ao fechar atendimentos em massa",e)}this.modarApagarMassa=!1},deleteTicket(e){const t=[...this.tickets],s=t.filter((t=>t.id!==e));this.tickets=[...s]},updateTicket(e){const t=[...this.tickets],s=t.findIndex((t=>e.id));s&&(t[s]=e,this.tickets=[...t])},createTicket(e){const t=[...this.tickets];t.unshift(e),this.tickets=[...t]},verifyIsActionSocket(e){if(!e.id)return!1;if(this.pesquisaTickets.showAll)return!0;if(!this.filas.length)return!0;const t=this.pesquisaTickets.queuesIds.indexOf((t=>e.queueId===t));let s=!1;return-1!==t&&(s=!0),s},conectSocketQueues(e,t){},socketTickets(){k.on(`${p.tenantId}:ticketList`,(async e=>{"ticket:update"===e.type&&"waba"!==e.payload.channel&&(console.log("socket ON: DASH:UPDATE"),this.$q.notify({color:"positive",position:"bottom",message:`Novas interações para o atendimento ${e.payload.id} recebidas. Caso queira acessar as novas informações nesse painel, atualize essa página.`}))}))},connectSocket(){this.socketTickets(),this.cUserQueues.forEach((e=>{this.conectSocketQueues(p.tenantId,e.id)}))},definirNomeUsuario(e){var t;return this.verifyIsActionSocket(e),(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.name)||"Pendente"},definirNomeFila(e){const t=this.filas.find((t=>t.id===e.queueId));return(null===t||void 0===t?void 0:t.queue)||"Sem Fila"},counterStatus(e){var t,s,i;const a={open:0,pending:0,closed:0},o=Object(h["groupBy"])(e,"status");return a.open=(null===(t=o.open)||void 0===t?void 0:t.length)||0,a.pending=(null===(s=o.pending)||void 0===s?void 0:s.length)||0,a.closed=(null===(i=o.closed)||void 0===i?void 0:i.length)||0,a},consultarTickets(){Object(n["a"])(this.pesquisaTickets).then((e=>{this.tickets=e.data,this.connectSocket()})).catch((e=>{console.error(e),this.$notificarErro("Erro ao consultar atendimentos",e)}))},onResize({height:e}){this.height=e}},async mounted(){localStorage.getItem("reloaded")?localStorage.removeItem("reloaded"):(localStorage.setItem("reloaded","true"),window.location.reload()),await Object(l["d"])().then((e=>{this.filas=e.data})),await this.consultarTickets(),this.listaWhatsapp(),this.userProfile=localStorage.getItem("profile")},destroyed(){k.disconnect()}},q=g,T=s("2877"),y=s("0016"),S=s("9c40"),w=s("05c0"),I=s("24e8"),P=s("f09f"),x=s("a370"),z=s("eb85"),F=s("9564"),C=s("ddd8"),_=s("9f0a"),A=s("4b7e"),U=s("66e5"),$=s("4074"),O=s("cb32"),Q=s("0170"),E=s("3980"),j=s("7f67"),N=s("eebe"),D=s.n(N),M=Object(T["a"])(q,i,a,!1,null,"a02d9722",null);t["default"]=M.exports;D()(M,"components",{QIcon:y["a"],QBtn:S["a"],QTooltip:w["a"],QDialog:I["a"],QCard:P["a"],QCardSection:x["a"],QSeparator:z["a"],QToggle:F["a"],QSelect:C["a"],QOptionGroup:_["a"],QCardActions:A["a"],QItem:U["a"],QItemSection:$["a"],QAvatar:O["a"],QItemLabel:Q["a"],QResizeObserver:E["a"]}),D()(M,"directives",{ClosePopup:j["a"]})}}]);