(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{9575:function(a,t,e){"use strict";e.r(t);var i=function(){var a=this,t=a._self._c;return t("div",[t("q-table",{staticClass:"contact-table container-rounded-10 my-sticky-dynamic q-ma-lg",attrs:{flat:"",bordered:"",square:"","hide-bottom":"",title:"Tarefas",data:a.tarefas,columns:a.columns,loading:a.loading,"row-key":"id",pagination:a.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(t){a.pagination=t}},scopedSlots:a._u([{key:"top-left",fn:function(){return[t("div",[t("h2",{class:a.$q.dark.isActive?"text-white":""},[t("q-icon",{attrs:{name:"eva-list-outline"}}),a._v("\n          Tarefas\n        ")],1),t("div",{staticClass:"row flex-gap-col-1"},[t("q-input",{staticClass:"contact-search",class:{"order-last q-mt-md":a.$q.screen.width<500},staticStyle:{width:"300px"},attrs:{filled:"",dense:"",debounce:"500",clearable:"",placeholder:"Localize"},on:{input:a.filtrarTarefa},scopedSlots:a._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:a.filter,callback:function(t){a.filter=t},expression:"filter"}}),t("q-btn",{staticClass:"generate-button btn-rounded-50",class:a.$q.dark.isActive?"text-white":"",attrs:{icon:"eva-plus-outline",label:"Adicionar"},on:{click:function(t){a.tarefaEdicao={},a.modalTarefa=!0}}})],1)])]},proxy:!0},{key:"body-cell-color",fn:function(e){return[t("q-td",{staticClass:"text-center"},[t("div",{staticClass:"q-pa-sm rounded-borders",style:`background: ${e.row.color}`},[a._v("\n          "+a._s(e.row.color)+"\n        ")])])]}},{key:"body-cell-isActive",fn:function(a){return[t("q-td",{staticClass:"text-center"},[t("q-icon",{attrs:{size:"24px",name:a.value?"mdi-check-circle-outline":"mdi-close-circle-outline",color:a.value?"positive":"negative"}})],1)]}},{key:"body-cell-acoes",fn:function(e){return[t("q-td",{staticClass:"text-center"},[t("q-btn",{class:a.$q.dark.isActive?"text-white":"",attrs:{flat:"",round:"",icon:"mdi-check-circle-outline"},on:{click:function(t){return a.concluirTarefa(e.row)}}},[t("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[0,10]}},[a._v("\n            Clique para concluir a tarefa\n          ")])],1),t("q-btn",{class:a.$q.dark.isActive?"text-white":"",attrs:{flat:"",round:"",icon:"mdi-content-copy"},on:{click:function(t){return a.duplicarTarefa(e.row)}}},[t("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[0,10]}},[a._v("\n            Clique para duplicar a tarefa\n          ")])],1),"admin"===a.userProfile?t("q-btn",{class:a.$q.dark.isActive?"text-white":"",attrs:{flat:"",round:"",icon:"eva-edit-outline"},on:{click:function(t){return a.editarTarefa(e.row)}}},[t("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[0,10]}},[a._v("\n            Clique para editar a tarefa\n          ")])],1):a._e(),"admin"===a.userProfile?t("q-btn",{class:a.$q.dark.isActive?"text-white":"",attrs:{flat:"",round:"",icon:"eva-trash-outline"},on:{click:function(t){return a.deletarTarefa(e.row)}}},[t("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[0,10]}},[a._v("\n            Clique para deletar a tarefa\n          ")])],1):a._e()],1)]}}])}),t("ModalTarefa",{attrs:{modalTarefa:a.modalTarefa,tarefaEdicao:a.tarefaEdicao},on:{"update:modalTarefa":function(t){a.modalTarefa=t},"update:modal-tarefa":function(t){a.modalTarefa=t},"update:tarefaEdicao":function(t){a.tarefaEdicao=t},"update:tarefa-edicao":function(t){a.tarefaEdicao=t},"modal-tarefa:criada":a.tarefaCriada,"modal-tarefa:editada":a.tarefaEditada}})],1)},o=[],r=(e("14d9"),e("41be")),n=e("fc45"),s={name:"Tarefas",components:{ModalTarefa:n["a"]},data(){return{userProfile:"user",params:{searchParam:null},filter:null,tarefaEdicao:{},modalTarefa:!1,tarefas:[],pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},loading:!1,columns:[{name:"id",label:"#",field:"id",align:"left"},{name:"status",label:"Status",field:"status",align:"left",format:a=>this.formatStatus(a)},{name:"name",label:"Tarefa",field:"name",align:"left"},{name:"description",label:"Descrição",field:"description",align:"left",format:a=>this.formatComments(a)},{name:"limitDate",label:"Data Limite",field:"limitDate",align:"left",format:a=>this.formatDate(a)},{name:"owner",label:"Responsável",field:"owner",align:"left"},{name:"priority",label:"Prioridade",field:"priority",align:"left",format:a=>this.formatPriority(a)},{name:"comments",label:"Comentários",field:"comments",align:"left",format:a=>this.formatComments(a)},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{async listarTarefas(){const{data:a}=await Object(r["e"])();let t=[];t="admin"===this.userProfile?a:a.filter((a=>a.owner===localStorage.getItem("username")));const e={delayed:1,pending:2,finished:3},i={high:1,medium:2,low:3,none:4};t.sort(((a,t)=>{if("finished"===a.status&&"finished"!==t.status)return 1;if("finished"!==a.status&&"finished"===t.status)return-1;const o=new Date(a.limitDate),r=new Date(t.limitDate);if(o.getTime()!==r.getTime())return o-r;const n=e[a.status]-e[t.status];return 0!==n?n:i[a.priority]-i[t.priority]})),this.tarefas=t},async listarTarefasFiltro(){this.loading=!0;const a=await Object(r["e"])(),t=a.data;try{const a=this.params.searchParam.toLowerCase(),e=t.filter((t=>{const e=JSON.stringify(t).toLowerCase();return e.includes(a)}));this.LOAD_TAREFAS(e)}catch(e){this.tarefas=a.data}this.loading=!1},filtrarTarefa(a){this.tarefas=[],this.params.searchParam=a,this.loading=!0,this.listarTarefasFiltro(),this.loading=!1},LOAD_TAREFAS(a){this.tarefas=a},formatComments(a){return a&&a.length>30?a.substring(0,30)+"...":a},formatStatus(a){const t={delayed:"⚠️ Em Atraso",pending:"🕒 Em Andamento",finished:"🎉 Completa"};return t[a]||a},formatPriority(a){const t={high:"⏰ Urgente",medium:"⌛ Prazo Moderado",low:"🕗 Pouca Urgência",none:"🕰️ Sem Pressa"};return t[a]||a},formatDate(a){const t=new Date(a);t.setMinutes(t.getMinutes()+t.getTimezoneOffset());const e=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getFullYear();return`${e}-${i}-${o}`},tarefaCriada(a){const t=[...this.tarefas];t.push(a),this.tarefas=[...t]},tarefaEditada(a){const t=[...this.tarefas],e=t.findIndex((t=>t.id===a.id));e>-1&&(t[e]=a),this.tarefas=[...t]},editarTarefa(a){this.tarefaEdicao={...a},this.modalTarefa=!0},async concluirTarefa(a){this.loading=!0;try{const t={...a,status:"finished"},{data:e}=await Object(r["a"])(t);this.$emit("modal-tarefa:editada",e),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Tarefa finalizada!",actions:[{icon:"close",round:!0,color:"white"}]}),window.location.reload()}catch(t){console.error(t)}this.loading=!1},async duplicarTarefa(a){this.loading=!0;try{const t={...a},{data:e}=await Object(r["c"])(t);this.$emit("modal-tarefa:criada",e),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Tarefa duplicada!",actions:[{icon:"close",round:!0,color:"white"}]}),window.location.reload()}catch(t){console.error(t)}this.loading=!1},async checarAtrasadas(){try{const{data:a}=await Object(r["e"])();let t=!1;const e=a.map((async a=>{const e=new Date(a.limitDate),i=new Date;if(e<i&&"finished"!==a.status){const e={...a,status:"delayed"};await Object(r["a"])(e),t=!0}}));await Promise.all(e)}catch(a){console.error("Erro ao checar tarefas atrasadas:",a)}},deletarTarefa(a){this.$q.dialog({title:"Atenção!!",message:`Deseja realmente deletar o Tarefa "${a.name}"?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(r["d"])(a).then((t=>{let e=[...this.tarefas];e=e.filter((t=>t.id!==a.id)),this.tarefas=[...e],this.$q.notify({type:"positive",progress:!0,position:"top",message:`Tarefa ${a.name} deletado!`,actions:[{icon:"close",round:!0,color:"white"}]})})),this.loading=!1}))}},mounted(){this.listarTarefas(),this.checarAtrasadas(),this.userProfile=localStorage.getItem("profile")}},l=s,c=e("2877"),d=e("eaac"),f=e("0016"),m=e("27f9"),u=e("9c40"),h=e("db86"),p=e("05c0"),g=e("eebe"),b=e.n(g),w=Object(c["a"])(l,i,o,!1,null,"24643685",null);t["default"]=w.exports;b()(w,"components",{QTable:d["a"],QIcon:f["a"],QInput:m["a"],QBtn:u["a"],QTd:h["a"],QTooltip:p["a"]})}}]);